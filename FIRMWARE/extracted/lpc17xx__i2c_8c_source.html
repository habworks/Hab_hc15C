<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>LPC1700CMSIS Standard Peripheral Firmware Library Manual: C:/nxpdrv/LPC1700CMSIS/Drivers/source/lpc17xx_i2c.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>C:/nxpdrv/LPC1700CMSIS/Drivers/source/lpc17xx_i2c.c</h1><a href="lpc17xx__i2c_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/**********************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* $Id$          lpc17xx_gpio.c                          2011-03-31</span>
<a name="l00003"></a>00003 <span class="comment">*/</span>
<a name="l00027"></a>00027 <span class="comment">/* Peripheral group ----------------------------------------------------------- */</span>
<a name="l00032"></a>00032 <span class="comment">/* Includes ------------------------------------------------------------------- */</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include "<a class="code" href="lpc17xx__i2c_8h.html" title="Contains all macro definitions and function prototypes support for I2C firmware library...">lpc17xx_i2c.h</a>"</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include "<a class="code" href="lpc17xx__clkpwr_8h.html" title="Contains all macro definitions and function prototypes support for Clock and Power...">lpc17xx_clkpwr.h</a>"</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include "<a class="code" href="lpc17xx__pinsel_8h.html" title="Contains all macro definitions and function prototypes support for Pin connect block...">lpc17xx_pinsel.h</a>"</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="comment">/* If this source file built with example, the LPC17xx FW library configuration</span>
<a name="l00039"></a>00039 <span class="comment"> * file in each example directory ("lpc17xx_libcfg.h") must be included,</span>
<a name="l00040"></a>00040 <span class="comment"> * otherwise the default FW library configuration file must be included instead</span>
<a name="l00041"></a>00041 <span class="comment"> */</span>
<a name="l00042"></a>00042 <span class="preprocessor">#ifdef __BUILD_WITH_EXAMPLE__</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="preprocessor">#include "lpc17xx_libcfg.h"</span>
<a name="l00044"></a>00044 <span class="preprocessor">#else</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="lpc17xx__libcfg__default_8h.html" title="Default Library configuration header file.">lpc17xx_libcfg_default.h</a>"</span>
<a name="l00046"></a>00046 <span class="preprocessor">#endif </span><span class="comment">/* __BUILD_WITH_EXAMPLE__ */</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="preprocessor">#ifdef _I2C</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span>
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="comment">/* Private Types -------------------------------------------------------------- */</span>
<a name="l00060"></a><a class="code" href="struct_i2_c___c_f_g___t.html">00060</a> <span class="keyword">typedef</span> <span class="keyword">struct</span>
<a name="l00061"></a>00061 {
<a name="l00062"></a><a class="code" href="struct_i2_c___c_f_g___t.html#5a6738809adc0b29a2277731c5b50b3b">00062</a>   uint32_t      txrx_setup;                                             <span class="comment">/* Transmission setup */</span>
<a name="l00063"></a><a class="code" href="struct_i2_c___c_f_g___t.html#6e623499d0c8b2090741bf433769d9fe">00063</a>   int32_t               dir;                                                            <span class="comment">/* Current direction phase, 0 - write, 1 - read */</span>
<a name="l00064"></a>00064 } <a class="code" href="struct_i2_c___c_f_g___t.html" title="I2C device configuration structure type.">I2C_CFG_T</a>;
<a name="l00065"></a>00065 
<a name="l00070"></a>00070 <span class="comment">/* Private Variables ---------------------------------------------------------- */</span>
<a name="l00074"></a>00074 <span class="keyword">static</span> <a class="code" href="struct_i2_c___c_f_g___t.html" title="I2C device configuration structure type.">I2C_CFG_T</a> i2cdat[3];
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="keyword">static</span> uint32_t I2C_MasterComplete[3];
<a name="l00077"></a>00077 <span class="keyword">static</span> uint32_t I2C_SlaveComplete[3];
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="keyword">static</span> uint32_t I2C_MonitorBufferIndex;
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 <span class="comment">/* Private Functions ---------------------------------------------------------- */</span>
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 <span class="comment">/* Get I2C number */</span>
<a name="l00084"></a>00084 <span class="keyword">static</span> int32_t I2C_getNum(<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a> *I2Cx);
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <span class="comment">/* Generate a start condition on I2C bus (in master mode only) */</span>
<a name="l00087"></a>00087 <span class="keyword">static</span> uint32_t I2C_Start (<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a> *I2Cx);
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 <span class="comment">/* Generate a stop condition on I2C bus (in master mode only) */</span>
<a name="l00090"></a>00090 <span class="keyword">static</span> <span class="keywordtype">void</span> I2C_Stop (<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a> *I2Cx);
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <span class="comment">/* I2C send byte subroutine */</span>
<a name="l00093"></a>00093 <span class="keyword">static</span> uint32_t I2C_SendByte (<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a> *I2Cx, uint8_t databyte);
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <span class="comment">/* I2C get byte subroutine */</span>
<a name="l00096"></a>00096 <span class="keyword">static</span> uint32_t I2C_GetByte (<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a> *I2Cx, uint8_t *retdat, <a class="code" href="group___l_p_c___types___public___types.html#g39db6982619d623273fad8a383489309" title="Boolean Type definition.">Bool</a> ack);
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 <span class="comment">/* I2C set clock (hz) */</span>
<a name="l00099"></a>00099 <span class="keyword">static</span> <span class="keywordtype">void</span> I2C_SetClock (<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a> *I2Cx, uint32_t target_clock);
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 <span class="comment">/*--------------------------------------------------------------------------------*/</span>
<a name="l00102"></a>00102 <span class="comment">/********************************************************************/</span>
<a name="l00110"></a>00110 <span class="keyword">static</span> int32_t I2C_getNum(<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a> *I2Cx){
<a name="l00111"></a>00111         <span class="keywordflow">if</span> (I2Cx == <a class="code" href="group___l_p_c17xx___system.html#g14b6c56857e970a682a9bb22a0cb6716">LPC_I2C0</a>) {
<a name="l00112"></a>00112                 <span class="keywordflow">return</span> (0);
<a name="l00113"></a>00113         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (I2Cx == <a class="code" href="group___l_p_c17xx___system.html#gd6d6333e47875813be171cffef258837">LPC_I2C1</a>) {
<a name="l00114"></a>00114                 <span class="keywordflow">return</span> (1);
<a name="l00115"></a>00115         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (I2Cx == <a class="code" href="group___l_p_c17xx___system.html#g6bcdaa0ab66f4e3d213a488b34055557">LPC_I2C2</a>) {
<a name="l00116"></a>00116                 <span class="keywordflow">return</span> (2);
<a name="l00117"></a>00117         }
<a name="l00118"></a>00118         <span class="keywordflow">return</span> (-1);
<a name="l00119"></a>00119 }
<a name="l00120"></a>00120 
<a name="l00121"></a>00121 <span class="comment">/********************************************************************/</span>
<a name="l00129"></a>00129 <span class="keyword">static</span> uint32_t I2C_Start (<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a> *I2Cx)
<a name="l00130"></a>00130 {
<a name="l00131"></a>00131         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> = <a class="code" href="group___i2_c___private___macros.html#gbaad3370eb35644c135d40f06adbbba0">I2C_I2CONSET_STA</a>;
<a name="l00132"></a>00132         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l00133"></a>00133 
<a name="l00134"></a>00134         <span class="comment">// Wait for complete</span>
<a name="l00135"></a>00135         <span class="keywordflow">while</span> (!(I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> &amp; <a class="code" href="group___i2_c___private___macros.html#ga447cd2686805ef8009fc599144ee3dc">I2C_I2CONSET_SI</a>));
<a name="l00136"></a>00136         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#gb6148bf41d7fc32bd259d2f6a7d7667d">I2C_I2CONCLR_STAC</a>;
<a name="l00137"></a>00137         <span class="keywordflow">return</span> (I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#2a09f39bce73931b86d4622cdfa10835">I2STAT</a> &amp; <a class="code" href="group___i2_c___private___macros.html#gfeb8b5f682a81a2cc32f6c4b720a5e1f">I2C_STAT_CODE_BITMASK</a>);
<a name="l00138"></a>00138 }
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 <span class="comment">/********************************************************************/</span>
<a name="l00148"></a>00148 <span class="keyword">static</span> <span class="keywordtype">void</span> I2C_Stop (<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a> *I2Cx)
<a name="l00149"></a>00149 {
<a name="l00150"></a>00150 
<a name="l00151"></a>00151         <span class="comment">/* Make sure start bit is not active */</span>
<a name="l00152"></a>00152         <span class="keywordflow">if</span> (I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> &amp; <a class="code" href="group___i2_c___private___macros.html#gbaad3370eb35644c135d40f06adbbba0">I2C_I2CONSET_STA</a>)
<a name="l00153"></a>00153         {
<a name="l00154"></a>00154                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#gb6148bf41d7fc32bd259d2f6a7d7667d">I2C_I2CONCLR_STAC</a>;
<a name="l00155"></a>00155         }
<a name="l00156"></a>00156         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> = <a class="code" href="group___i2_c___private___macros.html#gae292803a059b84eac20ab8777d113af">I2C_I2CONSET_STO</a>;
<a name="l00157"></a>00157         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l00158"></a>00158 }
<a name="l00159"></a>00159 
<a name="l00160"></a>00160 <span class="comment">/********************************************************************/</span>
<a name="l00169"></a>00169 <span class="keyword">static</span> uint32_t I2C_SendByte (<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a> *I2Cx, uint8_t databyte)
<a name="l00170"></a>00170 {
<a name="l00171"></a>00171         <span class="comment">/* Make sure start bit is not active */</span>
<a name="l00172"></a>00172         <span class="keywordflow">if</span> (I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> &amp; <a class="code" href="group___i2_c___private___macros.html#gbaad3370eb35644c135d40f06adbbba0">I2C_I2CONSET_STA</a>)
<a name="l00173"></a>00173         {
<a name="l00174"></a>00174                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#gb6148bf41d7fc32bd259d2f6a7d7667d">I2C_I2CONCLR_STAC</a>;
<a name="l00175"></a>00175         }
<a name="l00176"></a>00176         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#c8ec35f7911d133683c9ae8f084a6910">I2DAT</a> = databyte &amp; <a class="code" href="group___i2_c___private___macros.html#gc66b7c81c93cc59f69d204b4eb7d639b">I2C_I2DAT_BITMASK</a>;
<a name="l00177"></a>00177         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l00178"></a>00178 
<a name="l00179"></a>00179         <span class="keywordflow">while</span> (!(I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> &amp; <a class="code" href="group___i2_c___private___macros.html#ga447cd2686805ef8009fc599144ee3dc">I2C_I2CONSET_SI</a>));
<a name="l00180"></a>00180         <span class="keywordflow">return</span> (I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#2a09f39bce73931b86d4622cdfa10835">I2STAT</a> &amp; <a class="code" href="group___i2_c___private___macros.html#gfeb8b5f682a81a2cc32f6c4b720a5e1f">I2C_STAT_CODE_BITMASK</a>);
<a name="l00181"></a>00181 }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 <span class="comment">/********************************************************************/</span>
<a name="l00193"></a>00193 <span class="keyword">static</span> uint32_t I2C_GetByte (<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a> *I2Cx, uint8_t *retdat, <a class="code" href="group___l_p_c___types___public___types.html#g39db6982619d623273fad8a383489309" title="Boolean Type definition.">Bool</a> ack)
<a name="l00194"></a>00194 {
<a name="l00195"></a>00195         <span class="keywordflow">if</span> (ack == <a class="code" href="group___l_p_c___types___public___types.html#gg39db6982619d623273fad8a383489309a82764c3079aea4e60c80e45befbb839">TRUE</a>)
<a name="l00196"></a>00196         {
<a name="l00197"></a>00197                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> = <a class="code" href="group___i2_c___private___macros.html#g784c4b2fe7f3299e338655d2ddbf283c">I2C_I2CONSET_AA</a>;
<a name="l00198"></a>00198         }
<a name="l00199"></a>00199         <span class="keywordflow">else</span>
<a name="l00200"></a>00200         {
<a name="l00201"></a>00201                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#ga13b19babb8442aa9047f8ecb92a908d">I2C_I2CONCLR_AAC</a>;
<a name="l00202"></a>00202         }
<a name="l00203"></a>00203         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l00204"></a>00204 
<a name="l00205"></a>00205         <span class="keywordflow">while</span> (!(I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> &amp; <a class="code" href="group___i2_c___private___macros.html#ga447cd2686805ef8009fc599144ee3dc">I2C_I2CONSET_SI</a>));
<a name="l00206"></a>00206         *retdat = (uint8_t) (I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#c8ec35f7911d133683c9ae8f084a6910">I2DAT</a> &amp; I2C_I2DAT_BITMASK);
<a name="l00207"></a>00207         <span class="keywordflow">return</span> (I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#2a09f39bce73931b86d4622cdfa10835">I2STAT</a> &amp; <a class="code" href="group___i2_c___private___macros.html#gfeb8b5f682a81a2cc32f6c4b720a5e1f">I2C_STAT_CODE_BITMASK</a>);
<a name="l00208"></a>00208 }
<a name="l00209"></a>00209 
<a name="l00210"></a>00210 <span class="comment">/*********************************************************************/</span>
<a name="l00219"></a>00219 <span class="keyword">static</span> <span class="keywordtype">void</span> I2C_SetClock (<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a> *I2Cx, uint32_t target_clock)
<a name="l00220"></a>00220 {
<a name="l00221"></a>00221         uint32_t temp;
<a name="l00222"></a>00222 
<a name="l00223"></a>00223         <a class="code" href="group___l_i_b_c_f_g___d_e_f_a_u_l_t___public___macros.html#g9d8414ced01feedb3238e5ffb3c1961f">CHECK_PARAM</a>(<a class="code" href="group___i2_c___private___macros.html#g27fcdfae701f8ce7ec72e5b1f8cd0511">PARAM_I2Cx</a>(I2Cx));
<a name="l00224"></a>00224 
<a name="l00225"></a>00225         <span class="comment">// Get PCLK of I2C controller</span>
<a name="l00226"></a>00226         <span class="keywordflow">if</span> (I2Cx == <a class="code" href="group___l_p_c17xx___system.html#g14b6c56857e970a682a9bb22a0cb6716">LPC_I2C0</a>)
<a name="l00227"></a>00227         {
<a name="l00228"></a>00228                 temp = <a class="code" href="group___c_l_k_p_w_r___public___functions.html#g1eea2e1c8aac99147b88d5c18928ffa8" title="Get current value of each Peripheral Clock.">CLKPWR_GetPCLK</a> (<a class="code" href="group___c_l_k_p_w_r___public___macros.html#g43fd50253c56be7a7fd2f93cd2684078">CLKPWR_PCLKSEL_I2C0</a>) / target_clock;
<a name="l00229"></a>00229         }
<a name="l00230"></a>00230         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (I2Cx == <a class="code" href="group___l_p_c17xx___system.html#gd6d6333e47875813be171cffef258837">LPC_I2C1</a>)
<a name="l00231"></a>00231         {
<a name="l00232"></a>00232                 temp = <a class="code" href="group___c_l_k_p_w_r___public___functions.html#g1eea2e1c8aac99147b88d5c18928ffa8" title="Get current value of each Peripheral Clock.">CLKPWR_GetPCLK</a> (<a class="code" href="group___c_l_k_p_w_r___public___macros.html#gb662479578bb2af89f683e17517b9a5e">CLKPWR_PCLKSEL_I2C1</a>) / target_clock;
<a name="l00233"></a>00233         }
<a name="l00234"></a>00234         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (I2Cx == <a class="code" href="group___l_p_c17xx___system.html#g6bcdaa0ab66f4e3d213a488b34055557">LPC_I2C2</a>)
<a name="l00235"></a>00235         {
<a name="l00236"></a>00236                 temp = <a class="code" href="group___c_l_k_p_w_r___public___functions.html#g1eea2e1c8aac99147b88d5c18928ffa8" title="Get current value of each Peripheral Clock.">CLKPWR_GetPCLK</a> (<a class="code" href="group___c_l_k_p_w_r___public___macros.html#gfbf149f2011d8691c7e1b9c3fe1383f4">CLKPWR_PCLKSEL_I2C2</a>) / target_clock;
<a name="l00237"></a>00237         }
<a name="l00238"></a>00238 
<a name="l00239"></a>00239         <span class="comment">/* Set the I2C clock value to register */</span>
<a name="l00240"></a>00240         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#03a0a56ef08d0d59275a7531eceaff96">I2SCLH</a> = (uint32_t)(temp / 2);
<a name="l00241"></a>00241         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#6f50de6ff51122bcef6a2c4b0a60d1e3">I2SCLL</a> = (uint32_t)(temp - I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#03a0a56ef08d0d59275a7531eceaff96">I2SCLH</a>);
<a name="l00242"></a>00242 }
<a name="l00243"></a>00243 <span class="comment">/* End of Private Functions --------------------------------------------------- */</span>
<a name="l00244"></a>00244 
<a name="l00245"></a>00245 
<a name="l00246"></a>00246 <span class="comment">/* Public Functions ----------------------------------------------------------- */</span>
<a name="l00251"></a>00251 <span class="comment">/********************************************************************/</span>
<a name="l00261"></a><a class="code" href="group___i2_c___public___functions.html#g4f0c228696f1a8b60437241ba9af7455">00261</a> <span class="keywordtype">void</span> <a class="code" href="group___i2_c___public___functions.html#g4f0c228696f1a8b60437241ba9af7455" title="Initializes the I2Cx peripheral with specified parameter.">I2C_Init</a>(<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a> *I2Cx, uint32_t clockrate)
<a name="l00262"></a>00262 {
<a name="l00263"></a>00263         <a class="code" href="group___l_i_b_c_f_g___d_e_f_a_u_l_t___public___macros.html#g9d8414ced01feedb3238e5ffb3c1961f">CHECK_PARAM</a>(<a class="code" href="group___i2_c___private___macros.html#g27fcdfae701f8ce7ec72e5b1f8cd0511">PARAM_I2Cx</a>(I2Cx));
<a name="l00264"></a>00264 
<a name="l00265"></a>00265         <span class="keywordflow">if</span> (I2Cx==<a class="code" href="group___l_p_c17xx___system.html#g14b6c56857e970a682a9bb22a0cb6716">LPC_I2C0</a>)
<a name="l00266"></a>00266         {
<a name="l00267"></a>00267                 <span class="comment">/* Set up clock and power for I2C0 module */</span>
<a name="l00268"></a>00268                 <a class="code" href="group___c_l_k_p_w_r___public___functions.html#gc29f7879a37c604a1040499001ba0121" title="Configure power supply for each peripheral according to NewState.">CLKPWR_ConfigPPWR</a> (<a class="code" href="group___c_l_k_p_w_r___public___macros.html#gca155b41f55c089a8480ec160135ffe8">CLKPWR_PCONP_PCI2C0</a>, <a class="code" href="group___l_p_c___types___public___types.html#ggc9a7e9a35d2513ec15c3b537aaa4fba17d46875fa3ebd2c34d2756950eda83bf">ENABLE</a>);
<a name="l00269"></a>00269                 <span class="comment">/* As default, peripheral clock for I2C0 module</span>
<a name="l00270"></a>00270 <span class="comment">                 * is set to FCCLK / 2 */</span>
<a name="l00271"></a>00271                 <a class="code" href="group___c_l_k_p_w_r___public___functions.html#g4e68fb4cf5c06c32b6ee6aea8dbaf78c" title="Set value of each Peripheral Clock Selection.">CLKPWR_SetPCLKDiv</a>(<a class="code" href="group___c_l_k_p_w_r___public___macros.html#g43fd50253c56be7a7fd2f93cd2684078">CLKPWR_PCLKSEL_I2C0</a>, <a class="code" href="group___c_l_k_p_w_r___public___macros.html#g07e1e67993eb7f67f2b9bca8e7a1d8c8">CLKPWR_PCLKSEL_CCLK_DIV_2</a>);
<a name="l00272"></a>00272         }
<a name="l00273"></a>00273         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (I2Cx==<a class="code" href="group___l_p_c17xx___system.html#gd6d6333e47875813be171cffef258837">LPC_I2C1</a>)
<a name="l00274"></a>00274         {
<a name="l00275"></a>00275                 <span class="comment">/* Set up clock and power for I2C1 module */</span>
<a name="l00276"></a>00276                 <a class="code" href="group___c_l_k_p_w_r___public___functions.html#gc29f7879a37c604a1040499001ba0121" title="Configure power supply for each peripheral according to NewState.">CLKPWR_ConfigPPWR</a> (<a class="code" href="group___c_l_k_p_w_r___public___macros.html#g533db7f7c151a115b487585d29889199">CLKPWR_PCONP_PCI2C1</a>, <a class="code" href="group___l_p_c___types___public___types.html#ggc9a7e9a35d2513ec15c3b537aaa4fba17d46875fa3ebd2c34d2756950eda83bf">ENABLE</a>);
<a name="l00277"></a>00277                 <span class="comment">/* As default, peripheral clock for I2C1 module</span>
<a name="l00278"></a>00278 <span class="comment">                 * is set to FCCLK / 2 */</span>
<a name="l00279"></a>00279                 <a class="code" href="group___c_l_k_p_w_r___public___functions.html#g4e68fb4cf5c06c32b6ee6aea8dbaf78c" title="Set value of each Peripheral Clock Selection.">CLKPWR_SetPCLKDiv</a>(<a class="code" href="group___c_l_k_p_w_r___public___macros.html#gb662479578bb2af89f683e17517b9a5e">CLKPWR_PCLKSEL_I2C1</a>, <a class="code" href="group___c_l_k_p_w_r___public___macros.html#g07e1e67993eb7f67f2b9bca8e7a1d8c8">CLKPWR_PCLKSEL_CCLK_DIV_2</a>);
<a name="l00280"></a>00280         }
<a name="l00281"></a>00281         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (I2Cx==<a class="code" href="group___l_p_c17xx___system.html#g6bcdaa0ab66f4e3d213a488b34055557">LPC_I2C2</a>)
<a name="l00282"></a>00282         {
<a name="l00283"></a>00283                 <span class="comment">/* Set up clock and power for I2C2 module */</span>
<a name="l00284"></a>00284                 <a class="code" href="group___c_l_k_p_w_r___public___functions.html#gc29f7879a37c604a1040499001ba0121" title="Configure power supply for each peripheral according to NewState.">CLKPWR_ConfigPPWR</a> (<a class="code" href="group___c_l_k_p_w_r___public___macros.html#g4882ffb6a89fe73a1fa8817e1a5b54e0">CLKPWR_PCONP_PCI2C2</a>, <a class="code" href="group___l_p_c___types___public___types.html#ggc9a7e9a35d2513ec15c3b537aaa4fba17d46875fa3ebd2c34d2756950eda83bf">ENABLE</a>);
<a name="l00285"></a>00285                 <span class="comment">/* As default, peripheral clock for I2C2 module</span>
<a name="l00286"></a>00286 <span class="comment">                 * is set to FCCLK / 2 */</span>
<a name="l00287"></a>00287                 <a class="code" href="group___c_l_k_p_w_r___public___functions.html#g4e68fb4cf5c06c32b6ee6aea8dbaf78c" title="Set value of each Peripheral Clock Selection.">CLKPWR_SetPCLKDiv</a>(<a class="code" href="group___c_l_k_p_w_r___public___macros.html#gfbf149f2011d8691c7e1b9c3fe1383f4">CLKPWR_PCLKSEL_I2C2</a>, <a class="code" href="group___c_l_k_p_w_r___public___macros.html#g07e1e67993eb7f67f2b9bca8e7a1d8c8">CLKPWR_PCLKSEL_CCLK_DIV_2</a>);
<a name="l00288"></a>00288         }
<a name="l00289"></a>00289         <span class="keywordflow">else</span> {
<a name="l00290"></a>00290                 <span class="comment">// Up-Support this device</span>
<a name="l00291"></a>00291                 <span class="keywordflow">return</span>;
<a name="l00292"></a>00292         }
<a name="l00293"></a>00293 
<a name="l00294"></a>00294     <span class="comment">/* Set clock rate */</span>
<a name="l00295"></a>00295     I2C_SetClock(I2Cx, clockrate);
<a name="l00296"></a>00296     <span class="comment">/* Set I2C operation to default */</span>
<a name="l00297"></a>00297     I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = (<a class="code" href="group___i2_c___private___macros.html#ga13b19babb8442aa9047f8ecb92a908d">I2C_I2CONCLR_AAC</a> | <a class="code" href="group___i2_c___private___macros.html#gb6148bf41d7fc32bd259d2f6a7d7667d">I2C_I2CONCLR_STAC</a> | <a class="code" href="group___i2_c___private___macros.html#g92718ac11d46f6e32d526749f09d01b2">I2C_I2CONCLR_I2ENC</a>);
<a name="l00298"></a>00298 }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300 <span class="comment">/*********************************************************************/</span>
<a name="l00309"></a><a class="code" href="group___i2_c___public___functions.html#g761d88cee2fa33f03e1c08c44057fc5b">00309</a> <span class="keywordtype">void</span> <a class="code" href="group___i2_c___public___functions.html#g761d88cee2fa33f03e1c08c44057fc5b" title="De-initializes the I2C peripheral registers to their default reset values.">I2C_DeInit</a>(<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a>* I2Cx)
<a name="l00310"></a>00310 {
<a name="l00311"></a>00311         <a class="code" href="group___l_i_b_c_f_g___d_e_f_a_u_l_t___public___macros.html#g9d8414ced01feedb3238e5ffb3c1961f">CHECK_PARAM</a>(<a class="code" href="group___i2_c___private___macros.html#g27fcdfae701f8ce7ec72e5b1f8cd0511">PARAM_I2Cx</a>(I2Cx));
<a name="l00312"></a>00312 
<a name="l00313"></a>00313         <span class="comment">/* Disable I2C control */</span>
<a name="l00314"></a>00314         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g92718ac11d46f6e32d526749f09d01b2">I2C_I2CONCLR_I2ENC</a>;
<a name="l00315"></a>00315 
<a name="l00316"></a>00316         <span class="keywordflow">if</span> (I2Cx==<a class="code" href="group___l_p_c17xx___system.html#g14b6c56857e970a682a9bb22a0cb6716">LPC_I2C0</a>)
<a name="l00317"></a>00317         {
<a name="l00318"></a>00318                 <span class="comment">/* Disable power for I2C0 module */</span>
<a name="l00319"></a>00319                 <a class="code" href="group___c_l_k_p_w_r___public___functions.html#gc29f7879a37c604a1040499001ba0121" title="Configure power supply for each peripheral according to NewState.">CLKPWR_ConfigPPWR</a> (<a class="code" href="group___c_l_k_p_w_r___public___macros.html#gca155b41f55c089a8480ec160135ffe8">CLKPWR_PCONP_PCI2C0</a>, <a class="code" href="group___l_p_c___types___public___types.html#ggc9a7e9a35d2513ec15c3b537aaa4fba1d3a9df141be0ccf10389b640f492b26d">DISABLE</a>);
<a name="l00320"></a>00320         }
<a name="l00321"></a>00321         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (I2Cx==<a class="code" href="group___l_p_c17xx___system.html#gd6d6333e47875813be171cffef258837">LPC_I2C1</a>)
<a name="l00322"></a>00322         {
<a name="l00323"></a>00323                 <span class="comment">/* Disable power for I2C1 module */</span>
<a name="l00324"></a>00324                 <a class="code" href="group___c_l_k_p_w_r___public___functions.html#gc29f7879a37c604a1040499001ba0121" title="Configure power supply for each peripheral according to NewState.">CLKPWR_ConfigPPWR</a> (<a class="code" href="group___c_l_k_p_w_r___public___macros.html#g533db7f7c151a115b487585d29889199">CLKPWR_PCONP_PCI2C1</a>, <a class="code" href="group___l_p_c___types___public___types.html#ggc9a7e9a35d2513ec15c3b537aaa4fba1d3a9df141be0ccf10389b640f492b26d">DISABLE</a>);
<a name="l00325"></a>00325         }
<a name="l00326"></a>00326         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (I2Cx==<a class="code" href="group___l_p_c17xx___system.html#g6bcdaa0ab66f4e3d213a488b34055557">LPC_I2C2</a>)
<a name="l00327"></a>00327         {
<a name="l00328"></a>00328                 <span class="comment">/* Disable power for I2C2 module */</span>
<a name="l00329"></a>00329                 <a class="code" href="group___c_l_k_p_w_r___public___functions.html#gc29f7879a37c604a1040499001ba0121" title="Configure power supply for each peripheral according to NewState.">CLKPWR_ConfigPPWR</a> (<a class="code" href="group___c_l_k_p_w_r___public___macros.html#g4882ffb6a89fe73a1fa8817e1a5b54e0">CLKPWR_PCONP_PCI2C2</a>, <a class="code" href="group___l_p_c___types___public___types.html#ggc9a7e9a35d2513ec15c3b537aaa4fba1d3a9df141be0ccf10389b640f492b26d">DISABLE</a>);
<a name="l00330"></a>00330         }
<a name="l00331"></a>00331 }
<a name="l00332"></a>00332 
<a name="l00333"></a>00333 <span class="comment">/*********************************************************************/</span>
<a name="l00342"></a><a class="code" href="group___i2_c___public___functions.html#ge592e1754a5500b03a1bb92d30e04246">00342</a> <span class="keywordtype">void</span> <a class="code" href="group___i2_c___public___functions.html#ge592e1754a5500b03a1bb92d30e04246" title="Enable or disable I2C peripheral&amp;#39;s operation.">I2C_Cmd</a>(<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a>* I2Cx, <a class="code" href="group___l_p_c___types___public___types.html#gc9a7e9a35d2513ec15c3b537aaa4fba1" title="Functional State Definition.">FunctionalState</a> NewState)
<a name="l00343"></a>00343 {
<a name="l00344"></a>00344         <a class="code" href="group___l_i_b_c_f_g___d_e_f_a_u_l_t___public___macros.html#g9d8414ced01feedb3238e5ffb3c1961f">CHECK_PARAM</a>(<a class="code" href="group___l_p_c___types___public___types.html#g5475435ea985fe5abbf2048e87e3e682">PARAM_FUNCTIONALSTATE</a>(NewState));
<a name="l00345"></a>00345         <a class="code" href="group___l_i_b_c_f_g___d_e_f_a_u_l_t___public___macros.html#g9d8414ced01feedb3238e5ffb3c1961f">CHECK_PARAM</a>(<a class="code" href="group___i2_c___private___macros.html#g27fcdfae701f8ce7ec72e5b1f8cd0511">PARAM_I2Cx</a>(I2Cx));
<a name="l00346"></a>00346 
<a name="l00347"></a>00347         <span class="keywordflow">if</span> (NewState == <a class="code" href="group___l_p_c___types___public___types.html#ggc9a7e9a35d2513ec15c3b537aaa4fba17d46875fa3ebd2c34d2756950eda83bf">ENABLE</a>)
<a name="l00348"></a>00348         {
<a name="l00349"></a>00349                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> = <a class="code" href="group___i2_c___private___macros.html#gb836acc31e0572bb0d0db614f0641f15">I2C_I2CONSET_I2EN</a>;
<a name="l00350"></a>00350         }
<a name="l00351"></a>00351         <span class="keywordflow">else</span>
<a name="l00352"></a>00352         {
<a name="l00353"></a>00353                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g92718ac11d46f6e32d526749f09d01b2">I2C_I2CONCLR_I2ENC</a>;
<a name="l00354"></a>00354         }
<a name="l00355"></a>00355 }
<a name="l00356"></a>00356 
<a name="l00357"></a>00357 <span class="comment">/*********************************************************************/</span>
<a name="l00369"></a><a class="code" href="group___i2_c___public___functions.html#gbdabf69925593fb4a7d93f576fe4818b">00369</a> <span class="keywordtype">void</span> <a class="code" href="group___i2_c___public___functions.html#gbdabf69925593fb4a7d93f576fe4818b" title="Enable/Disable interrupt for I2C peripheral.">I2C_IntCmd</a> (<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a> *I2Cx, <a class="code" href="group___l_p_c___types___public___types.html#g39db6982619d623273fad8a383489309" title="Boolean Type definition.">Bool</a> NewState)
<a name="l00370"></a>00370 {
<a name="l00371"></a>00371         <span class="keywordflow">if</span> (NewState)
<a name="l00372"></a>00372         {
<a name="l00373"></a>00373                 <span class="keywordflow">if</span>(I2Cx == <a class="code" href="group___l_p_c17xx___system.html#g14b6c56857e970a682a9bb22a0cb6716">LPC_I2C0</a>)
<a name="l00374"></a>00374                 {
<a name="l00375"></a>00375                         NVIC_EnableIRQ(<a class="code" href="group___l_p_c17xx___system.html#gg666eb0caeb12ec0e281415592ae890830f1945c7372a6de732306ea3801c8e2a">I2C0_IRQn</a>);
<a name="l00376"></a>00376                 }
<a name="l00377"></a>00377                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (I2Cx == <a class="code" href="group___l_p_c17xx___system.html#gd6d6333e47875813be171cffef258837">LPC_I2C1</a>)
<a name="l00378"></a>00378                 {
<a name="l00379"></a>00379                         NVIC_EnableIRQ(<a class="code" href="group___l_p_c17xx___system.html#gg666eb0caeb12ec0e281415592ae89083f651b1769e03e4653b1a4a7c88132398">I2C1_IRQn</a>);
<a name="l00380"></a>00380                 }
<a name="l00381"></a>00381                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (I2Cx == <a class="code" href="group___l_p_c17xx___system.html#g6bcdaa0ab66f4e3d213a488b34055557">LPC_I2C2</a>)
<a name="l00382"></a>00382                 {
<a name="l00383"></a>00383                         NVIC_EnableIRQ(<a class="code" href="group___l_p_c17xx___system.html#gg666eb0caeb12ec0e281415592ae890830e9ff46d0a6311ca3cc43a71702d638d">I2C2_IRQn</a>);
<a name="l00384"></a>00384                 }
<a name="l00385"></a>00385         }
<a name="l00386"></a>00386         <span class="keywordflow">else</span>
<a name="l00387"></a>00387         {
<a name="l00388"></a>00388                 <span class="keywordflow">if</span>(I2Cx == <a class="code" href="group___l_p_c17xx___system.html#g14b6c56857e970a682a9bb22a0cb6716">LPC_I2C0</a>)
<a name="l00389"></a>00389                 {
<a name="l00390"></a>00390                         NVIC_DisableIRQ(<a class="code" href="group___l_p_c17xx___system.html#gg666eb0caeb12ec0e281415592ae890830f1945c7372a6de732306ea3801c8e2a">I2C0_IRQn</a>);
<a name="l00391"></a>00391                 }
<a name="l00392"></a>00392                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (I2Cx == <a class="code" href="group___l_p_c17xx___system.html#gd6d6333e47875813be171cffef258837">LPC_I2C1</a>)
<a name="l00393"></a>00393                 {
<a name="l00394"></a>00394                         NVIC_DisableIRQ(<a class="code" href="group___l_p_c17xx___system.html#gg666eb0caeb12ec0e281415592ae89083f651b1769e03e4653b1a4a7c88132398">I2C1_IRQn</a>);
<a name="l00395"></a>00395                 }
<a name="l00396"></a>00396                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (I2Cx == <a class="code" href="group___l_p_c17xx___system.html#g6bcdaa0ab66f4e3d213a488b34055557">LPC_I2C2</a>)
<a name="l00397"></a>00397                 {
<a name="l00398"></a>00398                         NVIC_DisableIRQ(<a class="code" href="group___l_p_c17xx___system.html#gg666eb0caeb12ec0e281415592ae890830e9ff46d0a6311ca3cc43a71702d638d">I2C2_IRQn</a>);
<a name="l00399"></a>00399                 }
<a name="l00400"></a>00400         }
<a name="l00401"></a>00401     <span class="keywordflow">return</span>;
<a name="l00402"></a>00402 }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404 
<a name="l00405"></a>00405 <span class="comment">/*********************************************************************/</span>
<a name="l00413"></a><a class="code" href="group___i2_c___public___functions.html#g2a72b0df9f2df2190c02f44bc5de8f0c">00413</a> <span class="keywordtype">void</span> <a class="code" href="group___i2_c___public___functions.html#g2a72b0df9f2df2190c02f44bc5de8f0c" title="General Master Interrupt handler for I2C peripheral.">I2C_MasterHandler</a> (<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a>  *I2Cx)
<a name="l00414"></a>00414 {
<a name="l00415"></a>00415         int32_t tmp;
<a name="l00416"></a>00416         uint8_t returnCode;
<a name="l00417"></a>00417         <a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html" title="Master transfer setup data structure definitions.">I2C_M_SETUP_Type</a> *txrx_setup;
<a name="l00418"></a>00418 
<a name="l00419"></a>00419         tmp = I2C_getNum(I2Cx);
<a name="l00420"></a>00420         txrx_setup = (<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html" title="Master transfer setup data structure definitions.">I2C_M_SETUP_Type</a> *) i2cdat[tmp].txrx_setup;
<a name="l00421"></a>00421 
<a name="l00422"></a>00422         returnCode = (I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#2a09f39bce73931b86d4622cdfa10835">I2STAT</a> &amp; <a class="code" href="group___i2_c___private___macros.html#gfeb8b5f682a81a2cc32f6c4b720a5e1f">I2C_STAT_CODE_BITMASK</a>);
<a name="l00423"></a>00423         <span class="comment">// Save current status</span>
<a name="l00424"></a>00424         txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#de20423e91627f07e610924cb0081623">status</a> = returnCode;
<a name="l00425"></a>00425         <span class="comment">// there's no relevant information</span>
<a name="l00426"></a>00426         <span class="keywordflow">if</span> (returnCode == <a class="code" href="group___i2_c___private___macros.html#g3e2ecdeb466041bb3cf435ccf36564d9">I2C_I2STAT_NO_INF</a>){
<a name="l00427"></a>00427                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l00428"></a>00428                 <span class="keywordflow">return</span>;
<a name="l00429"></a>00429         }
<a name="l00430"></a>00430 
<a name="l00431"></a>00431         <span class="comment">/* ----------------------------- TRANSMIT PHASE --------------------------*/</span>
<a name="l00432"></a>00432         <span class="keywordflow">if</span> (i2cdat[tmp].dir == 0){
<a name="l00433"></a>00433                 <span class="keywordflow">switch</span> (returnCode)
<a name="l00434"></a>00434                 {
<a name="l00435"></a>00435                 <span class="comment">/* A start/repeat start condition has been transmitted -------------------*/</span>
<a name="l00436"></a>00436                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#g5c44c05176052f6040cd40d680bc2a91">I2C_I2STAT_M_TX_START</a>:
<a name="l00437"></a>00437                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#gd41d0d1392b7d905b22b9c5015f2e48f">I2C_I2STAT_M_TX_RESTART</a>:
<a name="l00438"></a>00438                         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#gb6148bf41d7fc32bd259d2f6a7d7667d">I2C_I2CONCLR_STAC</a>;
<a name="l00439"></a>00439                         <span class="comment">/*</span>
<a name="l00440"></a>00440 <span class="comment">                         * If there's any transmit data, then start to</span>
<a name="l00441"></a>00441 <span class="comment">                         * send SLA+W right now, otherwise check whether if there's</span>
<a name="l00442"></a>00442 <span class="comment">                         * any receive data for next state.</span>
<a name="l00443"></a>00443 <span class="comment">                         */</span>
<a name="l00444"></a>00444                         <span class="keywordflow">if</span> ((txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#7668ceccad3cfceb0d2f53330ddea68b">tx_data</a> != <a class="code" href="group___l_p_c___types___public___macros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#c0dae38131a0a0786164fe9d1bc8f5a6">tx_length</a> != 0)){
<a name="l00445"></a>00445                                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#c8ec35f7911d133683c9ae8f084a6910">I2DAT</a> = (txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#4902d420a2d1b9715639e7acc5843281">sl_addr7bit</a> &lt;&lt; 1);
<a name="l00446"></a>00446                                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l00447"></a>00447                         } <span class="keywordflow">else</span> {
<a name="l00448"></a>00448                                 <span class="keywordflow">goto</span> next_stage;
<a name="l00449"></a>00449                         }
<a name="l00450"></a>00450                         <span class="keywordflow">break</span>;
<a name="l00451"></a>00451 
<a name="l00452"></a>00452                 <span class="comment">/* SLA+W has been transmitted, ACK has been received ----------------------*/</span>
<a name="l00453"></a>00453                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#gb91c158252efeb1a3a139faec3622ae0">I2C_I2STAT_M_TX_SLAW_ACK</a>:
<a name="l00454"></a>00454                 <span class="comment">/* Data has been transmitted, ACK has been received */</span>
<a name="l00455"></a>00455                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#gd8c325e3c58aa8e7810797b9a6761596">I2C_I2STAT_M_TX_DAT_ACK</a>:
<a name="l00456"></a>00456                         <span class="comment">/* Send more data */</span>
<a name="l00457"></a>00457                         <span class="keywordflow">if</span> ((txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#45c3d5f3496c906efec9da0935a6a623">tx_count</a> &lt; txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#c0dae38131a0a0786164fe9d1bc8f5a6">tx_length</a>) \
<a name="l00458"></a>00458                                         &amp;&amp; (txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#7668ceccad3cfceb0d2f53330ddea68b">tx_data</a> != <a class="code" href="group___l_p_c___types___public___macros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)){
<a name="l00459"></a>00459                                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#c8ec35f7911d133683c9ae8f084a6910">I2DAT</a> =  *(uint8_t *)(txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#7668ceccad3cfceb0d2f53330ddea68b">tx_data</a> + txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#45c3d5f3496c906efec9da0935a6a623">tx_count</a>);
<a name="l00460"></a>00460                                 txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#45c3d5f3496c906efec9da0935a6a623">tx_count</a>++;
<a name="l00461"></a>00461                                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l00462"></a>00462                         }
<a name="l00463"></a>00463                         <span class="comment">// no more data, switch to next stage</span>
<a name="l00464"></a>00464                         <span class="keywordflow">else</span> {
<a name="l00465"></a>00465 next_stage:
<a name="l00466"></a>00466                                 <span class="comment">// change direction</span>
<a name="l00467"></a>00467                                 i2cdat[tmp].<a class="code" href="struct_i2_c___c_f_g___t.html#6e623499d0c8b2090741bf433769d9fe">dir</a> = 1;
<a name="l00468"></a>00468                                 <span class="comment">// Check if any data to receive</span>
<a name="l00469"></a>00469                                 <span class="keywordflow">if</span> ((txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#8418b12cfc7c31321dd7361d20849075">rx_length</a> != 0) &amp;&amp; (txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#8a4e2302651974da84f7b9904e8e1914">rx_data</a> != <a class="code" href="group___l_p_c___types___public___macros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)){
<a name="l00470"></a>00470                                                 <span class="comment">// check whether if we need to issue an repeat start</span>
<a name="l00471"></a>00471                                                 <span class="keywordflow">if</span> ((txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#c0dae38131a0a0786164fe9d1bc8f5a6">tx_length</a> != 0) &amp;&amp; (txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#7668ceccad3cfceb0d2f53330ddea68b">tx_data</a> != <a class="code" href="group___l_p_c___types___public___macros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)){
<a name="l00472"></a>00472                                                         <span class="comment">// Send out an repeat start command</span>
<a name="l00473"></a>00473                                                         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> = <a class="code" href="group___i2_c___private___macros.html#gbaad3370eb35644c135d40f06adbbba0">I2C_I2CONSET_STA</a>;
<a name="l00474"></a>00474                                                         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#ga13b19babb8442aa9047f8ecb92a908d">I2C_I2CONCLR_AAC</a> | <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l00475"></a>00475                                                 }
<a name="l00476"></a>00476                                                 <span class="comment">// Don't need issue an repeat start, just goto send SLA+R</span>
<a name="l00477"></a>00477                                                 <span class="keywordflow">else</span> {
<a name="l00478"></a>00478                                                         <span class="keywordflow">goto</span> send_slar;
<a name="l00479"></a>00479                                                 }
<a name="l00480"></a>00480                                 }
<a name="l00481"></a>00481                                 <span class="comment">// no more data send, the go to end stage now</span>
<a name="l00482"></a>00482                                 <span class="keywordflow">else</span> {
<a name="l00483"></a>00483                                         <span class="comment">// success, goto end stage</span>
<a name="l00484"></a>00484                                         txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#de20423e91627f07e610924cb0081623">status</a> |= <a class="code" href="group___i2_c___private___macros.html#gefbb25ca99e199765e7dcdd6ef343590">I2C_SETUP_STATUS_DONE</a>;
<a name="l00485"></a>00485                                         <span class="keywordflow">goto</span> end_stage;
<a name="l00486"></a>00486                                 }
<a name="l00487"></a>00487                         }
<a name="l00488"></a>00488                         <span class="keywordflow">break</span>;
<a name="l00489"></a>00489 
<a name="l00490"></a>00490                 <span class="comment">/* SLA+W has been transmitted, NACK has been received ----------------------*/</span>
<a name="l00491"></a>00491                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#g15729d9436fbf4c23a22e7cdbc913552">I2C_I2STAT_M_TX_SLAW_NACK</a>:
<a name="l00492"></a>00492                 <span class="comment">/* Data has been transmitted, NACK has been received -----------------------*/</span>
<a name="l00493"></a>00493                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#g234f86990a6fd63f1d2064cbca4709a3">I2C_I2STAT_M_TX_DAT_NACK</a>:
<a name="l00494"></a>00494                         <span class="comment">// update status</span>
<a name="l00495"></a>00495                         txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#de20423e91627f07e610924cb0081623">status</a> |= <a class="code" href="group___i2_c___private___macros.html#g90a37b470118d82b9682cfc2e0b4de84">I2C_SETUP_STATUS_NOACKF</a>;
<a name="l00496"></a>00496                         <span class="keywordflow">goto</span> retry;
<a name="l00497"></a>00497                 <span class="comment">/* Arbitration lost in SLA+R/W or Data bytes -------------------------------*/</span>
<a name="l00498"></a>00498                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#g79230136402441c7e233c63fd2f71bdf">I2C_I2STAT_M_TX_ARB_LOST</a>:
<a name="l00499"></a>00499                         <span class="comment">// update status</span>
<a name="l00500"></a>00500                         txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#de20423e91627f07e610924cb0081623">status</a> |= <a class="code" href="group___i2_c___private___macros.html#ge90c077796281121b65b80b661a23062">I2C_SETUP_STATUS_ARBF</a>;
<a name="l00501"></a>00501                 <span class="keywordflow">default</span>:
<a name="l00502"></a>00502                         <span class="keywordflow">goto</span> retry;
<a name="l00503"></a>00503                 }
<a name="l00504"></a>00504         }
<a name="l00505"></a>00505 
<a name="l00506"></a>00506         <span class="comment">/* ----------------------------- RECEIVE PHASE --------------------------*/</span>
<a name="l00507"></a>00507         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i2cdat[tmp].dir == 1){
<a name="l00508"></a>00508                 <span class="keywordflow">switch</span> (returnCode){
<a name="l00509"></a>00509                         <span class="comment">/* A start/repeat start condition has been transmitted ---------------------*/</span>
<a name="l00510"></a>00510                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#gb1f79137c62e306269633b005ad936da">I2C_I2STAT_M_RX_START</a>:
<a name="l00511"></a>00511                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#gcb1c9145acd64a77464017f1dd9279c5">I2C_I2STAT_M_RX_RESTART</a>:
<a name="l00512"></a>00512                         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#gb6148bf41d7fc32bd259d2f6a7d7667d">I2C_I2CONCLR_STAC</a>;
<a name="l00513"></a>00513                         <span class="comment">/*</span>
<a name="l00514"></a>00514 <span class="comment">                         * If there's any receive data, then start to</span>
<a name="l00515"></a>00515 <span class="comment">                         * send SLA+R right now, otherwise check whether if there's</span>
<a name="l00516"></a>00516 <span class="comment">                         * any receive data for end of state.</span>
<a name="l00517"></a>00517 <span class="comment">                         */</span>
<a name="l00518"></a>00518                         <span class="keywordflow">if</span> ((txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#8a4e2302651974da84f7b9904e8e1914">rx_data</a> != <a class="code" href="group___l_p_c___types___public___macros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#8418b12cfc7c31321dd7361d20849075">rx_length</a> != 0)){
<a name="l00519"></a>00519 send_slar:
<a name="l00520"></a>00520                                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#c8ec35f7911d133683c9ae8f084a6910">I2DAT</a> = (txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#4902d420a2d1b9715639e7acc5843281">sl_addr7bit</a> &lt;&lt; 1) | 0x01;
<a name="l00521"></a>00521                                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l00522"></a>00522                         } <span class="keywordflow">else</span> {
<a name="l00523"></a>00523                                 <span class="comment">// Success, goto end stage</span>
<a name="l00524"></a>00524                                 txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#de20423e91627f07e610924cb0081623">status</a> |= <a class="code" href="group___i2_c___private___macros.html#gefbb25ca99e199765e7dcdd6ef343590">I2C_SETUP_STATUS_DONE</a>;
<a name="l00525"></a>00525                                 <span class="keywordflow">goto</span> end_stage;
<a name="l00526"></a>00526                         }
<a name="l00527"></a>00527                         <span class="keywordflow">break</span>;
<a name="l00528"></a>00528 
<a name="l00529"></a>00529                 <span class="comment">/* SLA+R has been transmitted, ACK has been received -----------------*/</span>
<a name="l00530"></a>00530                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#gcd29e4a94f8a533477dbbf026c0d525a">I2C_I2STAT_M_RX_SLAR_ACK</a>:
<a name="l00531"></a>00531                         <span class="keywordflow">if</span> (txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#f251ff9839684a7ccd7e869d9c8f2c33">rx_count</a> &lt; (txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#8418b12cfc7c31321dd7361d20849075">rx_length</a> - 1)) {
<a name="l00532"></a>00532                                 <span class="comment">/*Data will be received,  ACK will be return*/</span>
<a name="l00533"></a>00533                                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> = <a class="code" href="group___i2_c___private___macros.html#g784c4b2fe7f3299e338655d2ddbf283c">I2C_I2CONSET_AA</a>;
<a name="l00534"></a>00534                         }
<a name="l00535"></a>00535                         <span class="keywordflow">else</span> {
<a name="l00536"></a>00536                                 <span class="comment">/*Last data will be received,  NACK will be return*/</span>
<a name="l00537"></a>00537                                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g784c4b2fe7f3299e338655d2ddbf283c">I2C_I2CONSET_AA</a>;
<a name="l00538"></a>00538                         }
<a name="l00539"></a>00539                         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l00540"></a>00540                         <span class="keywordflow">break</span>;
<a name="l00541"></a>00541 
<a name="l00542"></a>00542                 <span class="comment">/* Data has been received, ACK has been returned ----------------------*/</span>
<a name="l00543"></a>00543                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#g2f07d3cfad351ba3c976d629db20cea2">I2C_I2STAT_M_RX_DAT_ACK</a>:
<a name="l00544"></a>00544                         <span class="comment">// Note save data and increase counter first, then check later</span>
<a name="l00545"></a>00545                         <span class="comment">/* Save data  */</span>
<a name="l00546"></a>00546                         <span class="keywordflow">if</span> ((txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#8a4e2302651974da84f7b9904e8e1914">rx_data</a> != <a class="code" href="group___l_p_c___types___public___macros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#f251ff9839684a7ccd7e869d9c8f2c33">rx_count</a> &lt; txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#8418b12cfc7c31321dd7361d20849075">rx_length</a>)){
<a name="l00547"></a>00547                                 *(uint8_t *)(txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#8a4e2302651974da84f7b9904e8e1914">rx_data</a> + txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#f251ff9839684a7ccd7e869d9c8f2c33">rx_count</a>) = (I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#c8ec35f7911d133683c9ae8f084a6910">I2DAT</a> &amp; I2C_I2DAT_BITMASK);
<a name="l00548"></a>00548                                 txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#f251ff9839684a7ccd7e869d9c8f2c33">rx_count</a>++;
<a name="l00549"></a>00549                         }
<a name="l00550"></a>00550                         <span class="keywordflow">if</span> (txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#f251ff9839684a7ccd7e869d9c8f2c33">rx_count</a> &lt; (txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#8418b12cfc7c31321dd7361d20849075">rx_length</a> - 1)) {
<a name="l00551"></a>00551                                 <span class="comment">/*Data will be received,  ACK will be return*/</span>
<a name="l00552"></a>00552                                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> = <a class="code" href="group___i2_c___private___macros.html#g784c4b2fe7f3299e338655d2ddbf283c">I2C_I2CONSET_AA</a>;
<a name="l00553"></a>00553                         }
<a name="l00554"></a>00554                         <span class="keywordflow">else</span> {
<a name="l00555"></a>00555                                 <span class="comment">/*Last data will be received,  NACK will be return*/</span>
<a name="l00556"></a>00556                                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g784c4b2fe7f3299e338655d2ddbf283c">I2C_I2CONSET_AA</a>;
<a name="l00557"></a>00557                         }
<a name="l00558"></a>00558 
<a name="l00559"></a>00559                         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l00560"></a>00560                         <span class="keywordflow">break</span>;
<a name="l00561"></a>00561 
<a name="l00562"></a>00562                 <span class="comment">/* Data has been received, NACK has been return -------------------------*/</span>
<a name="l00563"></a>00563                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#g9cc5203175775bfa5ae6df5d6d98b014">I2C_I2STAT_M_RX_DAT_NACK</a>:
<a name="l00564"></a>00564                         <span class="comment">/* Save the last data */</span>
<a name="l00565"></a>00565                         <span class="keywordflow">if</span> ((txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#8a4e2302651974da84f7b9904e8e1914">rx_data</a> != <a class="code" href="group___l_p_c___types___public___macros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#f251ff9839684a7ccd7e869d9c8f2c33">rx_count</a> &lt; txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#8418b12cfc7c31321dd7361d20849075">rx_length</a>)){
<a name="l00566"></a>00566                                 *(uint8_t *)(txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#8a4e2302651974da84f7b9904e8e1914">rx_data</a> + txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#f251ff9839684a7ccd7e869d9c8f2c33">rx_count</a>) = (I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#c8ec35f7911d133683c9ae8f084a6910">I2DAT</a> &amp; I2C_I2DAT_BITMASK);
<a name="l00567"></a>00567                                 txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#f251ff9839684a7ccd7e869d9c8f2c33">rx_count</a>++;
<a name="l00568"></a>00568                         }
<a name="l00569"></a>00569                         <span class="comment">// success, go to end stage</span>
<a name="l00570"></a>00570                         txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#de20423e91627f07e610924cb0081623">status</a> |= <a class="code" href="group___i2_c___private___macros.html#gefbb25ca99e199765e7dcdd6ef343590">I2C_SETUP_STATUS_DONE</a>;
<a name="l00571"></a>00571                         <span class="keywordflow">goto</span> end_stage;
<a name="l00572"></a>00572 
<a name="l00573"></a>00573                 <span class="comment">/* SLA+R has been transmitted, NACK has been received ------------------*/</span>
<a name="l00574"></a>00574                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#gfe156febe3313a9f3423776f97d0f24f">I2C_I2STAT_M_RX_SLAR_NACK</a>:
<a name="l00575"></a>00575                         <span class="comment">// update status</span>
<a name="l00576"></a>00576                         txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#de20423e91627f07e610924cb0081623">status</a> |= <a class="code" href="group___i2_c___private___macros.html#g90a37b470118d82b9682cfc2e0b4de84">I2C_SETUP_STATUS_NOACKF</a>;
<a name="l00577"></a>00577                         <span class="keywordflow">goto</span> retry;
<a name="l00578"></a>00578 
<a name="l00579"></a>00579                 <span class="comment">/* Arbitration lost ----------------------------------------------------*/</span>
<a name="l00580"></a>00580                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#ged32dea40cf84a1efb09e0c389579163">I2C_I2STAT_M_RX_ARB_LOST</a>:
<a name="l00581"></a>00581                         <span class="comment">// update status</span>
<a name="l00582"></a>00582                         txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#de20423e91627f07e610924cb0081623">status</a> |= <a class="code" href="group___i2_c___private___macros.html#ge90c077796281121b65b80b661a23062">I2C_SETUP_STATUS_ARBF</a>;
<a name="l00583"></a>00583                 <span class="keywordflow">default</span>:
<a name="l00584"></a>00584 retry:
<a name="l00585"></a>00585                         <span class="comment">// check if retransmission is available</span>
<a name="l00586"></a>00586                         <span class="keywordflow">if</span> (txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#a8c340e9707632a8e1d93ce795f7508c">retransmissions_count</a> &lt; txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#808bcf1bd88eb24d1e8eda4197d83262">retransmissions_max</a>){
<a name="l00587"></a>00587                                 <span class="comment">// Clear tx count</span>
<a name="l00588"></a>00588                                 txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#45c3d5f3496c906efec9da0935a6a623">tx_count</a> = 0;
<a name="l00589"></a>00589                                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> = <a class="code" href="group___i2_c___private___macros.html#gbaad3370eb35644c135d40f06adbbba0">I2C_I2CONSET_STA</a>;
<a name="l00590"></a>00590                                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#ga13b19babb8442aa9047f8ecb92a908d">I2C_I2CONCLR_AAC</a> | <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l00591"></a>00591                                 txrx_setup-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#a8c340e9707632a8e1d93ce795f7508c">retransmissions_count</a>++;
<a name="l00592"></a>00592                         }
<a name="l00593"></a>00593                         <span class="comment">// End of stage</span>
<a name="l00594"></a>00594                         <span class="keywordflow">else</span> {
<a name="l00595"></a>00595 end_stage:
<a name="l00596"></a>00596                                 <span class="comment">// Disable interrupt</span>
<a name="l00597"></a>00597                                 <a class="code" href="group___i2_c___public___functions.html#gbdabf69925593fb4a7d93f576fe4818b" title="Enable/Disable interrupt for I2C peripheral.">I2C_IntCmd</a>(I2Cx, 0);
<a name="l00598"></a>00598                                 <span class="comment">// Send stop</span>
<a name="l00599"></a>00599                                 I2C_Stop(I2Cx);
<a name="l00600"></a>00600 
<a name="l00601"></a>00601                                 I2C_MasterComplete[tmp] = <a class="code" href="group___l_p_c___types___public___types.html#gg39db6982619d623273fad8a383489309a82764c3079aea4e60c80e45befbb839">TRUE</a>;
<a name="l00602"></a>00602                         }
<a name="l00603"></a>00603                         <span class="keywordflow">break</span>;
<a name="l00604"></a>00604                 }
<a name="l00605"></a>00605         }
<a name="l00606"></a>00606 }
<a name="l00607"></a>00607 
<a name="l00608"></a>00608 
<a name="l00609"></a>00609 <span class="comment">/*********************************************************************/</span>
<a name="l00617"></a><a class="code" href="group___i2_c___public___functions.html#gd6be7f7f521b9838d05cb033caae68d0">00617</a> <span class="keywordtype">void</span> <a class="code" href="group___i2_c___public___functions.html#gd6be7f7f521b9838d05cb033caae68d0" title="General Slave Interrupt handler for I2C peripheral.">I2C_SlaveHandler</a> (<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a>  *I2Cx)
<a name="l00618"></a>00618 {
<a name="l00619"></a>00619         int32_t tmp;
<a name="l00620"></a>00620         uint8_t returnCode;
<a name="l00621"></a>00621         <a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html" title="Slave transfer setup data structure definitions.">I2C_S_SETUP_Type</a> *txrx_setup;
<a name="l00622"></a>00622         uint32_t timeout;
<a name="l00623"></a>00623 
<a name="l00624"></a>00624         tmp = I2C_getNum(I2Cx);
<a name="l00625"></a>00625         txrx_setup = (<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html" title="Slave transfer setup data structure definitions.">I2C_S_SETUP_Type</a> *) i2cdat[tmp].txrx_setup;
<a name="l00626"></a>00626 
<a name="l00627"></a>00627         returnCode = (I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#2a09f39bce73931b86d4622cdfa10835">I2STAT</a> &amp; <a class="code" href="group___i2_c___private___macros.html#gfeb8b5f682a81a2cc32f6c4b720a5e1f">I2C_STAT_CODE_BITMASK</a>);
<a name="l00628"></a>00628         <span class="comment">// Save current status</span>
<a name="l00629"></a>00629         txrx_setup-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#de20423e91627f07e610924cb0081623">status</a> = returnCode;
<a name="l00630"></a>00630         <span class="comment">// there's no relevant information</span>
<a name="l00631"></a>00631         <span class="keywordflow">if</span> (returnCode == <a class="code" href="group___i2_c___private___macros.html#g3e2ecdeb466041bb3cf435ccf36564d9">I2C_I2STAT_NO_INF</a>){
<a name="l00632"></a>00632                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l00633"></a>00633                 <span class="keywordflow">return</span>;
<a name="l00634"></a>00634         }
<a name="l00635"></a>00635 
<a name="l00636"></a>00636 
<a name="l00637"></a>00637         <span class="keywordflow">switch</span> (returnCode)
<a name="l00638"></a>00638         {
<a name="l00639"></a>00639 
<a name="l00640"></a>00640         <span class="comment">/* No status information */</span>
<a name="l00641"></a>00641         <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#g3e2ecdeb466041bb3cf435ccf36564d9">I2C_I2STAT_NO_INF</a>:
<a name="l00642"></a>00642                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> = <a class="code" href="group___i2_c___private___macros.html#g784c4b2fe7f3299e338655d2ddbf283c">I2C_I2CONSET_AA</a>;
<a name="l00643"></a>00643                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l00644"></a>00644                 <span class="keywordflow">break</span>;
<a name="l00645"></a>00645 
<a name="l00646"></a>00646         <span class="comment">/* Reading phase -------------------------------------------------------- */</span>
<a name="l00647"></a>00647         <span class="comment">/* Own SLA+R has been received, ACK has been returned */</span>
<a name="l00648"></a>00648         <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#g7055c4b55feda352df8016cbca0c270b">I2C_I2STAT_S_RX_SLAW_ACK</a>:
<a name="l00649"></a>00649         <span class="comment">/* General call address has been received, ACK has been returned */</span>
<a name="l00650"></a>00650         <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#gdcab34e87ad115c011e23a5bd4fb8aa3">I2C_I2STAT_S_RX_GENCALL_ACK</a>:
<a name="l00651"></a>00651                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> = <a class="code" href="group___i2_c___private___macros.html#g784c4b2fe7f3299e338655d2ddbf283c">I2C_I2CONSET_AA</a>;
<a name="l00652"></a>00652                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l00653"></a>00653                 <span class="keywordflow">break</span>;
<a name="l00654"></a>00654 
<a name="l00655"></a>00655         <span class="comment">/* Previously addressed with own SLA;</span>
<a name="l00656"></a>00656 <span class="comment">         * DATA byte has been received;</span>
<a name="l00657"></a>00657 <span class="comment">         * ACK has been returned */</span>
<a name="l00658"></a>00658         <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#g4342227592c3e2e345517bd3e6cd8089">I2C_I2STAT_S_RX_PRE_SLA_DAT_ACK</a>:
<a name="l00659"></a>00659         <span class="comment">/* DATA has been received, ACK hasn been return */</span>
<a name="l00660"></a>00660         <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#g75dd46ddb054c4d47a531b8e90f7f446">I2C_I2STAT_S_RX_PRE_GENCALL_DAT_ACK</a>:
<a name="l00661"></a>00661                 <span class="comment">/*</span>
<a name="l00662"></a>00662 <span class="comment">                 * All data bytes that over-flow the specified receive</span>
<a name="l00663"></a>00663 <span class="comment">                 * data length, just ignore them.</span>
<a name="l00664"></a>00664 <span class="comment">                 */</span>
<a name="l00665"></a>00665                 <span class="keywordflow">if</span> ((txrx_setup-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#f251ff9839684a7ccd7e869d9c8f2c33">rx_count</a> &lt; txrx_setup-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#8418b12cfc7c31321dd7361d20849075">rx_length</a>) \
<a name="l00666"></a>00666                                 &amp;&amp; (txrx_setup-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#8a4e2302651974da84f7b9904e8e1914">rx_data</a> != <a class="code" href="group___l_p_c___types___public___macros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)){
<a name="l00667"></a>00667                         *(uint8_t *)(txrx_setup-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#8a4e2302651974da84f7b9904e8e1914">rx_data</a> + txrx_setup-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#f251ff9839684a7ccd7e869d9c8f2c33">rx_count</a>) = (uint8_t)I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#c8ec35f7911d133683c9ae8f084a6910">I2DAT</a>;
<a name="l00668"></a>00668                         txrx_setup-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#f251ff9839684a7ccd7e869d9c8f2c33">rx_count</a>++;
<a name="l00669"></a>00669                 }
<a name="l00670"></a>00670                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> = <a class="code" href="group___i2_c___private___macros.html#g784c4b2fe7f3299e338655d2ddbf283c">I2C_I2CONSET_AA</a>;
<a name="l00671"></a>00671                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l00672"></a>00672                 <span class="keywordflow">break</span>;
<a name="l00673"></a>00673 
<a name="l00674"></a>00674         <span class="comment">/* Previously addressed with own SLA;</span>
<a name="l00675"></a>00675 <span class="comment">         * DATA byte has been received;</span>
<a name="l00676"></a>00676 <span class="comment">         * NOT ACK has been returned */</span>
<a name="l00677"></a>00677         <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#gce56a90d55426cc6ab2a4ca540c63d02">I2C_I2STAT_S_RX_PRE_SLA_DAT_NACK</a>:
<a name="l00678"></a>00678         <span class="comment">/* DATA has been received, NOT ACK has been returned */</span>
<a name="l00679"></a>00679         <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#g20c65f8a82c18211127e5c335026bd76">I2C_I2STAT_S_RX_PRE_GENCALL_DAT_NACK</a>:
<a name="l00680"></a>00680                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l00681"></a>00681                 <span class="keywordflow">break</span>;
<a name="l00682"></a>00682 
<a name="l00683"></a>00683         <span class="comment">/*</span>
<a name="l00684"></a>00684 <span class="comment">         * Note that: Return code only let us know a stop condition mixed</span>
<a name="l00685"></a>00685 <span class="comment">         * with a repeat start condition in the same code value.</span>
<a name="l00686"></a>00686 <span class="comment">         * So we should provide a time-out. In case this is really a stop</span>
<a name="l00687"></a>00687 <span class="comment">         * condition, this will return back after time out condition. Otherwise,</span>
<a name="l00688"></a>00688 <span class="comment">         * next session that is slave receive data will be completed.</span>
<a name="l00689"></a>00689 <span class="comment">         */</span>
<a name="l00690"></a>00690 
<a name="l00691"></a>00691         <span class="comment">/* A Stop or a repeat start condition */</span>
<a name="l00692"></a>00692         <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#g7afe9f0e54aeb9ce8428c0adeb3c3274">I2C_I2STAT_S_RX_STA_STO_SLVREC_SLVTRX</a>:
<a name="l00693"></a>00693                 <span class="comment">// Temporally lock the interrupt for timeout condition</span>
<a name="l00694"></a>00694                 <a class="code" href="group___i2_c___public___functions.html#gbdabf69925593fb4a7d93f576fe4818b" title="Enable/Disable interrupt for I2C peripheral.">I2C_IntCmd</a>(I2Cx, 0);
<a name="l00695"></a>00695                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l00696"></a>00696                 <span class="comment">// enable time out</span>
<a name="l00697"></a>00697                 timeout = <a class="code" href="group___i2_c___private___macros.html#g33116b352c72ef28879812c66387f17a">I2C_SLAVE_TIME_OUT</a>;
<a name="l00698"></a>00698                 <span class="keywordflow">while</span>(1){
<a name="l00699"></a>00699                         <span class="keywordflow">if</span> (I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> &amp; <a class="code" href="group___i2_c___private___macros.html#ga447cd2686805ef8009fc599144ee3dc">I2C_I2CONSET_SI</a>){
<a name="l00700"></a>00700                                 <span class="comment">// re-Enable interrupt</span>
<a name="l00701"></a>00701                                 <a class="code" href="group___i2_c___public___functions.html#gbdabf69925593fb4a7d93f576fe4818b" title="Enable/Disable interrupt for I2C peripheral.">I2C_IntCmd</a>(I2Cx, 1);
<a name="l00702"></a>00702                                 <span class="keywordflow">break</span>;
<a name="l00703"></a>00703                         } <span class="keywordflow">else</span> {
<a name="l00704"></a>00704                                 timeout--;
<a name="l00705"></a>00705                                 <span class="keywordflow">if</span> (timeout == 0){
<a name="l00706"></a>00706                                         <span class="comment">// timeout occur, it's really a stop condition</span>
<a name="l00707"></a>00707                                         txrx_setup-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#de20423e91627f07e610924cb0081623">status</a> |= <a class="code" href="group___i2_c___private___macros.html#gefbb25ca99e199765e7dcdd6ef343590">I2C_SETUP_STATUS_DONE</a>;
<a name="l00708"></a>00708                                         <span class="keywordflow">goto</span> s_int_end;
<a name="l00709"></a>00709                                 }
<a name="l00710"></a>00710                         }
<a name="l00711"></a>00711                 }
<a name="l00712"></a>00712                 <span class="keywordflow">break</span>;
<a name="l00713"></a>00713 
<a name="l00714"></a>00714         <span class="comment">/* Writing phase -------------------------------------------------------- */</span>
<a name="l00715"></a>00715         <span class="comment">/* Own SLA+R has been received, ACK has been returned */</span>
<a name="l00716"></a>00716         <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#ge6dcbdd1f01f7ebf3595722770e3b7b6">I2C_I2STAT_S_TX_SLAR_ACK</a>:
<a name="l00717"></a>00717         <span class="comment">/* Data has been transmitted, ACK has been received */</span>
<a name="l00718"></a>00718         <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#geb92fe85cc3f6c813cb91685234ac08c">I2C_I2STAT_S_TX_DAT_ACK</a>:
<a name="l00719"></a>00719                 <span class="comment">/*</span>
<a name="l00720"></a>00720 <span class="comment">                 * All data bytes that over-flow the specified receive</span>
<a name="l00721"></a>00721 <span class="comment">                 * data length, just ignore them.</span>
<a name="l00722"></a>00722 <span class="comment">                 */</span>
<a name="l00723"></a>00723                 <span class="keywordflow">if</span> ((txrx_setup-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#45c3d5f3496c906efec9da0935a6a623">tx_count</a> &lt; txrx_setup-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#c0dae38131a0a0786164fe9d1bc8f5a6">tx_length</a>) \
<a name="l00724"></a>00724                                 &amp;&amp; (txrx_setup-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#7668ceccad3cfceb0d2f53330ddea68b">tx_data</a> != <a class="code" href="group___l_p_c___types___public___macros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)){
<a name="l00725"></a>00725                         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#c8ec35f7911d133683c9ae8f084a6910">I2DAT</a> = *(uint8_t *) (txrx_setup-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#7668ceccad3cfceb0d2f53330ddea68b">tx_data</a> + txrx_setup-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#45c3d5f3496c906efec9da0935a6a623">tx_count</a>);
<a name="l00726"></a>00726                         txrx_setup-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#45c3d5f3496c906efec9da0935a6a623">tx_count</a>++;
<a name="l00727"></a>00727                 }
<a name="l00728"></a>00728                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> = <a class="code" href="group___i2_c___private___macros.html#g784c4b2fe7f3299e338655d2ddbf283c">I2C_I2CONSET_AA</a>;
<a name="l00729"></a>00729                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l00730"></a>00730                 <span class="keywordflow">break</span>;
<a name="l00731"></a>00731 
<a name="l00732"></a>00732         <span class="comment">/* Data has been transmitted, NACK has been received,</span>
<a name="l00733"></a>00733 <span class="comment">         * that means there's no more data to send, exit now */</span>
<a name="l00734"></a>00734         <span class="comment">/*</span>
<a name="l00735"></a>00735 <span class="comment">         * Note: Don't wait for stop event since in slave transmit mode,</span>
<a name="l00736"></a>00736 <span class="comment">         * since there no proof lets us know when a stop signal has been received</span>
<a name="l00737"></a>00737 <span class="comment">         * on slave side.</span>
<a name="l00738"></a>00738 <span class="comment">         */</span>
<a name="l00739"></a>00739         <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#gd9cdcd8c06924252a2ad9baced97d838">I2C_I2STAT_S_TX_DAT_NACK</a>:
<a name="l00740"></a>00740                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> = <a class="code" href="group___i2_c___private___macros.html#g784c4b2fe7f3299e338655d2ddbf283c">I2C_I2CONSET_AA</a>;
<a name="l00741"></a>00741                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l00742"></a>00742                 txrx_setup-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#de20423e91627f07e610924cb0081623">status</a> |= <a class="code" href="group___i2_c___private___macros.html#gefbb25ca99e199765e7dcdd6ef343590">I2C_SETUP_STATUS_DONE</a>;
<a name="l00743"></a>00743                 <span class="keywordflow">goto</span> s_int_end;
<a name="l00744"></a>00744 
<a name="l00745"></a>00745         <span class="comment">// Other status must be captured</span>
<a name="l00746"></a>00746         <span class="keywordflow">default</span>:
<a name="l00747"></a>00747 s_int_end:
<a name="l00748"></a>00748                 <span class="comment">// Disable interrupt</span>
<a name="l00749"></a>00749                 <a class="code" href="group___i2_c___public___functions.html#gbdabf69925593fb4a7d93f576fe4818b" title="Enable/Disable interrupt for I2C peripheral.">I2C_IntCmd</a>(I2Cx, 0);
<a name="l00750"></a>00750                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#ga13b19babb8442aa9047f8ecb92a908d">I2C_I2CONCLR_AAC</a> | <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a> | <a class="code" href="group___i2_c___private___macros.html#gb6148bf41d7fc32bd259d2f6a7d7667d">I2C_I2CONCLR_STAC</a>;
<a name="l00751"></a>00751                 I2C_SlaveComplete[tmp] = <a class="code" href="group___l_p_c___types___public___types.html#gg39db6982619d623273fad8a383489309a82764c3079aea4e60c80e45befbb839">TRUE</a>;
<a name="l00752"></a>00752                 <span class="keywordflow">break</span>;
<a name="l00753"></a>00753         }
<a name="l00754"></a>00754 }
<a name="l00755"></a>00755 
<a name="l00756"></a>00756 <span class="comment">/*********************************************************************/</span>
<a name="l00778"></a><a class="code" href="group___i2_c___public___functions.html#g102947f62951ca9031674c3df8117352">00778</a> <a class="code" href="group___l_p_c___types___public___types.html#g67a0db04d321a74b7e7fcfd3f1a3f70b">Status</a> <a class="code" href="group___i2_c___public___functions.html#g102947f62951ca9031674c3df8117352" title="Transmit and Receive data in master mode.">I2C_MasterTransferData</a>(<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a> *I2Cx, <a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html" title="Master transfer setup data structure definitions.">I2C_M_SETUP_Type</a> *TransferCfg, \
<a name="l00779"></a>00779                                                                 <a class="code" href="group___i2_c___public___types.html#gcbdb9912dc18d79d425d9ac7e1333095" title="Transfer option type definitions.">I2C_TRANSFER_OPT_Type</a> Opt)
<a name="l00780"></a>00780 {
<a name="l00781"></a>00781         uint8_t *txdat;
<a name="l00782"></a>00782         uint8_t *rxdat;
<a name="l00783"></a>00783         uint32_t CodeStatus;
<a name="l00784"></a>00784         uint8_t tmp;
<a name="l00785"></a>00785 
<a name="l00786"></a>00786         <span class="comment">// reset all default state</span>
<a name="l00787"></a>00787         txdat = (uint8_t *) TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#7668ceccad3cfceb0d2f53330ddea68b">tx_data</a>;
<a name="l00788"></a>00788         rxdat = (uint8_t *) TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#8a4e2302651974da84f7b9904e8e1914">rx_data</a>;
<a name="l00789"></a>00789         <span class="comment">// Reset I2C setup value to default state</span>
<a name="l00790"></a>00790         TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#45c3d5f3496c906efec9da0935a6a623">tx_count</a> = 0;
<a name="l00791"></a>00791         TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#f251ff9839684a7ccd7e869d9c8f2c33">rx_count</a> = 0;
<a name="l00792"></a>00792         TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#de20423e91627f07e610924cb0081623">status</a> = 0;
<a name="l00793"></a>00793 
<a name="l00794"></a>00794         <span class="keywordflow">if</span> (Opt == <a class="code" href="group___i2_c___public___types.html#ggcbdb9912dc18d79d425d9ac7e1333095705c23545825458561fbfbf83393dc69">I2C_TRANSFER_POLLING</a>){
<a name="l00795"></a>00795 
<a name="l00796"></a>00796                 <span class="comment">/* First Start condition -------------------------------------------------------------- */</span>
<a name="l00797"></a>00797                 TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#a8c340e9707632a8e1d93ce795f7508c">retransmissions_count</a> = 0;
<a name="l00798"></a>00798 retry:
<a name="l00799"></a>00799                 <span class="comment">// reset all default state</span>
<a name="l00800"></a>00800                 txdat = (uint8_t *) TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#7668ceccad3cfceb0d2f53330ddea68b">tx_data</a>;
<a name="l00801"></a>00801                 rxdat = (uint8_t *) TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#8a4e2302651974da84f7b9904e8e1914">rx_data</a>;
<a name="l00802"></a>00802                 <span class="comment">// Reset I2C setup value to default state</span>
<a name="l00803"></a>00803                 TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#45c3d5f3496c906efec9da0935a6a623">tx_count</a> = 0;
<a name="l00804"></a>00804                 TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#f251ff9839684a7ccd7e869d9c8f2c33">rx_count</a> = 0;
<a name="l00805"></a>00805                 CodeStatus = 0;
<a name="l00806"></a>00806 
<a name="l00807"></a>00807                 <span class="comment">// Start command</span>
<a name="l00808"></a>00808                 CodeStatus = I2C_Start(I2Cx);
<a name="l00809"></a>00809                 <span class="keywordflow">if</span> ((CodeStatus != <a class="code" href="group___i2_c___private___macros.html#g5c44c05176052f6040cd40d680bc2a91">I2C_I2STAT_M_TX_START</a>) \
<a name="l00810"></a>00810                                 &amp;&amp; (CodeStatus != <a class="code" href="group___i2_c___private___macros.html#gd41d0d1392b7d905b22b9c5015f2e48f">I2C_I2STAT_M_TX_RESTART</a>)){
<a name="l00811"></a>00811                         TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#a8c340e9707632a8e1d93ce795f7508c">retransmissions_count</a>++;
<a name="l00812"></a>00812                         <span class="keywordflow">if</span> (TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#a8c340e9707632a8e1d93ce795f7508c">retransmissions_count</a> &gt; TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#808bcf1bd88eb24d1e8eda4197d83262">retransmissions_max</a>){
<a name="l00813"></a>00813                                 <span class="comment">// save status</span>
<a name="l00814"></a>00814                                 TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#de20423e91627f07e610924cb0081623">status</a> = CodeStatus;
<a name="l00815"></a>00815                                 <span class="keywordflow">goto</span> error;
<a name="l00816"></a>00816                         } <span class="keywordflow">else</span> {
<a name="l00817"></a>00817                                 <span class="keywordflow">goto</span> retry;
<a name="l00818"></a>00818                         }
<a name="l00819"></a>00819                 }
<a name="l00820"></a>00820 
<a name="l00821"></a>00821                 <span class="comment">/* In case of sending data first --------------------------------------------------- */</span>
<a name="l00822"></a>00822                 <span class="keywordflow">if</span> ((TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#c0dae38131a0a0786164fe9d1bc8f5a6">tx_length</a> != 0) &amp;&amp; (TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#7668ceccad3cfceb0d2f53330ddea68b">tx_data</a> != <a class="code" href="group___l_p_c___types___public___macros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)){
<a name="l00823"></a>00823 
<a name="l00824"></a>00824                         <span class="comment">/* Send slave address + WR direction bit = 0 ----------------------------------- */</span>
<a name="l00825"></a>00825                         CodeStatus = I2C_SendByte(I2Cx, (TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#4902d420a2d1b9715639e7acc5843281">sl_addr7bit</a> &lt;&lt; 1));
<a name="l00826"></a>00826                         <span class="keywordflow">if</span> (CodeStatus != <a class="code" href="group___i2_c___private___macros.html#gb91c158252efeb1a3a139faec3622ae0">I2C_I2STAT_M_TX_SLAW_ACK</a>){
<a name="l00827"></a>00827                                 TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#a8c340e9707632a8e1d93ce795f7508c">retransmissions_count</a>++;
<a name="l00828"></a>00828                                 <span class="keywordflow">if</span> (TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#a8c340e9707632a8e1d93ce795f7508c">retransmissions_count</a> &gt; TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#808bcf1bd88eb24d1e8eda4197d83262">retransmissions_max</a>){
<a name="l00829"></a>00829                                         <span class="comment">// save status</span>
<a name="l00830"></a>00830                                         TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#de20423e91627f07e610924cb0081623">status</a> = CodeStatus | <a class="code" href="group___i2_c___private___macros.html#g90a37b470118d82b9682cfc2e0b4de84">I2C_SETUP_STATUS_NOACKF</a>;
<a name="l00831"></a>00831                                         <span class="keywordflow">goto</span> error;
<a name="l00832"></a>00832                                 } <span class="keywordflow">else</span> {
<a name="l00833"></a>00833                                         <span class="keywordflow">goto</span> retry;
<a name="l00834"></a>00834                                 }
<a name="l00835"></a>00835                         }
<a name="l00836"></a>00836 
<a name="l00837"></a>00837                         <span class="comment">/* Send a number of data bytes ---------------------------------------- */</span>
<a name="l00838"></a>00838                         <span class="keywordflow">while</span> (TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#45c3d5f3496c906efec9da0935a6a623">tx_count</a> &lt; TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#c0dae38131a0a0786164fe9d1bc8f5a6">tx_length</a>)
<a name="l00839"></a>00839                         {
<a name="l00840"></a>00840                                 CodeStatus = I2C_SendByte(I2Cx, *txdat);
<a name="l00841"></a>00841                                 <span class="keywordflow">if</span> (CodeStatus != <a class="code" href="group___i2_c___private___macros.html#gd8c325e3c58aa8e7810797b9a6761596">I2C_I2STAT_M_TX_DAT_ACK</a>){
<a name="l00842"></a>00842                                         TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#a8c340e9707632a8e1d93ce795f7508c">retransmissions_count</a>++;
<a name="l00843"></a>00843                                         <span class="keywordflow">if</span> (TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#a8c340e9707632a8e1d93ce795f7508c">retransmissions_count</a> &gt; TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#808bcf1bd88eb24d1e8eda4197d83262">retransmissions_max</a>){
<a name="l00844"></a>00844                                                 <span class="comment">// save status</span>
<a name="l00845"></a>00845                                                 TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#de20423e91627f07e610924cb0081623">status</a> = CodeStatus | <a class="code" href="group___i2_c___private___macros.html#g90a37b470118d82b9682cfc2e0b4de84">I2C_SETUP_STATUS_NOACKF</a>;
<a name="l00846"></a>00846                                                 <span class="keywordflow">goto</span> error;
<a name="l00847"></a>00847                                         } <span class="keywordflow">else</span> {
<a name="l00848"></a>00848                                                 <span class="keywordflow">goto</span> retry;
<a name="l00849"></a>00849                                         }
<a name="l00850"></a>00850                                 }
<a name="l00851"></a>00851 
<a name="l00852"></a>00852                                 txdat++;
<a name="l00853"></a>00853                                 TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#45c3d5f3496c906efec9da0935a6a623">tx_count</a>++;
<a name="l00854"></a>00854                         }
<a name="l00855"></a>00855                 }
<a name="l00856"></a>00856 
<a name="l00857"></a>00857                 <span class="comment">/* Second Start condition (Repeat Start) ------------------------------------------- */</span>
<a name="l00858"></a>00858                 <span class="keywordflow">if</span> ((TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#c0dae38131a0a0786164fe9d1bc8f5a6">tx_length</a> != 0) &amp;&amp; (TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#7668ceccad3cfceb0d2f53330ddea68b">tx_data</a> != <a class="code" href="group___l_p_c___types___public___macros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) \
<a name="l00859"></a>00859                                 &amp;&amp; (TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#8418b12cfc7c31321dd7361d20849075">rx_length</a> != 0) &amp;&amp; (TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#8a4e2302651974da84f7b9904e8e1914">rx_data</a> != <a class="code" href="group___l_p_c___types___public___macros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)){
<a name="l00860"></a>00860 
<a name="l00861"></a>00861                         CodeStatus = I2C_Start(I2Cx);
<a name="l00862"></a>00862                         <span class="keywordflow">if</span> ((CodeStatus != <a class="code" href="group___i2_c___private___macros.html#gb1f79137c62e306269633b005ad936da">I2C_I2STAT_M_RX_START</a>) \
<a name="l00863"></a>00863                                         &amp;&amp; (CodeStatus != <a class="code" href="group___i2_c___private___macros.html#gcb1c9145acd64a77464017f1dd9279c5">I2C_I2STAT_M_RX_RESTART</a>)){
<a name="l00864"></a>00864                                 TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#a8c340e9707632a8e1d93ce795f7508c">retransmissions_count</a>++;
<a name="l00865"></a>00865                                 <span class="keywordflow">if</span> (TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#a8c340e9707632a8e1d93ce795f7508c">retransmissions_count</a> &gt; TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#808bcf1bd88eb24d1e8eda4197d83262">retransmissions_max</a>){
<a name="l00866"></a>00866                                         <span class="comment">// Update status</span>
<a name="l00867"></a>00867                                         TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#de20423e91627f07e610924cb0081623">status</a> = CodeStatus;
<a name="l00868"></a>00868                                         <span class="keywordflow">goto</span> error;
<a name="l00869"></a>00869                                 } <span class="keywordflow">else</span> {
<a name="l00870"></a>00870                                         <span class="keywordflow">goto</span> retry;
<a name="l00871"></a>00871                                 }
<a name="l00872"></a>00872                         }
<a name="l00873"></a>00873                 }
<a name="l00874"></a>00874 
<a name="l00875"></a>00875                 <span class="comment">/* Then, start reading after sending data -------------------------------------- */</span>
<a name="l00876"></a>00876                 <span class="keywordflow">if</span> ((TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#8418b12cfc7c31321dd7361d20849075">rx_length</a> != 0) &amp;&amp; (TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#8a4e2302651974da84f7b9904e8e1914">rx_data</a> != <a class="code" href="group___l_p_c___types___public___macros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)){
<a name="l00877"></a>00877                         <span class="comment">/* Send slave address + RD direction bit = 1 ----------------------------------- */</span>
<a name="l00878"></a>00878 
<a name="l00879"></a>00879                         CodeStatus = I2C_SendByte(I2Cx, ((TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#4902d420a2d1b9715639e7acc5843281">sl_addr7bit</a> &lt;&lt; 1) | 0x01));
<a name="l00880"></a>00880                         <span class="keywordflow">if</span> (CodeStatus != <a class="code" href="group___i2_c___private___macros.html#gcd29e4a94f8a533477dbbf026c0d525a">I2C_I2STAT_M_RX_SLAR_ACK</a>){
<a name="l00881"></a>00881                                 TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#a8c340e9707632a8e1d93ce795f7508c">retransmissions_count</a>++;
<a name="l00882"></a>00882                                 <span class="keywordflow">if</span> (TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#a8c340e9707632a8e1d93ce795f7508c">retransmissions_count</a> &gt; TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#808bcf1bd88eb24d1e8eda4197d83262">retransmissions_max</a>){
<a name="l00883"></a>00883                                         <span class="comment">// update status</span>
<a name="l00884"></a>00884                                         TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#de20423e91627f07e610924cb0081623">status</a> = CodeStatus | <a class="code" href="group___i2_c___private___macros.html#g90a37b470118d82b9682cfc2e0b4de84">I2C_SETUP_STATUS_NOACKF</a>;
<a name="l00885"></a>00885                                         <span class="keywordflow">goto</span> error;
<a name="l00886"></a>00886                                 } <span class="keywordflow">else</span> {
<a name="l00887"></a>00887                                         <span class="keywordflow">goto</span> retry;
<a name="l00888"></a>00888                                 }
<a name="l00889"></a>00889                         }
<a name="l00890"></a>00890 
<a name="l00891"></a>00891                         <span class="comment">/* Receive a number of data bytes ------------------------------------------------- */</span>
<a name="l00892"></a>00892                         <span class="keywordflow">while</span> (TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#f251ff9839684a7ccd7e869d9c8f2c33">rx_count</a> &lt; TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#8418b12cfc7c31321dd7361d20849075">rx_length</a>){
<a name="l00893"></a>00893 
<a name="l00894"></a>00894                                 <span class="comment">/*</span>
<a name="l00895"></a>00895 <span class="comment">                                 * Note that: if data length is only one, the master should not</span>
<a name="l00896"></a>00896 <span class="comment">                                 * issue an ACK signal on bus after reading to avoid of next data frame</span>
<a name="l00897"></a>00897 <span class="comment">                                 * on slave side</span>
<a name="l00898"></a>00898 <span class="comment">                                 */</span>
<a name="l00899"></a>00899                                 <span class="keywordflow">if</span> (TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#f251ff9839684a7ccd7e869d9c8f2c33">rx_count</a> &lt; (TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#8418b12cfc7c31321dd7361d20849075">rx_length</a> - 1)){
<a name="l00900"></a>00900                                         <span class="comment">// Issue an ACK signal for next data frame</span>
<a name="l00901"></a>00901                                         CodeStatus = I2C_GetByte(I2Cx, &amp;tmp, 1);
<a name="l00902"></a>00902                                         <span class="keywordflow">if</span> (CodeStatus != <a class="code" href="group___i2_c___private___macros.html#g2f07d3cfad351ba3c976d629db20cea2">I2C_I2STAT_M_RX_DAT_ACK</a>){
<a name="l00903"></a>00903                                                 TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#a8c340e9707632a8e1d93ce795f7508c">retransmissions_count</a>++;
<a name="l00904"></a>00904                                                 <span class="keywordflow">if</span> (TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#a8c340e9707632a8e1d93ce795f7508c">retransmissions_count</a> &gt; TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#808bcf1bd88eb24d1e8eda4197d83262">retransmissions_max</a>){
<a name="l00905"></a>00905                                                         <span class="comment">// update status</span>
<a name="l00906"></a>00906                                                         TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#de20423e91627f07e610924cb0081623">status</a> = CodeStatus;
<a name="l00907"></a>00907                                                         <span class="keywordflow">goto</span> error;
<a name="l00908"></a>00908                                                 } <span class="keywordflow">else</span> {
<a name="l00909"></a>00909                                                         <span class="keywordflow">goto</span> retry;
<a name="l00910"></a>00910                                                 }
<a name="l00911"></a>00911                                         }
<a name="l00912"></a>00912                                 } <span class="keywordflow">else</span> {
<a name="l00913"></a>00913                                         <span class="comment">// Do not issue an ACK signal</span>
<a name="l00914"></a>00914                                         CodeStatus = I2C_GetByte(I2Cx, &amp;tmp, 0);
<a name="l00915"></a>00915                                         <span class="keywordflow">if</span> (CodeStatus != <a class="code" href="group___i2_c___private___macros.html#g9cc5203175775bfa5ae6df5d6d98b014">I2C_I2STAT_M_RX_DAT_NACK</a>){
<a name="l00916"></a>00916                                                 TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#a8c340e9707632a8e1d93ce795f7508c">retransmissions_count</a>++;
<a name="l00917"></a>00917                                                 <span class="keywordflow">if</span> (TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#a8c340e9707632a8e1d93ce795f7508c">retransmissions_count</a> &gt; TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#808bcf1bd88eb24d1e8eda4197d83262">retransmissions_max</a>){
<a name="l00918"></a>00918                                                         <span class="comment">// update status</span>
<a name="l00919"></a>00919                                                         TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#de20423e91627f07e610924cb0081623">status</a> = CodeStatus;
<a name="l00920"></a>00920                                                         <span class="keywordflow">goto</span> error;
<a name="l00921"></a>00921                                                 } <span class="keywordflow">else</span> {
<a name="l00922"></a>00922                                                         <span class="keywordflow">goto</span> retry;
<a name="l00923"></a>00923                                                 }
<a name="l00924"></a>00924                                         }
<a name="l00925"></a>00925                                 }
<a name="l00926"></a>00926                                 *rxdat++ = tmp;
<a name="l00927"></a>00927                                 TransferCfg-&gt;<a class="code" href="struct_i2_c___m___s_e_t_u_p___type.html#f251ff9839684a7ccd7e869d9c8f2c33">rx_count</a>++;
<a name="l00928"></a>00928                         }
<a name="l00929"></a>00929                 }
<a name="l00930"></a>00930 
<a name="l00931"></a>00931                 <span class="comment">/* Send STOP condition ------------------------------------------------- */</span>
<a name="l00932"></a>00932                 I2C_Stop(I2Cx);
<a name="l00933"></a>00933                 <span class="keywordflow">return</span> <a class="code" href="group___l_p_c___types___public___types.html#gg67a0db04d321a74b7e7fcfd3f1a3f70bc7f69f7c9e5aea9b8f54cf02870e2bf8">SUCCESS</a>;
<a name="l00934"></a>00934 
<a name="l00935"></a>00935 error:
<a name="l00936"></a>00936                 <span class="comment">// Send stop condition</span>
<a name="l00937"></a>00937                 I2C_Stop(I2Cx);
<a name="l00938"></a>00938                 <span class="keywordflow">return</span> <a class="code" href="group___l_p_c___types___public___types.html#gg67a0db04d321a74b7e7fcfd3f1a3f70b2fd6f336d08340583bd620a7f5694c90">ERROR</a>;
<a name="l00939"></a>00939         }
<a name="l00940"></a>00940 
<a name="l00941"></a>00941         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Opt == <a class="code" href="group___i2_c___public___types.html#ggcbdb9912dc18d79d425d9ac7e1333095dcf6aee8de975dd710d711e590f3a753">I2C_TRANSFER_INTERRUPT</a>){
<a name="l00942"></a>00942                 <span class="comment">// Setup tx_rx data, callback and interrupt handler</span>
<a name="l00943"></a>00943                 tmp = I2C_getNum(I2Cx);
<a name="l00944"></a>00944                 i2cdat[tmp].<a class="code" href="struct_i2_c___c_f_g___t.html#5a6738809adc0b29a2277731c5b50b3b">txrx_setup</a> = (uint32_t) TransferCfg;
<a name="l00945"></a>00945                 <span class="comment">// Set direction phase, write first</span>
<a name="l00946"></a>00946                 i2cdat[tmp].<a class="code" href="struct_i2_c___c_f_g___t.html#6e623499d0c8b2090741bf433769d9fe">dir</a> = 0;
<a name="l00947"></a>00947 
<a name="l00948"></a>00948                 <span class="comment">/* First Start condition -------------------------------------------------------------- */</span>
<a name="l00949"></a>00949                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l00950"></a>00950                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> = <a class="code" href="group___i2_c___private___macros.html#gbaad3370eb35644c135d40f06adbbba0">I2C_I2CONSET_STA</a>;
<a name="l00951"></a>00951                 <a class="code" href="group___i2_c___public___functions.html#gbdabf69925593fb4a7d93f576fe4818b" title="Enable/Disable interrupt for I2C peripheral.">I2C_IntCmd</a>(I2Cx, 1);
<a name="l00952"></a>00952 
<a name="l00953"></a>00953                 <span class="keywordflow">return</span> (<a class="code" href="group___l_p_c___types___public___types.html#gg67a0db04d321a74b7e7fcfd3f1a3f70bc7f69f7c9e5aea9b8f54cf02870e2bf8">SUCCESS</a>);
<a name="l00954"></a>00954         }
<a name="l00955"></a>00955 
<a name="l00956"></a>00956         <span class="keywordflow">return</span> <a class="code" href="group___l_p_c___types___public___types.html#gg67a0db04d321a74b7e7fcfd3f1a3f70b2fd6f336d08340583bd620a7f5694c90">ERROR</a>;
<a name="l00957"></a>00957 }
<a name="l00958"></a>00958 
<a name="l00959"></a>00959 <span class="comment">/*********************************************************************/</span>
<a name="l00990"></a><a class="code" href="group___i2_c___public___functions.html#gb855dcf9fa8a95da591c532dbb92af31">00990</a> <a class="code" href="group___l_p_c___types___public___types.html#g67a0db04d321a74b7e7fcfd3f1a3f70b">Status</a> <a class="code" href="group___i2_c___public___functions.html#gb855dcf9fa8a95da591c532dbb92af31" title="Receive and Transmit data in slave mode.">I2C_SlaveTransferData</a>(<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a> *I2Cx, <a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html" title="Slave transfer setup data structure definitions.">I2C_S_SETUP_Type</a> *TransferCfg, \
<a name="l00991"></a>00991                                                                 <a class="code" href="group___i2_c___public___types.html#gcbdb9912dc18d79d425d9ac7e1333095" title="Transfer option type definitions.">I2C_TRANSFER_OPT_Type</a> Opt)
<a name="l00992"></a>00992 {
<a name="l00993"></a>00993         uint8_t *txdat;
<a name="l00994"></a>00994         uint8_t *rxdat;
<a name="l00995"></a>00995         uint32_t CodeStatus;
<a name="l00996"></a>00996         uint32_t timeout;
<a name="l00997"></a>00997         int32_t time_en;
<a name="l00998"></a>00998         int32_t tmp;
<a name="l00999"></a>00999 
<a name="l01000"></a>01000         <span class="comment">// reset all default state</span>
<a name="l01001"></a>01001         txdat = (uint8_t *) TransferCfg-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#7668ceccad3cfceb0d2f53330ddea68b">tx_data</a>;
<a name="l01002"></a>01002         rxdat = (uint8_t *) TransferCfg-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#8a4e2302651974da84f7b9904e8e1914">rx_data</a>;
<a name="l01003"></a>01003         <span class="comment">// Reset I2C setup value to default state</span>
<a name="l01004"></a>01004         TransferCfg-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#45c3d5f3496c906efec9da0935a6a623">tx_count</a> = 0;
<a name="l01005"></a>01005         TransferCfg-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#f251ff9839684a7ccd7e869d9c8f2c33">rx_count</a> = 0;
<a name="l01006"></a>01006         TransferCfg-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#de20423e91627f07e610924cb0081623">status</a> = 0;
<a name="l01007"></a>01007 
<a name="l01008"></a>01008 
<a name="l01009"></a>01009         <span class="comment">// Polling option</span>
<a name="l01010"></a>01010         <span class="keywordflow">if</span> (Opt == <a class="code" href="group___i2_c___public___types.html#ggcbdb9912dc18d79d425d9ac7e1333095705c23545825458561fbfbf83393dc69">I2C_TRANSFER_POLLING</a>){
<a name="l01011"></a>01011 
<a name="l01012"></a>01012                 <span class="comment">/* Set AA bit to ACK command on I2C bus */</span>
<a name="l01013"></a>01013                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> = <a class="code" href="group___i2_c___private___macros.html#g784c4b2fe7f3299e338655d2ddbf283c">I2C_I2CONSET_AA</a>;
<a name="l01014"></a>01014                 <span class="comment">/* Clear SI bit to be ready ... */</span>
<a name="l01015"></a>01015                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = (<a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a> | <a class="code" href="group___i2_c___private___macros.html#gb6148bf41d7fc32bd259d2f6a7d7667d">I2C_I2CONCLR_STAC</a>);
<a name="l01016"></a>01016 
<a name="l01017"></a>01017                 time_en = 0;
<a name="l01018"></a>01018                 timeout = 0;
<a name="l01019"></a>01019 
<a name="l01020"></a>01020                 <span class="keywordflow">while</span> (1)
<a name="l01021"></a>01021                 {
<a name="l01022"></a>01022                         <span class="comment">/* Check SI flag ready */</span>
<a name="l01023"></a>01023                         <span class="keywordflow">if</span> (I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> &amp; <a class="code" href="group___i2_c___private___macros.html#ga447cd2686805ef8009fc599144ee3dc">I2C_I2CONSET_SI</a>)
<a name="l01024"></a>01024                         {
<a name="l01025"></a>01025                                 time_en = 0;
<a name="l01026"></a>01026 
<a name="l01027"></a>01027                                 <span class="keywordflow">switch</span> (CodeStatus = (I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#2a09f39bce73931b86d4622cdfa10835">I2STAT</a> &amp; <a class="code" href="group___i2_c___private___macros.html#gfeb8b5f682a81a2cc32f6c4b720a5e1f">I2C_STAT_CODE_BITMASK</a>))
<a name="l01028"></a>01028                                 {
<a name="l01029"></a>01029 
<a name="l01030"></a>01030                                 <span class="comment">/* No status information */</span>
<a name="l01031"></a>01031                                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#g3e2ecdeb466041bb3cf435ccf36564d9">I2C_I2STAT_NO_INF</a>:
<a name="l01032"></a>01032                                         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> = <a class="code" href="group___i2_c___private___macros.html#g784c4b2fe7f3299e338655d2ddbf283c">I2C_I2CONSET_AA</a>;
<a name="l01033"></a>01033                                         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l01034"></a>01034                                         <span class="keywordflow">break</span>;
<a name="l01035"></a>01035 
<a name="l01036"></a>01036                                 <span class="comment">/* Reading phase -------------------------------------------------------- */</span>
<a name="l01037"></a>01037                                 <span class="comment">/* Own SLA+R has been received, ACK has been returned */</span>
<a name="l01038"></a>01038                                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#g7055c4b55feda352df8016cbca0c270b">I2C_I2STAT_S_RX_SLAW_ACK</a>:
<a name="l01039"></a>01039                                 <span class="comment">/* General call address has been received, ACK has been returned */</span>
<a name="l01040"></a>01040                                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#gdcab34e87ad115c011e23a5bd4fb8aa3">I2C_I2STAT_S_RX_GENCALL_ACK</a>:
<a name="l01041"></a>01041                                         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> = <a class="code" href="group___i2_c___private___macros.html#g784c4b2fe7f3299e338655d2ddbf283c">I2C_I2CONSET_AA</a>;
<a name="l01042"></a>01042                                         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l01043"></a>01043                                         <span class="keywordflow">break</span>;
<a name="l01044"></a>01044 
<a name="l01045"></a>01045                                 <span class="comment">/* Previously addressed with own SLA;</span>
<a name="l01046"></a>01046 <span class="comment">                                 * DATA byte has been received;</span>
<a name="l01047"></a>01047 <span class="comment">                                 * ACK has been returned */</span>
<a name="l01048"></a>01048                                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#g4342227592c3e2e345517bd3e6cd8089">I2C_I2STAT_S_RX_PRE_SLA_DAT_ACK</a>:
<a name="l01049"></a>01049                                 <span class="comment">/* DATA has been received, ACK hasn been return */</span>
<a name="l01050"></a>01050                                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#g75dd46ddb054c4d47a531b8e90f7f446">I2C_I2STAT_S_RX_PRE_GENCALL_DAT_ACK</a>:
<a name="l01051"></a>01051                                         <span class="comment">/*</span>
<a name="l01052"></a>01052 <span class="comment">                                         * All data bytes that over-flow the specified receive</span>
<a name="l01053"></a>01053 <span class="comment">                                         * data length, just ignore them.</span>
<a name="l01054"></a>01054 <span class="comment">                                         */</span>
<a name="l01055"></a>01055                                         <span class="keywordflow">if</span> ((TransferCfg-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#f251ff9839684a7ccd7e869d9c8f2c33">rx_count</a> &lt; TransferCfg-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#8418b12cfc7c31321dd7361d20849075">rx_length</a>) \
<a name="l01056"></a>01056                                                         &amp;&amp; (TransferCfg-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#8a4e2302651974da84f7b9904e8e1914">rx_data</a> != <a class="code" href="group___l_p_c___types___public___macros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)){
<a name="l01057"></a>01057                                                 *rxdat++ = (uint8_t)I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#c8ec35f7911d133683c9ae8f084a6910">I2DAT</a>;
<a name="l01058"></a>01058                                                 TransferCfg-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#f251ff9839684a7ccd7e869d9c8f2c33">rx_count</a>++;
<a name="l01059"></a>01059                                         }
<a name="l01060"></a>01060                                         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> = <a class="code" href="group___i2_c___private___macros.html#g784c4b2fe7f3299e338655d2ddbf283c">I2C_I2CONSET_AA</a>;
<a name="l01061"></a>01061                                         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l01062"></a>01062                                         <span class="keywordflow">break</span>;
<a name="l01063"></a>01063 
<a name="l01064"></a>01064                                 <span class="comment">/* Previously addressed with own SLA;</span>
<a name="l01065"></a>01065 <span class="comment">                                 * DATA byte has been received;</span>
<a name="l01066"></a>01066 <span class="comment">                                 * NOT ACK has been returned */</span>
<a name="l01067"></a>01067                                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#gce56a90d55426cc6ab2a4ca540c63d02">I2C_I2STAT_S_RX_PRE_SLA_DAT_NACK</a>:
<a name="l01068"></a>01068                                 <span class="comment">/* DATA has been received, NOT ACK has been returned */</span>
<a name="l01069"></a>01069                                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#g20c65f8a82c18211127e5c335026bd76">I2C_I2STAT_S_RX_PRE_GENCALL_DAT_NACK</a>:
<a name="l01070"></a>01070                                         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l01071"></a>01071                                         <span class="keywordflow">break</span>;
<a name="l01072"></a>01072 
<a name="l01073"></a>01073                                 <span class="comment">/*</span>
<a name="l01074"></a>01074 <span class="comment">                                 * Note that: Return code only let us know a stop condition mixed</span>
<a name="l01075"></a>01075 <span class="comment">                                 * with a repeat start condition in the same code value.</span>
<a name="l01076"></a>01076 <span class="comment">                                 * So we should provide a time-out. In case this is really a stop</span>
<a name="l01077"></a>01077 <span class="comment">                                 * condition, this will return back after time out condition. Otherwise,</span>
<a name="l01078"></a>01078 <span class="comment">                                 * next session that is slave receive data will be completed.</span>
<a name="l01079"></a>01079 <span class="comment">                                 */</span>
<a name="l01080"></a>01080 
<a name="l01081"></a>01081                                 <span class="comment">/* A Stop or a repeat start condition */</span>
<a name="l01082"></a>01082                                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#g7afe9f0e54aeb9ce8428c0adeb3c3274">I2C_I2STAT_S_RX_STA_STO_SLVREC_SLVTRX</a>:
<a name="l01083"></a>01083                                         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l01084"></a>01084                                         <span class="comment">// enable time out</span>
<a name="l01085"></a>01085                                         time_en = 1;
<a name="l01086"></a>01086                                         timeout = 0;
<a name="l01087"></a>01087                                         <span class="keywordflow">break</span>;
<a name="l01088"></a>01088 
<a name="l01089"></a>01089                                 <span class="comment">/* Writing phase -------------------------------------------------------- */</span>
<a name="l01090"></a>01090                                 <span class="comment">/* Own SLA+R has been received, ACK has been returned */</span>
<a name="l01091"></a>01091                                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#ge6dcbdd1f01f7ebf3595722770e3b7b6">I2C_I2STAT_S_TX_SLAR_ACK</a>:
<a name="l01092"></a>01092                                 <span class="comment">/* Data has been transmitted, ACK has been received */</span>
<a name="l01093"></a>01093                                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#geb92fe85cc3f6c813cb91685234ac08c">I2C_I2STAT_S_TX_DAT_ACK</a>:
<a name="l01094"></a>01094                                         <span class="comment">/*</span>
<a name="l01095"></a>01095 <span class="comment">                                         * All data bytes that over-flow the specified receive</span>
<a name="l01096"></a>01096 <span class="comment">                                         * data length, just ignore them.</span>
<a name="l01097"></a>01097 <span class="comment">                                         */</span>
<a name="l01098"></a>01098                                         <span class="keywordflow">if</span> ((TransferCfg-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#45c3d5f3496c906efec9da0935a6a623">tx_count</a> &lt; TransferCfg-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#c0dae38131a0a0786164fe9d1bc8f5a6">tx_length</a>) \
<a name="l01099"></a>01099                                                         &amp;&amp; (TransferCfg-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#7668ceccad3cfceb0d2f53330ddea68b">tx_data</a> != <a class="code" href="group___l_p_c___types___public___macros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)){
<a name="l01100"></a>01100                                                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#c8ec35f7911d133683c9ae8f084a6910">I2DAT</a> = *txdat++;
<a name="l01101"></a>01101                                                 TransferCfg-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#45c3d5f3496c906efec9da0935a6a623">tx_count</a>++;
<a name="l01102"></a>01102                                         }
<a name="l01103"></a>01103                                         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> = <a class="code" href="group___i2_c___private___macros.html#g784c4b2fe7f3299e338655d2ddbf283c">I2C_I2CONSET_AA</a>;
<a name="l01104"></a>01104                                         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l01105"></a>01105                                         <span class="keywordflow">break</span>;
<a name="l01106"></a>01106 
<a name="l01107"></a>01107                                 <span class="comment">/* Data has been transmitted, NACK has been received,</span>
<a name="l01108"></a>01108 <span class="comment">                                 * that means there's no more data to send, exit now */</span>
<a name="l01109"></a>01109                                 <span class="comment">/*</span>
<a name="l01110"></a>01110 <span class="comment">                                 * Note: Don't wait for stop event since in slave transmit mode,</span>
<a name="l01111"></a>01111 <span class="comment">                                 * since there no proof lets us know when a stop signal has been received</span>
<a name="l01112"></a>01112 <span class="comment">                                 * on slave side.</span>
<a name="l01113"></a>01113 <span class="comment">                                 */</span>
<a name="l01114"></a>01114                                 <span class="keywordflow">case</span> <a class="code" href="group___i2_c___private___macros.html#gd9cdcd8c06924252a2ad9baced97d838">I2C_I2STAT_S_TX_DAT_NACK</a>:
<a name="l01115"></a>01115                                         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> = <a class="code" href="group___i2_c___private___macros.html#g784c4b2fe7f3299e338655d2ddbf283c">I2C_I2CONSET_AA</a>;
<a name="l01116"></a>01116                                         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l01117"></a>01117                                         <span class="comment">// enable time out</span>
<a name="l01118"></a>01118                                         time_en = 1;
<a name="l01119"></a>01119                                         timeout = 0;
<a name="l01120"></a>01120                                         <span class="keywordflow">break</span>;
<a name="l01121"></a>01121 
<a name="l01122"></a>01122                                 <span class="comment">// Other status must be captured</span>
<a name="l01123"></a>01123                                 <span class="keywordflow">default</span>:
<a name="l01124"></a>01124                                         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l01125"></a>01125                                         <span class="keywordflow">goto</span> s_error;
<a name="l01126"></a>01126                                 }
<a name="l01127"></a>01127                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (time_en){
<a name="l01128"></a>01128                                 <span class="keywordflow">if</span> (timeout++ &gt; <a class="code" href="group___i2_c___private___macros.html#g33116b352c72ef28879812c66387f17a">I2C_SLAVE_TIME_OUT</a>){
<a name="l01129"></a>01129                                         <span class="comment">// it's really a stop condition, goto end stage</span>
<a name="l01130"></a>01130                                         <span class="keywordflow">goto</span> s_end_stage;
<a name="l01131"></a>01131                                 }
<a name="l01132"></a>01132                         }
<a name="l01133"></a>01133                 }
<a name="l01134"></a>01134 
<a name="l01135"></a>01135 s_end_stage:
<a name="l01136"></a>01136                 <span class="comment">/* Clear AA bit to disable ACK on I2C bus */</span>
<a name="l01137"></a>01137                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#ga13b19babb8442aa9047f8ecb92a908d">I2C_I2CONCLR_AAC</a>;
<a name="l01138"></a>01138                 <span class="comment">// Check if there's no error during operation</span>
<a name="l01139"></a>01139                 <span class="comment">// Update status</span>
<a name="l01140"></a>01140                 TransferCfg-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#de20423e91627f07e610924cb0081623">status</a> = CodeStatus | <a class="code" href="group___i2_c___private___macros.html#gefbb25ca99e199765e7dcdd6ef343590">I2C_SETUP_STATUS_DONE</a>;
<a name="l01141"></a>01141                 <span class="keywordflow">return</span> <a class="code" href="group___l_p_c___types___public___types.html#gg67a0db04d321a74b7e7fcfd3f1a3f70bc7f69f7c9e5aea9b8f54cf02870e2bf8">SUCCESS</a>;
<a name="l01142"></a>01142 
<a name="l01143"></a>01143 s_error:
<a name="l01144"></a>01144                 <span class="comment">/* Clear AA bit to disable ACK on I2C bus */</span>
<a name="l01145"></a>01145                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#ga13b19babb8442aa9047f8ecb92a908d">I2C_I2CONCLR_AAC</a>;
<a name="l01146"></a>01146                 <span class="comment">// Update status</span>
<a name="l01147"></a>01147                 TransferCfg-&gt;<a class="code" href="struct_i2_c___s___s_e_t_u_p___type.html#de20423e91627f07e610924cb0081623">status</a> = CodeStatus;
<a name="l01148"></a>01148                 <span class="keywordflow">return</span> <a class="code" href="group___l_p_c___types___public___types.html#gg67a0db04d321a74b7e7fcfd3f1a3f70b2fd6f336d08340583bd620a7f5694c90">ERROR</a>;
<a name="l01149"></a>01149         }
<a name="l01150"></a>01150 
<a name="l01151"></a>01151         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Opt == <a class="code" href="group___i2_c___public___types.html#ggcbdb9912dc18d79d425d9ac7e1333095dcf6aee8de975dd710d711e590f3a753">I2C_TRANSFER_INTERRUPT</a>){
<a name="l01152"></a>01152                 <span class="comment">// Setup tx_rx data, callback and interrupt handler</span>
<a name="l01153"></a>01153                 tmp = I2C_getNum(I2Cx);
<a name="l01154"></a>01154                 i2cdat[tmp].<a class="code" href="struct_i2_c___c_f_g___t.html#5a6738809adc0b29a2277731c5b50b3b">txrx_setup</a> = (uint32_t) TransferCfg;
<a name="l01155"></a>01155                 <span class="comment">// Set direction phase, read first</span>
<a name="l01156"></a>01156                 i2cdat[tmp].<a class="code" href="struct_i2_c___c_f_g___t.html#6e623499d0c8b2090741bf433769d9fe">dir</a> = 1;
<a name="l01157"></a>01157 
<a name="l01158"></a>01158                 <span class="comment">// Enable AA</span>
<a name="l01159"></a>01159                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> = <a class="code" href="group___i2_c___private___macros.html#g784c4b2fe7f3299e338655d2ddbf283c">I2C_I2CONSET_AA</a>;
<a name="l01160"></a>01160                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a> | <a class="code" href="group___i2_c___private___macros.html#gb6148bf41d7fc32bd259d2f6a7d7667d">I2C_I2CONCLR_STAC</a>;
<a name="l01161"></a>01161                 <a class="code" href="group___i2_c___public___functions.html#gbdabf69925593fb4a7d93f576fe4818b" title="Enable/Disable interrupt for I2C peripheral.">I2C_IntCmd</a>(I2Cx, 1);
<a name="l01162"></a>01162 
<a name="l01163"></a>01163                 <span class="keywordflow">return</span> (<a class="code" href="group___l_p_c___types___public___types.html#gg67a0db04d321a74b7e7fcfd3f1a3f70bc7f69f7c9e5aea9b8f54cf02870e2bf8">SUCCESS</a>);
<a name="l01164"></a>01164         }
<a name="l01165"></a>01165 
<a name="l01166"></a>01166         <span class="keywordflow">return</span> <a class="code" href="group___l_p_c___types___public___types.html#gg67a0db04d321a74b7e7fcfd3f1a3f70b2fd6f336d08340583bd620a7f5694c90">ERROR</a>;
<a name="l01167"></a>01167 }
<a name="l01168"></a>01168 
<a name="l01169"></a>01169 <span class="comment">/*********************************************************************/</span>
<a name="l01181"></a><a class="code" href="group___i2_c___public___functions.html#g04a15375bbb68c96a97279b192ee7a5a">01181</a> <span class="keywordtype">void</span> <a class="code" href="group___i2_c___public___functions.html#g04a15375bbb68c96a97279b192ee7a5a" title="Set Own slave address in I2C peripheral corresponding to parameter specified in OwnSlaveAddrConfigSt...">I2C_SetOwnSlaveAddr</a>(<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a> *I2Cx, <a class="code" href="struct_i2_c___o_w_n_s_l_a_v_e_a_d_d_r___c_f_g___type.html" title="I2C Own slave address setting structure.">I2C_OWNSLAVEADDR_CFG_Type</a> *OwnSlaveAddrConfigStruct)
<a name="l01182"></a>01182 {
<a name="l01183"></a>01183         uint32_t tmp;
<a name="l01184"></a>01184         <a class="code" href="group___l_i_b_c_f_g___d_e_f_a_u_l_t___public___macros.html#g9d8414ced01feedb3238e5ffb3c1961f">CHECK_PARAM</a>(<a class="code" href="group___i2_c___private___macros.html#g27fcdfae701f8ce7ec72e5b1f8cd0511">PARAM_I2Cx</a>(I2Cx));
<a name="l01185"></a>01185         <a class="code" href="group___l_i_b_c_f_g___d_e_f_a_u_l_t___public___macros.html#g9d8414ced01feedb3238e5ffb3c1961f">CHECK_PARAM</a>(<a class="code" href="group___i2_c___private___macros.html#g48e3b6b2fe2e7cf9e500c23aac343a99">PARAM_I2C_SLAVEADDR_CH</a>(OwnSlaveAddrConfigStruct-&gt;<a class="code" href="struct_i2_c___o_w_n_s_l_a_v_e_a_d_d_r___c_f_g___type.html#ff00368cf36351f2ec4e17327951eb7f">SlaveAddrChannel</a>));
<a name="l01186"></a>01186         <a class="code" href="group___l_i_b_c_f_g___d_e_f_a_u_l_t___public___macros.html#g9d8414ced01feedb3238e5ffb3c1961f">CHECK_PARAM</a>(<a class="code" href="group___l_p_c___types___public___types.html#g5475435ea985fe5abbf2048e87e3e682">PARAM_FUNCTIONALSTATE</a>(OwnSlaveAddrConfigStruct-&gt;<a class="code" href="struct_i2_c___o_w_n_s_l_a_v_e_a_d_d_r___c_f_g___type.html#8501ffa892984871e67b19088785299a">GeneralCallState</a>));
<a name="l01187"></a>01187 
<a name="l01188"></a>01188         tmp = (((uint32_t)(OwnSlaveAddrConfigStruct-&gt;<a class="code" href="struct_i2_c___o_w_n_s_l_a_v_e_a_d_d_r___c_f_g___type.html#efeb974677b767d84c5129ae6cffd0c0">SlaveAddr_7bit</a> &lt;&lt; 1)) \
<a name="l01189"></a>01189                         | ((OwnSlaveAddrConfigStruct-&gt;<a class="code" href="struct_i2_c___o_w_n_s_l_a_v_e_a_d_d_r___c_f_g___type.html#8501ffa892984871e67b19088785299a">GeneralCallState</a> == <a class="code" href="group___l_p_c___types___public___types.html#ggc9a7e9a35d2513ec15c3b537aaa4fba17d46875fa3ebd2c34d2756950eda83bf">ENABLE</a>) ? 0x01 : 0x00))&amp; <a class="code" href="group___i2_c___private___macros.html#g8d5195514172b58efd29f09642566d37">I2C_I2ADR_BITMASK</a>;
<a name="l01190"></a>01190         <span class="keywordflow">switch</span> (OwnSlaveAddrConfigStruct-&gt;<a class="code" href="struct_i2_c___o_w_n_s_l_a_v_e_a_d_d_r___c_f_g___type.html#ff00368cf36351f2ec4e17327951eb7f">SlaveAddrChannel</a>)
<a name="l01191"></a>01191         {
<a name="l01192"></a>01192         <span class="keywordflow">case</span> 0:
<a name="l01193"></a>01193                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#f85260a4fe70df7416fa237724746220">I2ADR0</a> = tmp;
<a name="l01194"></a>01194                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#f7801f1d7c26af0236ab95d08fca1dfc">I2MASK0</a> = <a class="code" href="group___i2_c___private___macros.html#g697da3f892d87fc247d6e1afafac5a34">I2C_I2MASK_MASK</a>((uint32_t) \
<a name="l01195"></a>01195                                 (OwnSlaveAddrConfigStruct-&gt;<a class="code" href="struct_i2_c___o_w_n_s_l_a_v_e_a_d_d_r___c_f_g___type.html#1c6fcdd559aa053a369b6eb485c4be29">SlaveAddrMaskValue</a>));
<a name="l01196"></a>01196                 <span class="keywordflow">break</span>;
<a name="l01197"></a>01197         <span class="keywordflow">case</span> 1:
<a name="l01198"></a>01198                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#5c165b86b2fe7ad801527da86383968f">I2ADR1</a> = tmp;
<a name="l01199"></a>01199                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#303cbd023964c7a7bb61093983082356">I2MASK1</a> = <a class="code" href="group___i2_c___private___macros.html#g697da3f892d87fc247d6e1afafac5a34">I2C_I2MASK_MASK</a>((uint32_t) \
<a name="l01200"></a>01200                                 (OwnSlaveAddrConfigStruct-&gt;<a class="code" href="struct_i2_c___o_w_n_s_l_a_v_e_a_d_d_r___c_f_g___type.html#1c6fcdd559aa053a369b6eb485c4be29">SlaveAddrMaskValue</a>));
<a name="l01201"></a>01201                 <span class="keywordflow">break</span>;
<a name="l01202"></a>01202         <span class="keywordflow">case</span> 2:
<a name="l01203"></a>01203                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#8912df6f13a6ce5a68f2764e2f9dad4c">I2ADR2</a> = tmp;
<a name="l01204"></a>01204                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#2fa9b16e7f2554c154b81fdb6f1fb02c">I2MASK2</a> = <a class="code" href="group___i2_c___private___macros.html#g697da3f892d87fc247d6e1afafac5a34">I2C_I2MASK_MASK</a>((uint32_t) \
<a name="l01205"></a>01205                                 (OwnSlaveAddrConfigStruct-&gt;<a class="code" href="struct_i2_c___o_w_n_s_l_a_v_e_a_d_d_r___c_f_g___type.html#1c6fcdd559aa053a369b6eb485c4be29">SlaveAddrMaskValue</a>));
<a name="l01206"></a>01206                 <span class="keywordflow">break</span>;
<a name="l01207"></a>01207         <span class="keywordflow">case</span> 3:
<a name="l01208"></a>01208                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d19d57ef6d53f71208c9087d99223b99">I2ADR3</a> = tmp;
<a name="l01209"></a>01209                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#71d746955fd744b1e5d368fded6e68c1">I2MASK3</a> = <a class="code" href="group___i2_c___private___macros.html#g697da3f892d87fc247d6e1afafac5a34">I2C_I2MASK_MASK</a>((uint32_t) \
<a name="l01210"></a>01210                                 (OwnSlaveAddrConfigStruct-&gt;<a class="code" href="struct_i2_c___o_w_n_s_l_a_v_e_a_d_d_r___c_f_g___type.html#1c6fcdd559aa053a369b6eb485c4be29">SlaveAddrMaskValue</a>));
<a name="l01211"></a>01211                 <span class="keywordflow">break</span>;
<a name="l01212"></a>01212         }
<a name="l01213"></a>01213 }
<a name="l01214"></a>01214 
<a name="l01215"></a>01215 
<a name="l01216"></a>01216 <span class="comment">/*********************************************************************/</span>
<a name="l01234"></a><a class="code" href="group___i2_c___public___functions.html#gef7e2d007e73a69844eafebfbc3e6862">01234</a> <span class="keywordtype">void</span> <a class="code" href="group___i2_c___public___functions.html#gef7e2d007e73a69844eafebfbc3e6862" title="Configures functionality in I2C monitor mode.">I2C_MonitorModeConfig</a>(<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a> *I2Cx, uint32_t MonitorCfgType, <a class="code" href="group___l_p_c___types___public___types.html#gc9a7e9a35d2513ec15c3b537aaa4fba1" title="Functional State Definition.">FunctionalState</a> NewState)
<a name="l01235"></a>01235 {
<a name="l01236"></a>01236         <a class="code" href="group___l_i_b_c_f_g___d_e_f_a_u_l_t___public___macros.html#g9d8414ced01feedb3238e5ffb3c1961f">CHECK_PARAM</a>(<a class="code" href="group___i2_c___private___macros.html#g27fcdfae701f8ce7ec72e5b1f8cd0511">PARAM_I2Cx</a>(I2Cx));
<a name="l01237"></a>01237         <a class="code" href="group___l_i_b_c_f_g___d_e_f_a_u_l_t___public___macros.html#g9d8414ced01feedb3238e5ffb3c1961f">CHECK_PARAM</a>(<a class="code" href="group___i2_c___private___macros.html#ge73e3b7919f9a726a0d8f275077e23d2">PARAM_I2C_MONITOR_CFG</a>(MonitorCfgType));
<a name="l01238"></a>01238         <a class="code" href="group___l_i_b_c_f_g___d_e_f_a_u_l_t___public___macros.html#g9d8414ced01feedb3238e5ffb3c1961f">CHECK_PARAM</a>(<a class="code" href="group___l_p_c___types___public___types.html#g5475435ea985fe5abbf2048e87e3e682">PARAM_FUNCTIONALSTATE</a>(NewState));
<a name="l01239"></a>01239 
<a name="l01240"></a>01240         <span class="keywordflow">if</span> (NewState == <a class="code" href="group___l_p_c___types___public___types.html#ggc9a7e9a35d2513ec15c3b537aaa4fba17d46875fa3ebd2c34d2756950eda83bf">ENABLE</a>)
<a name="l01241"></a>01241         {
<a name="l01242"></a>01242                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#7b8c95de23b4a42be73bcfe8f434b61e">MMCTRL</a> |= MonitorCfgType;
<a name="l01243"></a>01243         }
<a name="l01244"></a>01244         <span class="keywordflow">else</span>
<a name="l01245"></a>01245         {
<a name="l01246"></a>01246                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#7b8c95de23b4a42be73bcfe8f434b61e">MMCTRL</a> &amp;= (~MonitorCfgType) &amp; <a class="code" href="group___i2_c___private___macros.html#gdca0b6beb066a8f6689960c687334ac2">I2C_I2MMCTRL_BITMASK</a>;
<a name="l01247"></a>01247         }
<a name="l01248"></a>01248 }
<a name="l01249"></a>01249 
<a name="l01250"></a>01250 
<a name="l01251"></a>01251 <span class="comment">/*********************************************************************/</span>
<a name="l01262"></a><a class="code" href="group___i2_c___public___functions.html#g236d51a39fe46151b144b56f3d5d465a">01262</a> <span class="keywordtype">void</span> <a class="code" href="group___i2_c___public___functions.html#g236d51a39fe46151b144b56f3d5d465a" title="Enable/Disable I2C monitor mode.">I2C_MonitorModeCmd</a>(<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a> *I2Cx, <a class="code" href="group___l_p_c___types___public___types.html#gc9a7e9a35d2513ec15c3b537aaa4fba1" title="Functional State Definition.">FunctionalState</a> NewState)
<a name="l01263"></a>01263 {
<a name="l01264"></a>01264         <a class="code" href="group___l_i_b_c_f_g___d_e_f_a_u_l_t___public___macros.html#g9d8414ced01feedb3238e5ffb3c1961f">CHECK_PARAM</a>(<a class="code" href="group___i2_c___private___macros.html#g27fcdfae701f8ce7ec72e5b1f8cd0511">PARAM_I2Cx</a>(I2Cx));
<a name="l01265"></a>01265         <a class="code" href="group___l_i_b_c_f_g___d_e_f_a_u_l_t___public___macros.html#g9d8414ced01feedb3238e5ffb3c1961f">CHECK_PARAM</a>(<a class="code" href="group___l_p_c___types___public___types.html#g5475435ea985fe5abbf2048e87e3e682">PARAM_FUNCTIONALSTATE</a>(NewState));
<a name="l01266"></a>01266 
<a name="l01267"></a>01267         <span class="keywordflow">if</span> (NewState == <a class="code" href="group___l_p_c___types___public___types.html#ggc9a7e9a35d2513ec15c3b537aaa4fba17d46875fa3ebd2c34d2756950eda83bf">ENABLE</a>)
<a name="l01268"></a>01268         {
<a name="l01269"></a>01269                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#7b8c95de23b4a42be73bcfe8f434b61e">MMCTRL</a> |= <a class="code" href="group___i2_c___private___macros.html#g8dc8fa566a5113c3e1b35c0580d90d9f">I2C_I2MMCTRL_MM_ENA</a>;
<a name="l01270"></a>01270                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#d84770992196d46f6293f908e66963de">I2CONSET</a> = <a class="code" href="group___i2_c___private___macros.html#g784c4b2fe7f3299e338655d2ddbf283c">I2C_I2CONSET_AA</a>;
<a name="l01271"></a>01271                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a> | <a class="code" href="group___i2_c___private___macros.html#gb6148bf41d7fc32bd259d2f6a7d7667d">I2C_I2CONCLR_STAC</a>;
<a name="l01272"></a>01272         }
<a name="l01273"></a>01273         <span class="keywordflow">else</span>
<a name="l01274"></a>01274         {
<a name="l01275"></a>01275                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#7b8c95de23b4a42be73bcfe8f434b61e">MMCTRL</a> &amp;= (~<a class="code" href="group___i2_c___private___macros.html#g8dc8fa566a5113c3e1b35c0580d90d9f">I2C_I2MMCTRL_MM_ENA</a>) &amp; <a class="code" href="group___i2_c___private___macros.html#gdca0b6beb066a8f6689960c687334ac2">I2C_I2MMCTRL_BITMASK</a>;
<a name="l01276"></a>01276                 I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a> | <a class="code" href="group___i2_c___private___macros.html#gb6148bf41d7fc32bd259d2f6a7d7667d">I2C_I2CONCLR_STAC</a> | <a class="code" href="group___i2_c___private___macros.html#ga13b19babb8442aa9047f8ecb92a908d">I2C_I2CONCLR_AAC</a>;
<a name="l01277"></a>01277         }
<a name="l01278"></a>01278         I2C_MonitorBufferIndex = 0;
<a name="l01279"></a>01279 }
<a name="l01280"></a>01280 
<a name="l01281"></a>01281 
<a name="l01282"></a>01282 <span class="comment">/*********************************************************************/</span>
<a name="l01297"></a><a class="code" href="group___i2_c___public___functions.html#geef5efb68afc2a65ffa08572d46fd472">01297</a> uint8_t <a class="code" href="group___i2_c___public___functions.html#geef5efb68afc2a65ffa08572d46fd472" title="Get data from I2C data buffer in monitor mode.">I2C_MonitorGetDatabuffer</a>(<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a> *I2Cx)
<a name="l01298"></a>01298 {
<a name="l01299"></a>01299         <a class="code" href="group___l_i_b_c_f_g___d_e_f_a_u_l_t___public___macros.html#g9d8414ced01feedb3238e5ffb3c1961f">CHECK_PARAM</a>(<a class="code" href="group___i2_c___private___macros.html#g27fcdfae701f8ce7ec72e5b1f8cd0511">PARAM_I2Cx</a>(I2Cx));
<a name="l01300"></a>01300         <span class="keywordflow">return</span> ((uint8_t)(I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#712d81f6c517ee9d9069f3a8695cbf09">I2DATA_BUFFER</a>));
<a name="l01301"></a>01301 }
<a name="l01302"></a>01302 
<a name="l01303"></a>01303 <span class="comment">/*********************************************************************/</span>
<a name="l01318"></a><a class="code" href="group___i2_c___public___functions.html#ga8f87a55b16bacca9110c11ff285d3f9">01318</a> <a class="code" href="group___l_p_c___types___public___types.html#g39db6982619d623273fad8a383489309" title="Boolean Type definition.">BOOL_8</a> <a class="code" href="group___i2_c___public___functions.html#ga8f87a55b16bacca9110c11ff285d3f9" title="Get data from I2C data buffer in monitor mode.">I2C_MonitorHandler</a>(<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a> *I2Cx, uint8_t *<a class="code" href="group___i2_c___monitor.html#g97eaba5b61706891a4da114bde40da4d">buffer</a>, uint32_t size)
<a name="l01319"></a>01319 {
<a name="l01320"></a>01320         <a class="code" href="group___l_p_c___types___public___types.html#g39db6982619d623273fad8a383489309" title="Boolean Type definition.">BOOL_8</a> ret=<a class="code" href="group___l_p_c___types___public___types.html#gg39db6982619d623273fad8a383489309a1e095cc966dbecf6a0d8aad75348d1a">FALSE</a>;
<a name="l01321"></a>01321 
<a name="l01322"></a>01322         I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#0e7d222bb0f8ca1993c8a83490a42eb9">I2CONCLR</a> = <a class="code" href="group___i2_c___private___macros.html#g36753112210a8c33d566b572b63b753b">I2C_I2CONCLR_SIC</a>;
<a name="l01323"></a>01323 
<a name="l01324"></a>01324         buffer[I2C_MonitorBufferIndex] = (uint8_t)(I2Cx-&gt;<a class="code" href="struct_l_p_c___i2_c___type_def.html#712d81f6c517ee9d9069f3a8695cbf09">I2DATA_BUFFER</a>);
<a name="l01325"></a>01325         I2C_MonitorBufferIndex++;
<a name="l01326"></a>01326         <span class="keywordflow">if</span>(I2C_MonitorBufferIndex &gt;= size)
<a name="l01327"></a>01327         {
<a name="l01328"></a>01328                 ret = <a class="code" href="group___l_p_c___types___public___types.html#gg39db6982619d623273fad8a383489309a82764c3079aea4e60c80e45befbb839">TRUE</a>;
<a name="l01329"></a>01329         }
<a name="l01330"></a>01330         <span class="keywordflow">return</span> ret;
<a name="l01331"></a>01331 }
<a name="l01332"></a>01332 <span class="comment">/*********************************************************************/</span>
<a name="l01342"></a><a class="code" href="group___i2_c___public___functions.html#gaad67181341bcd015c958f7d21420d01">01342</a> uint32_t <a class="code" href="group___i2_c___public___functions.html#gaad67181341bcd015c958f7d21420d01" title="Get status of Master Transfer.">I2C_MasterTransferComplete</a>(<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a> *I2Cx)
<a name="l01343"></a>01343 {
<a name="l01344"></a>01344         uint32_t retval, tmp;
<a name="l01345"></a>01345         tmp = I2C_getNum(I2Cx);
<a name="l01346"></a>01346         retval = I2C_MasterComplete[tmp];
<a name="l01347"></a>01347         I2C_MasterComplete[tmp] = <a class="code" href="group___l_p_c___types___public___types.html#gg39db6982619d623273fad8a383489309a1e095cc966dbecf6a0d8aad75348d1a">FALSE</a>;
<a name="l01348"></a>01348         <span class="keywordflow">return</span> retval;
<a name="l01349"></a>01349 }
<a name="l01350"></a>01350 
<a name="l01351"></a>01351 <span class="comment">/*********************************************************************/</span>
<a name="l01359"></a><a class="code" href="group___i2_c___public___functions.html#g6380268c476af8b17b7ef13f05e404d4">01359</a> uint32_t <a class="code" href="group___i2_c___public___functions.html#g6380268c476af8b17b7ef13f05e404d4" title="Get status of Slave Transfer.">I2C_SlaveTransferComplete</a>(<a class="code" href="struct_l_p_c___i2_c___type_def.html" title="Inter-Integrated Circuit (I2C) register structure definition.">LPC_I2C_TypeDef</a> *I2Cx)
<a name="l01360"></a>01360 {
<a name="l01361"></a>01361         uint32_t retval, tmp;
<a name="l01362"></a>01362         tmp = I2C_getNum(I2Cx);
<a name="l01363"></a>01363         retval = I2C_SlaveComplete[tmp];
<a name="l01364"></a>01364         I2C_SlaveComplete[tmp] = <a class="code" href="group___l_p_c___types___public___types.html#gg39db6982619d623273fad8a383489309a1e095cc966dbecf6a0d8aad75348d1a">FALSE</a>;
<a name="l01365"></a>01365         <span class="keywordflow">return</span> retval;
<a name="l01366"></a>01366 }
<a name="l01367"></a>01367 
<a name="l01368"></a>01368 
<a name="l01369"></a>01369 
<a name="l01374"></a>01374 <span class="preprocessor">#endif </span><span class="comment">/* _I2C */</span>
<a name="l01375"></a>01375 
<a name="l01380"></a>01380 <span class="comment">/* --------------------------------- End Of File ------------------------------ */</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Tue Jun 7 14:58:56 2011 for LPC1700CMSIS Standard Peripheral Firmware Library Manual by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9 </small></address>
</body>
</html>
