<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>LPC1700CMSIS Standard Peripheral Firmware Library Manual: C:/nxpdrv/LPC1700CMSIS/Examples/SPI/SDCard/spi_sdcard.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>C:/nxpdrv/LPC1700CMSIS/Examples/SPI/SDCard/spi_sdcard.c</h1><a href="spi__sdcard_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/**********************************************************************</span>
<a name="l00002"></a>00002 <span class="comment">* $Id$          spi_sdcard.c                                    2010-07-16</span>
<a name="l00003"></a>00003 <span class="comment">*/</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include "<a class="code" href="lpc17xx__spi_8h.html" title="Contains all macro definitions and function prototypes support for SPI firmware library...">lpc17xx_spi.h</a>"</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include "<a class="code" href="_s_p_i_2_s_d_card_2lpc17xx__libcfg_8h.html">lpc17xx_libcfg.h</a>"</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include "<a class="code" href="lpc17xx__pinsel_8h.html" title="Contains all macro definitions and function prototypes support for Pin connect block...">lpc17xx_pinsel.h</a>"</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include "<a class="code" href="debug__frmwrk_8h.html" title="Contains some utilities that used for debugging through UART.">debug_frmwrk.h</a>"</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include "<a class="code" href="lpc17xx__gpio_8h.html" title="Contains all macro definitions and function prototypes support for GPDMA firmware...">lpc17xx_gpio.h</a>"</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="comment">/* Example group ----------------------------------------------------------- */</span>
<a name="l00037"></a>00037 <span class="comment">/************************** PRIVATE DEFINTIONS *********************/</span>
<a name="l00038"></a>00038 <span class="comment">// PORT number that /CS pin assigned on</span>
<a name="l00039"></a><a class="code" href="group___s_p_i___s_d_card.html#gd4c80b355a7cd4bb8334b5ccf3e4a24b">00039</a> <span class="preprocessor">#define CS_PORT_NUM             0</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span><span class="comment">// PIN number that  /CS pin assigned on</span>
<a name="l00041"></a><a class="code" href="group___s_p_i___s_d_card.html#g744e83c43991ae773f194a7f04abefc8">00041</a> <span class="preprocessor">#define CS_PIN_NUM              16</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span>
<a name="l00043"></a><a class="code" href="group___s_p_i___s_d_card.html#gfb9b535a0fc3727cf47e4a37f6fadfa4">00043</a> <span class="preprocessor">#define SD_DETECT_PORTNUM       4</span>
<a name="l00044"></a><a class="code" href="group___s_p_i___s_d_card.html#gb212725e70141a97e62b355094bd3f52">00044</a> <span class="preprocessor"></span><span class="preprocessor">#define SD_DETECT_PINNUM        29</span>
<a name="l00045"></a><a class="code" href="group___s_p_i___s_d_card.html#g2c1606342bd0b857424958bfc36a5254">00045</a> <span class="preprocessor"></span><span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="group___s_p_i___s_d_card.html#g2c1606342bd0b857424958bfc36a5254">_sd_connect_status</a>
<a name="l00046"></a>00046 {
<a name="l00047"></a><a class="code" href="group___s_p_i___s_d_card.html#gg2c1606342bd0b857424958bfc36a5254a2df00e890098d475da7acedf8457084">00047</a>         <a class="code" href="group___s_p_i___s_d_card.html#gg2c1606342bd0b857424958bfc36a5254a2df00e890098d475da7acedf8457084">SD_CONNECTED</a>,
<a name="l00048"></a><a class="code" href="group___s_p_i___s_d_card.html#gg2c1606342bd0b857424958bfc36a52544d073e4438d1f03994973553fc8c3790">00048</a>         <a class="code" href="group___s_p_i___s_d_card.html#gg2c1606342bd0b857424958bfc36a52544d073e4438d1f03994973553fc8c3790">SD_DISCONNECTED</a>
<a name="l00049"></a>00049 }<a class="code" href="group___s_p_i___s_d_card.html#g5a7175ce83822b34319bbe16f2acc652">sd_connect_status</a>;
<a name="l00050"></a><a class="code" href="group___s_p_i___s_d_card.html#g45cc84e68509cb2865ddec5210c8dcec">00050</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="group___s_p_i___s_d_card.html#g45cc84e68509cb2865ddec5210c8dcec">_sd_error</a>
<a name="l00051"></a>00051 {
<a name="l00052"></a><a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcece7d9e30a15fd1bc4b2cd8f10208e76a6">00052</a>         <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcece7d9e30a15fd1bc4b2cd8f10208e76a6">SD_OK</a>,
<a name="l00053"></a><a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcecfa798f433b94c8a4375a49313a405fc3">00053</a>         <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcecfa798f433b94c8a4375a49313a405fc3">SD_NG</a>,
<a name="l00054"></a><a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dceca7950dcb479d57ff645d8d046aa7c92a">00054</a>         <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dceca7950dcb479d57ff645d8d046aa7c92a">SD_CMD_BAD_PARAMETER</a>,
<a name="l00055"></a><a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcece2b14cd528dcb716254e54a6b86d96bc">00055</a>         <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcece2b14cd528dcb716254e54a6b86d96bc">SD_ERROR_TOKEN</a>,
<a name="l00056"></a><a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcec0c2e159ea7414c76ff20c7be29624f84">00056</a>         <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcec0c2e159ea7414c76ff20c7be29624f84">SD_ERROR_TIMEOUT</a>,
<a name="l00057"></a><a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcecb66e1a75bcadbf8abeaa5ba3d2b6e2b7">00057</a>         <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcecb66e1a75bcadbf8abeaa5ba3d2b6e2b7">SD_ERROR_BUS_NOT_IDLE</a>,
<a name="l00058"></a><a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcec524565f26d36be976827f81adb02a091">00058</a>         <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcec524565f26d36be976827f81adb02a091">SD_ERROR_CMD0</a>,
<a name="l00059"></a><a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcec9dccbd3d346ce0a5a5651674467cd5d8">00059</a>         <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcec9dccbd3d346ce0a5a5651674467cd5d8">SD_ERROR_CMD55</a>,
<a name="l00060"></a><a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcec35df7b040b5ed42c9a12a5f3c4c08381">00060</a>         <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcec35df7b040b5ed42c9a12a5f3c4c08381">SD_ERROR_ACMD41</a>,
<a name="l00061"></a><a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcec160bce3eab4006dd38c321ed15f96114">00061</a>         <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcec160bce3eab4006dd38c321ed15f96114">SD_ERROR_CMD59</a>
<a name="l00062"></a>00062 }<a class="code" href="group___s_p_i___s_d_card.html#g34d33cc449d35e52930dfc894c497bd6">sd_error</a>;
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="comment">//SD command code</span>
<a name="l00065"></a><a class="code" href="group___s_p_i___s_d_card.html#g6efae6b4179548b393d8d3287ee46b33">00065</a> <span class="preprocessor">#define         CMD0_GO_IDLE_STATE            0x00</span>
<a name="l00066"></a><a class="code" href="group___s_p_i___s_d_card.html#g5479a88d4818ef6ae69dae65d27a9312">00066</a> <span class="preprocessor"></span><span class="preprocessor">#define         CMD1_SEND_OPCOND              0x01</span>
<a name="l00067"></a><a class="code" href="group___s_p_i___s_d_card.html#gf5bfe98a35ecd9c6ca532df3d108ba60">00067</a> <span class="preprocessor"></span><span class="preprocessor">#define         CMD9_SEND_CSD                 0x09</span>
<a name="l00068"></a><a class="code" href="group___s_p_i___s_d_card.html#g217cf3d6bad3b6d8032790d402f9f04b">00068</a> <span class="preprocessor"></span><span class="preprocessor">#define         CMD10_SEND_CID                0x0a</span>
<a name="l00069"></a><a class="code" href="group___s_p_i___s_d_card.html#gc4dd649fad294213bfba58ed2a0fb232">00069</a> <span class="preprocessor"></span><span class="preprocessor">#define         CMD12_STOP_TRANSMISSION       0x0b</span>
<a name="l00070"></a><a class="code" href="group___s_p_i___s_d_card.html#g79526d3c4d732d53c02c16675d953b9e">00070</a> <span class="preprocessor"></span><span class="preprocessor">#define         CMD13_SEND_STATUS             0x0c</span>
<a name="l00071"></a><a class="code" href="group___s_p_i___s_d_card.html#gee254c9ad8824c066b6cd6d87dec6d46">00071</a> <span class="preprocessor"></span><span class="preprocessor">#define         CMD16_SET_BLOCKLEN            0x10</span>
<a name="l00072"></a><a class="code" href="group___s_p_i___s_d_card.html#g7ed0381da2eda9065d97895969098549">00072</a> <span class="preprocessor"></span><span class="preprocessor">#define         CMD17_READ_SINGLE_BLOCK       0x11</span>
<a name="l00073"></a><a class="code" href="group___s_p_i___s_d_card.html#gdc2db19be05702b6aea0da1ff059b993">00073</a> <span class="preprocessor"></span><span class="preprocessor">#define         CMD18_READ_MULTIPLE_BLOCK     0x12</span>
<a name="l00074"></a><a class="code" href="group___s_p_i___s_d_card.html#ge45acc1124221882530230b57cef9057">00074</a> <span class="preprocessor"></span><span class="preprocessor">#define         CMD24_WRITE_BLOCK             0x18</span>
<a name="l00075"></a><a class="code" href="group___s_p_i___s_d_card.html#gdf847aea0270dee6893ac0b3ab2500f1">00075</a> <span class="preprocessor"></span><span class="preprocessor">#define         CMD25_WRITE_MULTIPLE_BLOCK    0x19</span>
<a name="l00076"></a><a class="code" href="group___s_p_i___s_d_card.html#g080b8935163987c65626560870e8f63d">00076</a> <span class="preprocessor"></span><span class="preprocessor">#define         CMD27_PROGRAM_CSD             0x1b</span>
<a name="l00077"></a><a class="code" href="group___s_p_i___s_d_card.html#g7fa1388d6dd91a8ba13a389474f357c6">00077</a> <span class="preprocessor"></span><span class="preprocessor">#define         CMD28_SET_WRITE_PROT          0x1c</span>
<a name="l00078"></a><a class="code" href="group___s_p_i___s_d_card.html#gc881a2283b2922cc99976e0c2e94bd58">00078</a> <span class="preprocessor"></span><span class="preprocessor">#define         CMD29_CLR_WRITE_PROT          0x1d</span>
<a name="l00079"></a><a class="code" href="group___s_p_i___s_d_card.html#gde0742fefce6cad40c2a172982075ace">00079</a> <span class="preprocessor"></span><span class="preprocessor">#define         CMD30_SEND_WRITE_PROT         0x1e</span>
<a name="l00080"></a><a class="code" href="group___s_p_i___s_d_card.html#gee4b54ffb4c73b1f05c6e8d65a54ea12">00080</a> <span class="preprocessor"></span><span class="preprocessor">#define         CMD32_ERASE_WR_BLK_START_ADDR 0x20</span>
<a name="l00081"></a><a class="code" href="group___s_p_i___s_d_card.html#g2e27a618540020c7c2281f0f2372553d">00081</a> <span class="preprocessor"></span><span class="preprocessor">#define         CMD33_ERASE_WR_BLK_END_ADDR   0x21</span>
<a name="l00082"></a><a class="code" href="group___s_p_i___s_d_card.html#g015e0378031523318d36801a6a389961">00082</a> <span class="preprocessor"></span><span class="preprocessor">#define         CMD38_ERASE                   0x26</span>
<a name="l00083"></a><a class="code" href="group___s_p_i___s_d_card.html#g539a0c7178704c361dbd6db67b49b1f0">00083</a> <span class="preprocessor"></span><span class="preprocessor">#define         CMD55_APP_CMD                 0x37</span>
<a name="l00084"></a><a class="code" href="group___s_p_i___s_d_card.html#g4a7df936655282960516fefe3ef1d937">00084</a> <span class="preprocessor"></span><span class="preprocessor">#define         CMD56_GEN_CMD                 0x38</span>
<a name="l00085"></a><a class="code" href="group___s_p_i___s_d_card.html#g57035771c558728316b2fdbb7e436864">00085</a> <span class="preprocessor"></span><span class="preprocessor">#define         CMD58_READ_OCR                0x3a</span>
<a name="l00086"></a><a class="code" href="group___s_p_i___s_d_card.html#gbab165d386978705dbdb655e2fee70de">00086</a> <span class="preprocessor"></span><span class="preprocessor">#define         CMD59_CRC_ON_OFF              0x3b</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span><span class="comment">/* Application-specific commands (always prefixed with CMD55_APP_CMD) */</span>
<a name="l00088"></a><a class="code" href="group___s_p_i___s_d_card.html#ge0acda0c03e5df3070bfdf3af4119cab">00088</a> <span class="preprocessor">#define         ACMD13_SD_STATUS              0x0d</span>
<a name="l00089"></a><a class="code" href="group___s_p_i___s_d_card.html#gf7328b0e8ec7d68486814af9581f3ca6">00089</a> <span class="preprocessor"></span><span class="preprocessor">#define         ACMD22_SEND_NUM_WR_BLOCKS     0x16</span>
<a name="l00090"></a><a class="code" href="group___s_p_i___s_d_card.html#gaa451af4e9e8a03f9a12db86e5d4f80f">00090</a> <span class="preprocessor"></span><span class="preprocessor">#define         ACMD23_SET_WR_BLK_ERASE_COUNT 0x17</span>
<a name="l00091"></a><a class="code" href="group___s_p_i___s_d_card.html#g1d41aed2ec04c2727af04103c6077128">00091</a> <span class="preprocessor"></span><span class="preprocessor">#define         ACMD41_SEND_OP_COND           0x29</span>
<a name="l00092"></a><a class="code" href="group___s_p_i___s_d_card.html#gee0a93a111f2760743c32013fce3936a">00092</a> <span class="preprocessor"></span><span class="preprocessor">#define         ACMD42_SET_CLR_CARD_DETECT    0x2a</span>
<a name="l00093"></a><a class="code" href="group___s_p_i___s_d_card.html#g3f37eb20d5557f0f39bf450b107ee5bc">00093</a> <span class="preprocessor"></span><span class="preprocessor">#define         ACMD51_SEND_SCR               0x33</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span><span class="comment">/* R1 format responses (ORed together as a bit-field) */</span>
<a name="l00095"></a><a class="code" href="group___s_p_i___s_d_card.html#g5a2e747f6080d118c365fdf804f462e1">00095</a> <span class="preprocessor">#define         R1_NOERROR                                0x00</span>
<a name="l00096"></a><a class="code" href="group___s_p_i___s_d_card.html#gdee7c13eaeccaf3a5e695387c1715ce7">00096</a> <span class="preprocessor"></span><span class="preprocessor">#define         R1_IDLE                                   0x01</span>
<a name="l00097"></a><a class="code" href="group___s_p_i___s_d_card.html#gb9b211488ddf19ee9ddc3f6abd512727">00097</a> <span class="preprocessor"></span><span class="preprocessor">#define         R1_ERASE                                  0x02</span>
<a name="l00098"></a><a class="code" href="group___s_p_i___s_d_card.html#g3e8052d21ba41d1e1dbb2ddca40d66c4">00098</a> <span class="preprocessor"></span><span class="preprocessor">#define         R1_ILLEGAL                                0x04</span>
<a name="l00099"></a><a class="code" href="group___s_p_i___s_d_card.html#g3a4b96ee1e5f0d6363b04b91e9564db3">00099</a> <span class="preprocessor"></span><span class="preprocessor">#define         R1_CRC_ERR                                0x08</span>
<a name="l00100"></a><a class="code" href="group___s_p_i___s_d_card.html#g0d39d2f0d6fd5d85955e1879faa30f83">00100</a> <span class="preprocessor"></span><span class="preprocessor">#define         R1_ERASE_SEQ                              0x10</span>
<a name="l00101"></a><a class="code" href="group___s_p_i___s_d_card.html#gcddc49cd8dbfdcb8f75a5b2727cdbf45">00101</a> <span class="preprocessor"></span><span class="preprocessor">#define         R1_ADDR_ERR                               0x20</span>
<a name="l00102"></a><a class="code" href="group___s_p_i___s_d_card.html#gf0b23cd8567677a01aa824b958999d74">00102</a> <span class="preprocessor"></span><span class="preprocessor">#define         R1_PARAM_ERR                              0x40</span>
<a name="l00103"></a>00103 <span class="preprocessor"></span><span class="comment">/* R2 format responses - second byte only, first is identical to R1 */</span>
<a name="l00104"></a><a class="code" href="group___s_p_i___s_d_card.html#gec9cb46741865f0014132a1b019f9fae">00104</a> <span class="preprocessor">#define         R2_LOCKED                                 0x01</span>
<a name="l00105"></a><a class="code" href="group___s_p_i___s_d_card.html#g6224f3876a63bb6ee6add0d1793f4e75">00105</a> <span class="preprocessor"></span><span class="preprocessor">#define         R2_WP_FAILED                              0x02</span>
<a name="l00106"></a><a class="code" href="group___s_p_i___s_d_card.html#gba7435c2df88d039da0b89b9421175cd">00106</a> <span class="preprocessor"></span><span class="preprocessor">#define         R2_ERROR                                  0x04</span>
<a name="l00107"></a><a class="code" href="group___s_p_i___s_d_card.html#g5862d5a041aa3e5aa7e8efe3bb0c37f5">00107</a> <span class="preprocessor"></span><span class="preprocessor">#define         R2_CTRL_ERR                               0x08</span>
<a name="l00108"></a><a class="code" href="group___s_p_i___s_d_card.html#g0af8e3ef59a7929e819221df36a232f5">00108</a> <span class="preprocessor"></span><span class="preprocessor">#define         R2_ECC_FAIL                               0x10</span>
<a name="l00109"></a><a class="code" href="group___s_p_i___s_d_card.html#g48f9906160871c5d5177be6b3c9f1d88">00109</a> <span class="preprocessor"></span><span class="preprocessor">#define         R2_WP_VIOL                                0x20</span>
<a name="l00110"></a><a class="code" href="group___s_p_i___s_d_card.html#g52d4f424efb7d9c65da3284ba1c192eb">00110</a> <span class="preprocessor"></span><span class="preprocessor">#define         R2_ERASE_PARAM                            0x40</span>
<a name="l00111"></a><a class="code" href="group___s_p_i___s_d_card.html#gcccb33f7c0c0aa2ea8cc23404a2c5787">00111</a> <span class="preprocessor"></span><span class="preprocessor">#define         R2_RANGE_ERR                              0x80</span>
<a name="l00112"></a>00112 <span class="preprocessor"></span>
<a name="l00113"></a><a class="code" href="group___s_p_i___s_d_card.html#g26f62735f75be5802a9cba8111a408f3">00113</a> <span class="preprocessor">#define GETBIT(in, bit) ((in &amp; (1&lt;&lt;bit)) &gt;&gt; bit)</span>
<a name="l00114"></a><a class="code" href="group___s_p_i___s_d_card.html#gd141d93ccd42520fbbba9bc37ea9a761">00114</a> <span class="preprocessor"></span><span class="preprocessor">#define SD_CMD_BLOCK_LENGTH             6</span>
<a name="l00115"></a><a class="code" href="group___s_p_i___s_d_card.html#ga2e82e419b9b43e364aebf8d6b8d8af0">00115</a> <span class="preprocessor"></span><span class="preprocessor">#define SD_DATA_BLOCK_LENGTH    515</span>
<a name="l00116"></a><a class="code" href="group___s_p_i___s_d_card.html#g1ee53c036f04852ec2b7cb4332da0cb1">00116</a> <span class="preprocessor"></span><span class="preprocessor">#define SD_WAIT_R1_TIMEOUT              100000</span>
<a name="l00117"></a>00117 <span class="preprocessor"></span><span class="comment">/************************** PRIVATE VARIABLES *************************/</span>
<a name="l00118"></a><a class="code" href="group___s_p_i___s_d_card.html#gc2c0f1959d26e8b438a32d3ac3212731">00118</a> uint8_t <a class="code" href="group___a_d_c___burst.html#gc2c0f1959d26e8b438a32d3ac3212731">menu1</a>[] =
<a name="l00119"></a>00119 <span class="stringliteral">"********************************************************************************\n\r"</span>
<a name="l00120"></a>00120 <span class="stringliteral">"Hello NXP Semiconductors \n\r"</span>
<a name="l00121"></a>00121 <span class="stringliteral">"SPI communicate with SD card demo \n\r"</span>
<a name="l00122"></a>00122 <span class="stringliteral">"\t - MCU: LPC17xx \n\r"</span>
<a name="l00123"></a>00123 <span class="stringliteral">"\t - Core: ARM Cortex-M3 \n\r"</span>
<a name="l00124"></a>00124 <span class="stringliteral">"\t - Communicate via: UART0 - 115200bps \n\r"</span>
<a name="l00125"></a>00125 <span class="stringliteral">" Demo SPI module, read SD card's CID register and display via UART0\n\r"</span>
<a name="l00126"></a>00126 <span class="stringliteral">"********************************************************************************\n\r"</span>;
<a name="l00127"></a>00127 <span class="comment">// SPI Configuration structure variable</span>
<a name="l00128"></a><a class="code" href="group___s_p_i___s_d_card.html#g72a3cd9e19813b44f66d4a3207494faf">00128</a> <a class="code" href="struct_s_p_i___c_f_g___type.html" title="SPI configuration structure.">SPI_CFG_Type</a> <a class="code" href="group___s_p_i___loop_back.html#g72a3cd9e19813b44f66d4a3207494faf">SPI_ConfigStruct</a>;
<a name="l00129"></a>00129 <span class="comment">// SPI Data Setup structure variable</span>
<a name="l00130"></a><a class="code" href="group___s_p_i___s_d_card.html#g7ac4c2dc2de56621710d8406249723aa">00130</a> <a class="code" href="struct_s_p_i___d_a_t_a___s_e_t_u_p___type.html" title="SPI Data configuration structure definitions.">SPI_DATA_SETUP_Type</a> <a class="code" href="group___s_p_i__sc16is750__int.html#g7ac4c2dc2de56621710d8406249723aa">xferConfig</a>;
<a name="l00131"></a>00131 
<a name="l00132"></a><a class="code" href="group___s_p_i___s_d_card.html#gb1696331b67ee097a470e6c12a57b442">00132</a> uint8_t <a class="code" href="group___s_p_i___s_d_card.html#gb1696331b67ee097a470e6c12a57b442">sd_cmd_buf</a>[<a class="code" href="group___s_p_i___s_d_card.html#gd141d93ccd42520fbbba9bc37ea9a761">SD_CMD_BLOCK_LENGTH</a>];
<a name="l00133"></a><a class="code" href="group___s_p_i___s_d_card.html#ge8a254cacac2f309f89ff5b0de5a5639">00133</a> uint8_t <a class="code" href="group___s_p_i___s_d_card.html#ge8a254cacac2f309f89ff5b0de5a5639">sd_data_buf</a>[<a class="code" href="group___s_p_i___s_d_card.html#ga2e82e419b9b43e364aebf8d6b8d8af0">SD_DATA_BLOCK_LENGTH</a>];
<a name="l00134"></a>00134 <span class="comment">/************************** PRIVATE FUNCTIONS *************************/</span>
<a name="l00135"></a>00135 <span class="keywordtype">void</span> <a class="code" href="group___s_p_i___master.html#gb3ad33fe379379962edd4c549bbc9ffa" title="Initialize CS pin as GPIO function to drive /CS pin due to definition of CS_PORT_NUM...">CS_Init</a>(<span class="keywordtype">void</span>);
<a name="l00136"></a>00136 <span class="keywordtype">void</span> <a class="code" href="group___s_p_i___master.html#g4f2e4a350f9a2791aa8542f222fb161f" title="Drive CS output pin to low/high level to select slave device via /CS pin state.">CS_Force</a>(int32_t state);
<a name="l00137"></a>00137 <span class="keywordtype">void</span> <a class="code" href="group___a_d_c___burst.html#g3d5c083535dec79d2af86dae315b6229" title="Print menu.">print_menu</a>(<span class="keywordtype">void</span>);
<a name="l00138"></a>00138 <a class="code" href="group___s_p_i___s_d_card.html#g5a7175ce83822b34319bbe16f2acc652">sd_connect_status</a> <a class="code" href="group___s_p_i___s_d_card.html#gf48ba8030c21a0100e7ba13d12023440" title="check if SD card is inserted or not">SD_GetCardConnectStatus</a>(<span class="keywordtype">void</span>);
<a name="l00139"></a>00139 uint8_t <a class="code" href="group___s_p_i___s_d_card.html#g2cb8fe49aa9864e3c77eeedda771a3a6" title="Calculate CRC-7 as required by SD specification.">crc_7</a>(uint8_t old_crc, uint8_t <a class="code" href="group___i2_s__two__kit.html#g1e43bf7d608e87228b625cca2c04d641">data</a>);
<a name="l00140"></a>00140 uint8_t <a class="code" href="group___s_p_i___s_d_card.html#g54c1048f0febb16551571d031726c90e" title="Provides the zero-padding final step to CRC-7.">crc_7final</a>(uint8_t old_crc);
<a name="l00141"></a>00141 uint32_t <a class="code" href="group___s_p_i___s_d_card.html#g99ac1c6edce58bdb04b72d8ef75319cc" title="Send/receive data over SPI bus.">SD_SendReceiveData_Polling</a>(<span class="keywordtype">void</span>* tx_buf, <span class="keywordtype">void</span>* <a class="code" href="group___u_a_r_t___d_m_a.html#gd0058b3087d4cf1d597d7b45eac606c6">rx_buf</a>, uint32_t length);
<a name="l00142"></a>00142 <span class="keywordtype">void</span> <a class="code" href="group___s_p_i___s_d_card.html#g7707756acc0605a8453360d79c673099" title="Send command to SD card.">SD_SendCommand</a>(uint8_t cmd, uint8_t *arg);
<a name="l00143"></a>00143 <a class="code" href="group___s_p_i___s_d_card.html#g34d33cc449d35e52930dfc894c497bd6">sd_error</a> <a class="code" href="group___s_p_i___s_d_card.html#g8ca549754b5cb379e9ff061a486ab8af" title="Wait for SD card R1 response.">SD_WaitR1</a>(uint8_t *<a class="code" href="group___i2_c___monitor.html#g97eaba5b61706891a4da114bde40da4d">buffer</a>, uint32_t length, uint32_t timeout);
<a name="l00144"></a>00144 <a class="code" href="group___s_p_i___s_d_card.html#g34d33cc449d35e52930dfc894c497bd6">sd_error</a> <a class="code" href="group___s_p_i___s_d_card.html#g9684d01a1b01561c84b94604e4e7f7b1" title="Wait for SD card idle.">SD_WaitDeviceIdle</a>(uint32_t num_char);
<a name="l00145"></a>00145 <a class="code" href="group___s_p_i___s_d_card.html#g34d33cc449d35e52930dfc894c497bd6">sd_error</a> <a class="code" href="group___s_p_i___s_d_card.html#g5b7bd335c9c2ff133e5e92d7ad2985ea" title="Initialize SD card in SPI mode.">SD_Init</a>(uint8_t retries);
<a name="l00146"></a>00146 <a class="code" href="group___s_p_i___s_d_card.html#g34d33cc449d35e52930dfc894c497bd6">sd_error</a> <a class="code" href="group___s_p_i___s_d_card.html#g2006ada117ab43a62b587f2e766ed13a" title="Get SD card&amp;#39;s CID register.">SD_GetCID</a>(<span class="keywordtype">void</span>);
<a name="l00147"></a>00147 <span class="comment">/*----------------- INTERRUPT SERVICE ROUTINES --------------------------*/</span>
<a name="l00148"></a>00148 
<a name="l00149"></a>00149 <span class="comment">/*-------------------------PRIVATE FUNCTIONS------------------------------*/</span>
<a name="l00150"></a>00150 
<a name="l00151"></a>00151 <span class="comment">/*********************************************************************/</span>
<a name="l00157"></a>00157 <span class="keywordtype">void</span> <a class="code" href="group___s_p_i___master.html#gb3ad33fe379379962edd4c549bbc9ffa" title="Initialize CS pin as GPIO function to drive /CS pin due to definition of CS_PORT_NUM...">CS_Init</a>(<span class="keywordtype">void</span>)
<a name="l00158"></a>00158 {
<a name="l00159"></a>00159         <a class="code" href="group___g_p_i_o___public___functions.html#g8c31c99596c6c47e513186788882b47c" title="Set Direction for GPIO port.">GPIO_SetDir</a>(<a class="code" href="group___s_p_i___loop_back.html#gd4c80b355a7cd4bb8334b5ccf3e4a24b">CS_PORT_NUM</a>, (1&lt;&lt;<a class="code" href="group___s_p_i___loop_back.html#g744e83c43991ae773f194a7f04abefc8">CS_PIN_NUM</a>), 1);
<a name="l00160"></a>00160         <a class="code" href="group___g_p_i_o___public___functions.html#gcdcb07acb7ca418274baee8cbd4f810c" title="Set Value for bits that have output direction on GPIO port.">GPIO_SetValue</a>(<a class="code" href="group___s_p_i___loop_back.html#gd4c80b355a7cd4bb8334b5ccf3e4a24b">CS_PORT_NUM</a>, (1&lt;&lt;<a class="code" href="group___s_p_i___loop_back.html#g744e83c43991ae773f194a7f04abefc8">CS_PIN_NUM</a>));
<a name="l00161"></a>00161 }
<a name="l00162"></a>00162 <span class="comment">/*********************************************************************/</span>
<a name="l00170"></a>00170 <span class="keywordtype">void</span> <a class="code" href="group___s_p_i___master.html#g4f2e4a350f9a2791aa8542f222fb161f" title="Drive CS output pin to low/high level to select slave device via /CS pin state.">CS_Force</a>(int32_t state)
<a name="l00171"></a>00171 {
<a name="l00172"></a>00172         <span class="keywordflow">if</span> (state){
<a name="l00173"></a>00173                 <a class="code" href="group___g_p_i_o___public___functions.html#gcdcb07acb7ca418274baee8cbd4f810c" title="Set Value for bits that have output direction on GPIO port.">GPIO_SetValue</a>(<a class="code" href="group___s_p_i___loop_back.html#gd4c80b355a7cd4bb8334b5ccf3e4a24b">CS_PORT_NUM</a>, (1&lt;&lt;<a class="code" href="group___s_p_i___loop_back.html#g744e83c43991ae773f194a7f04abefc8">CS_PIN_NUM</a>));
<a name="l00174"></a>00174         }<span class="keywordflow">else</span>{
<a name="l00175"></a>00175                 <a class="code" href="group___g_p_i_o___public___functions.html#ga2abb4e13b93d567c22917eb1fda5589" title="Clear Value for bits that have output direction on GPIO port.">GPIO_ClearValue</a>(<a class="code" href="group___s_p_i___loop_back.html#gd4c80b355a7cd4bb8334b5ccf3e4a24b">CS_PORT_NUM</a>, (1&lt;&lt;<a class="code" href="group___s_p_i___loop_back.html#g744e83c43991ae773f194a7f04abefc8">CS_PIN_NUM</a>));
<a name="l00176"></a>00176         }
<a name="l00177"></a>00177 }
<a name="l00178"></a>00178 <span class="comment">/*********************************************************************/</span>
<a name="l00183"></a>00183 <span class="keywordtype">void</span> <a class="code" href="group___a_d_c___burst.html#g3d5c083535dec79d2af86dae315b6229" title="Print menu.">print_menu</a>(<span class="keywordtype">void</span>)
<a name="l00184"></a>00184 {
<a name="l00185"></a>00185         <a class="code" href="debug__frmwrk_8h.html#3e6c7a15da08f302351c052694a5b1ca">_DBG</a>(<a class="code" href="group___a_d_c___burst.html#gc2c0f1959d26e8b438a32d3ac3212731">menu1</a>);
<a name="l00186"></a>00186 }
<a name="l00187"></a>00187 <span class="comment">/*********************************************************************/</span>
<a name="l00192"></a><a class="code" href="group___s_p_i___s_d_card.html#gf48ba8030c21a0100e7ba13d12023440">00192</a> <a class="code" href="group___s_p_i___s_d_card.html#g5a7175ce83822b34319bbe16f2acc652">sd_connect_status</a> <a class="code" href="group___s_p_i___s_d_card.html#gf48ba8030c21a0100e7ba13d12023440" title="check if SD card is inserted or not">SD_GetCardConnectStatus</a>(<span class="keywordtype">void</span>)
<a name="l00193"></a>00193 {
<a name="l00194"></a>00194         <a class="code" href="group___s_p_i___s_d_card.html#g5a7175ce83822b34319bbe16f2acc652">sd_connect_status</a> ret=<a class="code" href="group___s_p_i___s_d_card.html#gg2c1606342bd0b857424958bfc36a52544d073e4438d1f03994973553fc8c3790">SD_DISCONNECTED</a>;
<a name="l00195"></a>00195 
<a name="l00196"></a>00196         <span class="keywordflow">if</span>((<a class="code" href="group___g_p_i_o___public___functions.html#gc3d5c73668775dd7f5320c6cdf6b9e0c" title="Read Current state on port pin that have input direction of GPIO.">GPIO_ReadValue</a>(<a class="code" href="group___s_p_i___s_d_card.html#gfb9b535a0fc3727cf47e4a37f6fadfa4">SD_DETECT_PORTNUM</a>)&amp;(1&lt;&lt;<a class="code" href="group___s_p_i___s_d_card.html#gb212725e70141a97e62b355094bd3f52">SD_DETECT_PINNUM</a>))== 0)
<a name="l00197"></a>00197                 ret = <a class="code" href="group___s_p_i___s_d_card.html#gg2c1606342bd0b857424958bfc36a5254a2df00e890098d475da7acedf8457084">SD_CONNECTED</a>;
<a name="l00198"></a>00198 
<a name="l00199"></a>00199         <span class="keywordflow">return</span> ret;
<a name="l00200"></a>00200 }
<a name="l00201"></a>00201 <span class="comment">/*********************************************************************/</span>
<a name="l00208"></a><a class="code" href="group___s_p_i___s_d_card.html#g2cb8fe49aa9864e3c77eeedda771a3a6">00208</a> uint8_t <a class="code" href="group___s_p_i___s_d_card.html#g2cb8fe49aa9864e3c77eeedda771a3a6" title="Calculate CRC-7 as required by SD specification.">crc_7</a>(uint8_t old_crc, uint8_t <a class="code" href="group___i2_s__two__kit.html#g1e43bf7d608e87228b625cca2c04d641">data</a>)
<a name="l00209"></a>00209 {
<a name="l00210"></a>00210   uint8_t new_crc,x;
<a name="l00211"></a>00211 
<a name="l00212"></a>00212   new_crc = old_crc;
<a name="l00213"></a>00213   <span class="keywordflow">for</span> (x = 7; x &gt;= 0; x--) {
<a name="l00214"></a>00214     new_crc &lt;&lt;= 1;
<a name="l00215"></a>00215     new_crc |= <a class="code" href="group___s_p_i___s_d_card.html#g26f62735f75be5802a9cba8111a408f3">GETBIT</a>(data,x);
<a name="l00216"></a>00216     <span class="keywordflow">if</span> (<a class="code" href="group___s_p_i___s_d_card.html#g26f62735f75be5802a9cba8111a408f3">GETBIT</a>(new_crc, 7) == 1) {
<a name="l00217"></a>00217       new_crc ^= 0x89; <span class="comment">/*CRC-7's polynomial is x^7 + x^3 + 1*/</span>
<a name="l00218"></a>00218     }
<a name="l00219"></a>00219     <span class="keywordflow">if</span>(x==0) <span class="keywordflow">break</span>;
<a name="l00220"></a>00220   }
<a name="l00221"></a>00221   <span class="keywordflow">return</span> new_crc;
<a name="l00222"></a>00222 }
<a name="l00223"></a>00223 <span class="comment">/*********************************************************************/</span>
<a name="l00228"></a><a class="code" href="group___s_p_i___s_d_card.html#g54c1048f0febb16551571d031726c90e">00228</a> uint8_t <a class="code" href="group___s_p_i___s_d_card.html#g54c1048f0febb16551571d031726c90e" title="Provides the zero-padding final step to CRC-7.">crc_7final</a>(uint8_t old_crc)
<a name="l00229"></a>00229 {
<a name="l00230"></a>00230   uint8_t new_crc,x;
<a name="l00231"></a>00231 
<a name="l00232"></a>00232   new_crc = old_crc;
<a name="l00233"></a>00233   <span class="keywordflow">for</span> (x = 0; x &lt; 7; x++) {
<a name="l00234"></a>00234     new_crc &lt;&lt;= 1;
<a name="l00235"></a>00235     <span class="keywordflow">if</span> (<a class="code" href="group___s_p_i___s_d_card.html#g26f62735f75be5802a9cba8111a408f3">GETBIT</a>(new_crc, 7) == 1) {
<a name="l00236"></a>00236       new_crc ^= 0x89; <span class="comment">/*CRC-7's polynomial is x^7 + x^3 + 1*/</span>
<a name="l00237"></a>00237     }
<a name="l00238"></a>00238   }
<a name="l00239"></a>00239   <span class="keywordflow">return</span> new_crc;
<a name="l00240"></a>00240 }
<a name="l00241"></a>00241 <span class="comment">/*********************************************************************/</span>
<a name="l00250"></a><a class="code" href="group___s_p_i___s_d_card.html#g99ac1c6edce58bdb04b72d8ef75319cc">00250</a> uint32_t <a class="code" href="group___s_p_i___s_d_card.html#g99ac1c6edce58bdb04b72d8ef75319cc" title="Send/receive data over SPI bus.">SD_SendReceiveData_Polling</a>(<span class="keywordtype">void</span>* tx_buf, <span class="keywordtype">void</span>* <a class="code" href="group___u_a_r_t___d_m_a.html#gd0058b3087d4cf1d597d7b45eac606c6">rx_buf</a>, uint32_t length)
<a name="l00251"></a>00251 {
<a name="l00252"></a>00252         <span class="comment">//uint16_t i;</span>
<a name="l00253"></a>00253 
<a name="l00254"></a>00254         <a class="code" href="group___s_p_i___master.html#g4f2e4a350f9a2791aa8542f222fb161f" title="Drive CS output pin to low/high level to select slave device via /CS pin state.">CS_Force</a>(0);
<a name="l00255"></a>00255         <span class="comment">//for(i=0;i&lt;1000;i++);</span>
<a name="l00256"></a>00256 
<a name="l00257"></a>00257         xferConfig.<a class="code" href="struct_s_p_i___d_a_t_a___s_e_t_u_p___type.html#c5b2b9db8286b9c85c956556cfa42b92">tx_data</a> = tx_buf;
<a name="l00258"></a>00258         xferConfig.<a class="code" href="struct_s_p_i___d_a_t_a___s_e_t_u_p___type.html#145057319bd95286db0e0ad0e635f93f">rx_data</a> = rx_buf;
<a name="l00259"></a>00259         xferConfig.<a class="code" href="struct_s_p_i___d_a_t_a___s_e_t_u_p___type.html#ebb70c2aab3407a9f05334c47131a43b">length</a> = length;
<a name="l00260"></a>00260         <a class="code" href="group___s_p_i___public___functions.html#g2f278961f5f8a66beea7a0c1c29b1ef2" title="SPI Read write data function.">SPI_ReadWrite</a>(<a class="code" href="group___l_p_c17xx___system.html#g9b593f008d0061052e90a8865d702ce5">LPC_SPI</a>, &amp;xferConfig, <a class="code" href="group___s_p_i___public___types.html#gg0003ce5a6b4371e13d99dcce3fcada704a0b5546343ee5eb0389f91936e3a223">SPI_TRANSFER_POLLING</a>);
<a name="l00261"></a>00261 
<a name="l00262"></a>00262         <span class="comment">//for(i=0;i&lt;1000;i++);</span>
<a name="l00263"></a>00263         <a class="code" href="group___s_p_i___master.html#g4f2e4a350f9a2791aa8542f222fb161f" title="Drive CS output pin to low/high level to select slave device via /CS pin state.">CS_Force</a>(1);
<a name="l00264"></a>00264         <span class="keywordflow">return</span> xferConfig.<a class="code" href="struct_s_p_i___d_a_t_a___s_e_t_u_p___type.html#51322ddb267b4729d6b5f2bb05d49fff">counter</a>;
<a name="l00265"></a>00265 }
<a name="l00266"></a>00266 <span class="comment">/*********************************************************************/</span>
<a name="l00272"></a><a class="code" href="group___s_p_i___s_d_card.html#g7707756acc0605a8453360d79c673099">00272</a> <span class="keywordtype">void</span> <a class="code" href="group___s_p_i___s_d_card.html#g7707756acc0605a8453360d79c673099" title="Send command to SD card.">SD_SendCommand</a>(uint8_t cmd, uint8_t *arg)
<a name="l00273"></a>00273 {
<a name="l00274"></a>00274         uint8_t crc = 0x00;
<a name="l00275"></a>00275 
<a name="l00276"></a>00276         <span class="comment">/* First byte has framing bits and command */</span>
<a name="l00277"></a>00277         <a class="code" href="group___s_p_i___s_d_card.html#gb1696331b67ee097a470e6c12a57b442">sd_cmd_buf</a>[0] = 0x40 | (cmd &amp; 0x3f);
<a name="l00278"></a>00278         <a class="code" href="group___s_p_i___s_d_card.html#gb1696331b67ee097a470e6c12a57b442">sd_cmd_buf</a>[1] = arg[0];
<a name="l00279"></a>00279         <a class="code" href="group___s_p_i___s_d_card.html#gb1696331b67ee097a470e6c12a57b442">sd_cmd_buf</a>[2] = arg[1];
<a name="l00280"></a>00280         <a class="code" href="group___s_p_i___s_d_card.html#gb1696331b67ee097a470e6c12a57b442">sd_cmd_buf</a>[3] = arg[2];
<a name="l00281"></a>00281         <a class="code" href="group___s_p_i___s_d_card.html#gb1696331b67ee097a470e6c12a57b442">sd_cmd_buf</a>[4] = arg[3];
<a name="l00282"></a>00282         <span class="comment">//calculate CRC</span>
<a name="l00283"></a>00283         crc = <a class="code" href="group___s_p_i___s_d_card.html#g2cb8fe49aa9864e3c77eeedda771a3a6" title="Calculate CRC-7 as required by SD specification.">crc_7</a>(crc, <a class="code" href="group___s_p_i___s_d_card.html#gb1696331b67ee097a470e6c12a57b442">sd_cmd_buf</a>[0]);<span class="comment">//start new crc-7</span>
<a name="l00284"></a>00284         crc = <a class="code" href="group___s_p_i___s_d_card.html#g2cb8fe49aa9864e3c77eeedda771a3a6" title="Calculate CRC-7 as required by SD specification.">crc_7</a>(crc, <a class="code" href="group___s_p_i___s_d_card.html#gb1696331b67ee097a470e6c12a57b442">sd_cmd_buf</a>[1]);
<a name="l00285"></a>00285         crc = <a class="code" href="group___s_p_i___s_d_card.html#g2cb8fe49aa9864e3c77eeedda771a3a6" title="Calculate CRC-7 as required by SD specification.">crc_7</a>(crc, <a class="code" href="group___s_p_i___s_d_card.html#gb1696331b67ee097a470e6c12a57b442">sd_cmd_buf</a>[2]);
<a name="l00286"></a>00286         crc = <a class="code" href="group___s_p_i___s_d_card.html#g2cb8fe49aa9864e3c77eeedda771a3a6" title="Calculate CRC-7 as required by SD specification.">crc_7</a>(crc, <a class="code" href="group___s_p_i___s_d_card.html#gb1696331b67ee097a470e6c12a57b442">sd_cmd_buf</a>[3]);
<a name="l00287"></a>00287         crc = <a class="code" href="group___s_p_i___s_d_card.html#g2cb8fe49aa9864e3c77eeedda771a3a6" title="Calculate CRC-7 as required by SD specification.">crc_7</a>(crc, <a class="code" href="group___s_p_i___s_d_card.html#gb1696331b67ee097a470e6c12a57b442">sd_cmd_buf</a>[4]);
<a name="l00288"></a>00288         crc = <a class="code" href="group___s_p_i___s_d_card.html#g54c1048f0febb16551571d031726c90e" title="Provides the zero-padding final step to CRC-7.">crc_7final</a>(crc);
<a name="l00289"></a>00289         <a class="code" href="group___s_p_i___s_d_card.html#gb1696331b67ee097a470e6c12a57b442">sd_cmd_buf</a>[5] = (crc &lt;&lt; 1) | 0x01;<span class="comment">//stop bit</span>
<a name="l00290"></a>00290 
<a name="l00291"></a>00291         <a class="code" href="group___s_p_i___s_d_card.html#g99ac1c6edce58bdb04b72d8ef75319cc" title="Send/receive data over SPI bus.">SD_SendReceiveData_Polling</a>(<a class="code" href="group___s_p_i___s_d_card.html#gb1696331b67ee097a470e6c12a57b442">sd_cmd_buf</a>,<a class="code" href="group___l_p_c___types___public___macros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,<a class="code" href="group___s_p_i___s_d_card.html#gd141d93ccd42520fbbba9bc37ea9a761">SD_CMD_BLOCK_LENGTH</a>);
<a name="l00292"></a>00292 }
<a name="l00293"></a>00293 <span class="comment">/*********************************************************************/</span>
<a name="l00301"></a><a class="code" href="group___s_p_i___s_d_card.html#g8ca549754b5cb379e9ff061a486ab8af">00301</a> <a class="code" href="group___s_p_i___s_d_card.html#g34d33cc449d35e52930dfc894c497bd6">sd_error</a> <a class="code" href="group___s_p_i___s_d_card.html#g8ca549754b5cb379e9ff061a486ab8af" title="Wait for SD card R1 response.">SD_WaitR1</a>(uint8_t *<a class="code" href="group___i2_c___monitor.html#g97eaba5b61706891a4da114bde40da4d">buffer</a>, uint32_t length, uint32_t timeout)
<a name="l00302"></a>00302 {
<a name="l00303"></a>00303     uint32_t j;
<a name="l00304"></a>00304         uint8_t <a class="code" href="group___i2_s___i_r_q.html#gff7b59f569ec689a7580bd6911daafd5">dummy</a>[2];
<a name="l00305"></a>00305         uint8_t wait_idle;
<a name="l00306"></a>00306 
<a name="l00307"></a>00307         <span class="comment">/* No null pointers allowed */</span>
<a name="l00308"></a>00308         <span class="keywordflow">if</span> (buffer == <a class="code" href="group___l_p_c___types___public___macros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)     <span class="keywordflow">return</span> <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dceca7950dcb479d57ff645d8d046aa7c92a">SD_CMD_BAD_PARAMETER</a>;
<a name="l00309"></a>00309 
<a name="l00310"></a>00310         <span class="comment">/* Wait for start bit on R1 */</span>
<a name="l00311"></a>00311         j=0;dummy[0]=0xFF;
<a name="l00312"></a>00312         <span class="keywordflow">while</span> (<a class="code" href="group___s_p_i___s_d_card.html#g26f62735f75be5802a9cba8111a408f3">GETBIT</a>(dummy[0],7) == 1)
<a name="l00313"></a>00313         {
<a name="l00314"></a>00314                 <span class="keywordflow">if</span> (j&gt;timeout)<span class="keywordflow">return</span> <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcec0c2e159ea7414c76ff20c7be29624f84">SD_ERROR_TIMEOUT</a>;
<a name="l00315"></a>00315                 dummy[0]=0x00;
<a name="l00316"></a>00316                 <a class="code" href="group___s_p_i___s_d_card.html#g99ac1c6edce58bdb04b72d8ef75319cc" title="Send/receive data over SPI bus.">SD_SendReceiveData_Polling</a>(<a class="code" href="group___l_p_c___types___public___macros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,dummy,1);
<a name="l00317"></a>00317                 j++;
<a name="l00318"></a>00318         }
<a name="l00319"></a>00319         *buffer=dummy[0];<span class="comment">//store R1</span>
<a name="l00320"></a>00320         <span class="keywordflow">if</span> (length &gt; 0)<span class="comment">//read followed data</span>
<a name="l00321"></a>00321         {
<a name="l00322"></a>00322                 <span class="comment">/* Wait for start token on data portion, if any */</span>
<a name="l00323"></a>00323                 dummy[0] = 0xff;j = 0;
<a name="l00324"></a>00324                 <span class="keywordflow">while</span> (dummy[0] != 0xfe)
<a name="l00325"></a>00325                 {
<a name="l00326"></a>00326                         <span class="keywordflow">if</span> (j &gt; timeout)<span class="keywordflow">return</span> <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcec0c2e159ea7414c76ff20c7be29624f84">SD_ERROR_TIMEOUT</a>;
<a name="l00327"></a>00327                         dummy[0]=0x00;
<a name="l00328"></a>00328                         <a class="code" href="group___s_p_i___s_d_card.html#g99ac1c6edce58bdb04b72d8ef75319cc" title="Send/receive data over SPI bus.">SD_SendReceiveData_Polling</a>(<a class="code" href="group___l_p_c___types___public___macros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,dummy,1);
<a name="l00329"></a>00329                         <span class="keywordflow">if</span> ((dummy[0] != 0xff) &amp;&amp; (dummy[0] != 0xfe)) <span class="comment">// not idle or start token?</span>
<a name="l00330"></a>00330                         {
<a name="l00331"></a>00331                                 <span class="keywordflow">return</span> <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcece2b14cd528dcb716254e54a6b86d96bc">SD_ERROR_TOKEN</a>;
<a name="l00332"></a>00332                         }
<a name="l00333"></a>00333                         j++;
<a name="l00334"></a>00334                 }
<a name="l00335"></a>00335                 <span class="comment">/* Read all bytes */</span>
<a name="l00336"></a>00336                 <a class="code" href="group___s_p_i___s_d_card.html#g99ac1c6edce58bdb04b72d8ef75319cc" title="Send/receive data over SPI bus.">SD_SendReceiveData_Polling</a>(<a class="code" href="group___l_p_c___types___public___macros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,(buffer+1),(length - 1));
<a name="l00337"></a>00337         }
<a name="l00338"></a>00338         <span class="comment">/* Some more bit clocks to finish internal SD operations */</span>
<a name="l00339"></a>00339         dummy[0]=0x00;wait_idle=0;
<a name="l00340"></a>00340         <span class="keywordflow">while</span>((dummy[0]!=0xff)&amp;&amp;(wait_idle&lt;20))
<a name="l00341"></a>00341         {
<a name="l00342"></a>00342                 dummy[0]=0x00;
<a name="l00343"></a>00343                 <a class="code" href="group___s_p_i___s_d_card.html#g99ac1c6edce58bdb04b72d8ef75319cc" title="Send/receive data over SPI bus.">SD_SendReceiveData_Polling</a>(<a class="code" href="group___l_p_c___types___public___macros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,dummy,1);
<a name="l00344"></a>00344                 <span class="keywordflow">for</span>(j=0;j&lt;1000;j++);
<a name="l00345"></a>00345                 wait_idle++;
<a name="l00346"></a>00346         }
<a name="l00347"></a>00347         <span class="keywordflow">if</span>(wait_idle&gt;=20) <span class="keywordflow">return</span> <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcecb66e1a75bcadbf8abeaa5ba3d2b6e2b7">SD_ERROR_BUS_NOT_IDLE</a>;
<a name="l00348"></a>00348         <span class="keywordflow">return</span> <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcece7d9e30a15fd1bc4b2cd8f10208e76a6">SD_OK</a>;
<a name="l00349"></a>00349 }
<a name="l00350"></a>00350 <span class="comment">/*********************************************************************/</span>
<a name="l00355"></a><a class="code" href="group___s_p_i___s_d_card.html#g9684d01a1b01561c84b94604e4e7f7b1">00355</a> <a class="code" href="group___s_p_i___s_d_card.html#g34d33cc449d35e52930dfc894c497bd6">sd_error</a> <a class="code" href="group___s_p_i___s_d_card.html#g9684d01a1b01561c84b94604e4e7f7b1" title="Wait for SD card idle.">SD_WaitDeviceIdle</a>(uint32_t num_char)
<a name="l00356"></a>00356 {
<a name="l00357"></a>00357         uint8_t <a class="code" href="group___i2_s___i_r_q.html#gff7b59f569ec689a7580bd6911daafd5">dummy</a>[2]={0,0};
<a name="l00358"></a>00358         uint32_t i=0;
<a name="l00359"></a>00359 
<a name="l00360"></a>00360         <span class="keywordflow">while</span> ((i &lt; num_char) &amp;&amp; (dummy[0] != 0xff))
<a name="l00361"></a>00361         {
<a name="l00362"></a>00362                 dummy[0]=0x00;
<a name="l00363"></a>00363                 <a class="code" href="group___s_p_i___s_d_card.html#g99ac1c6edce58bdb04b72d8ef75319cc" title="Send/receive data over SPI bus.">SD_SendReceiveData_Polling</a>(<a class="code" href="group___l_p_c___types___public___macros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,dummy,1);
<a name="l00364"></a>00364                 <span class="keywordflow">if</span> (dummy[0] == 0xff)
<a name="l00365"></a>00365                 {
<a name="l00366"></a>00366                         dummy[0]= 0x00;
<a name="l00367"></a>00367                         <a class="code" href="group___s_p_i___s_d_card.html#g99ac1c6edce58bdb04b72d8ef75319cc" title="Send/receive data over SPI bus.">SD_SendReceiveData_Polling</a>(<a class="code" href="group___l_p_c___types___public___macros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,dummy,1);
<a name="l00368"></a>00368                         <span class="keywordflow">if</span> (dummy[0] == 0xff)
<a name="l00369"></a>00369                         {
<a name="l00370"></a>00370                                 dummy[0]= 0x00;
<a name="l00371"></a>00371                                 <a class="code" href="group___s_p_i___s_d_card.html#g99ac1c6edce58bdb04b72d8ef75319cc" title="Send/receive data over SPI bus.">SD_SendReceiveData_Polling</a>(<a class="code" href="group___l_p_c___types___public___macros.html#g070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,dummy,1);
<a name="l00372"></a>00372                         }
<a name="l00373"></a>00373                 }
<a name="l00374"></a>00374                 i++;
<a name="l00375"></a>00375         }
<a name="l00376"></a>00376         <span class="keywordflow">if</span> (dummy[0] != 0xff)<span class="keywordflow">return</span> <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcec0c2e159ea7414c76ff20c7be29624f84">SD_ERROR_TIMEOUT</a>;
<a name="l00377"></a>00377 
<a name="l00378"></a>00378         <span class="keywordflow">return</span> <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcece7d9e30a15fd1bc4b2cd8f10208e76a6">SD_OK</a>;
<a name="l00379"></a>00379 }
<a name="l00380"></a>00380 <span class="comment">/*********************************************************************/</span>
<a name="l00385"></a><a class="code" href="group___s_p_i___s_d_card.html#g5b7bd335c9c2ff133e5e92d7ad2985ea">00385</a> <a class="code" href="group___s_p_i___s_d_card.html#g34d33cc449d35e52930dfc894c497bd6">sd_error</a> <a class="code" href="group___s_p_i___s_d_card.html#g5b7bd335c9c2ff133e5e92d7ad2985ea" title="Initialize SD card in SPI mode.">SD_Init</a>(uint8_t retries)
<a name="l00386"></a>00386 {
<a name="l00387"></a>00387         uint8_t rxdata,errors;
<a name="l00388"></a>00388         uint8_t SD_arg[4]={0,0,0,0};
<a name="l00389"></a>00389         uint16_t i;
<a name="l00390"></a>00390 
<a name="l00391"></a>00391         <span class="comment">// initialize SPI configuration structure to default</span>
<a name="l00392"></a>00392         <a class="code" href="group___s_p_i___public___functions.html#g647f575ab1548b4923c2fb81b727a3b1" title="Fills each SPI_InitStruct member with its default value:CPHA = SPI_CPHA_FIRSTCPOL...">SPI_ConfigStructInit</a>(&amp;SPI_ConfigStruct);
<a name="l00393"></a>00393         <span class="comment">// Initialize SPI peripheral with parameter given in structure above</span>
<a name="l00394"></a>00394         <a class="code" href="group___s_p_i___public___functions.html#gcc525d0fb68783cb8f1f6e4a8aafb802" title="Initializes the SPIx peripheral according to the specified parameters in the UART_ConfigStruct...">SPI_Init</a>(<a class="code" href="group___l_p_c17xx___system.html#g9b593f008d0061052e90a8865d702ce5">LPC_SPI</a>, &amp;SPI_ConfigStruct);
<a name="l00395"></a>00395         <span class="comment">// Initialize /CS pin to GPIO function</span>
<a name="l00396"></a>00396         <a class="code" href="group___s_p_i___master.html#gb3ad33fe379379962edd4c549bbc9ffa" title="Initialize CS pin as GPIO function to drive /CS pin due to definition of CS_PORT_NUM...">CS_Init</a>();
<a name="l00397"></a>00397         <span class="comment">// check for SD card insertion</span>
<a name="l00398"></a>00398         <a class="code" href="debug__frmwrk_8h.html#3e6c7a15da08f302351c052694a5b1ca">_DBG</a>(<span class="stringliteral">"\n\rPlease plug-in SD card!"</span>);
<a name="l00399"></a>00399         <span class="keywordflow">while</span>(<a class="code" href="group___s_p_i___s_d_card.html#gf48ba8030c21a0100e7ba13d12023440" title="check if SD card is inserted or not">SD_GetCardConnectStatus</a>()==<a class="code" href="group___s_p_i___s_d_card.html#gg2c1606342bd0b857424958bfc36a52544d073e4438d1f03994973553fc8c3790">SD_DISCONNECTED</a>);
<a name="l00400"></a>00400         <a class="code" href="debug__frmwrk_8h.html#3e6c7a15da08f302351c052694a5b1ca">_DBG</a>(<span class="stringliteral">"...Connected!\n\r"</span>);
<a name="l00401"></a>00401         <span class="comment">// Wait for bus idle</span>
<a name="l00402"></a>00402         <span class="keywordflow">if</span>(<a class="code" href="group___s_p_i___s_d_card.html#g9684d01a1b01561c84b94604e4e7f7b1" title="Wait for SD card idle.">SD_WaitDeviceIdle</a>(160) != <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcece7d9e30a15fd1bc4b2cd8f10208e76a6">SD_OK</a>) <span class="keywordflow">return</span> <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcecb66e1a75bcadbf8abeaa5ba3d2b6e2b7">SD_ERROR_BUS_NOT_IDLE</a>;
<a name="l00403"></a>00403         <a class="code" href="debug__frmwrk_8h.html#3e6c7a15da08f302351c052694a5b1ca">_DBG</a>(<span class="stringliteral">"Initialize SD card in SPI mode..."</span>);
<a name="l00404"></a>00404 
<a name="l00405"></a>00405         errors = 0;
<a name="l00406"></a>00406         <span class="comment">/* Send the CMD0_GO_IDLE_STATE while CS is asserted */</span>
<a name="l00407"></a>00407         <span class="comment">/* This signals the SD card to fall back to SPI mode */</span>
<a name="l00408"></a>00408         <span class="keywordflow">while</span>(errors &lt; retries)
<a name="l00409"></a>00409         {
<a name="l00410"></a>00410                 <a class="code" href="group___s_p_i___s_d_card.html#g7707756acc0605a8453360d79c673099" title="Send command to SD card.">SD_SendCommand</a>(<a class="code" href="group___s_p_i___s_d_card.html#g6efae6b4179548b393d8d3287ee46b33">CMD0_GO_IDLE_STATE</a>, SD_arg);
<a name="l00411"></a>00411                 <span class="keywordflow">if</span>(<a class="code" href="group___s_p_i___s_d_card.html#g8ca549754b5cb379e9ff061a486ab8af" title="Wait for SD card R1 response.">SD_WaitR1</a>(&amp;rxdata,0,1000)!= <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcece7d9e30a15fd1bc4b2cd8f10208e76a6">SD_OK</a>)
<a name="l00412"></a>00412                 {
<a name="l00413"></a>00413                         errors++;
<a name="l00414"></a>00414                         <span class="keywordflow">continue</span>;
<a name="l00415"></a>00415                 }
<a name="l00416"></a>00416                 <span class="keywordflow">if</span>(rxdata != <a class="code" href="group___s_p_i___s_d_card.html#gdee7c13eaeccaf3a5e695387c1715ce7">R1_IDLE</a>)
<a name="l00417"></a>00417                 {
<a name="l00418"></a>00418                         errors++;
<a name="l00419"></a>00419                         <span class="keywordflow">continue</span>;
<a name="l00420"></a>00420                 }
<a name="l00421"></a>00421                 <span class="keywordflow">else</span> <span class="keywordflow">break</span>;
<a name="l00422"></a>00422         }
<a name="l00423"></a>00423         <span class="keywordflow">if</span>(errors &gt;= retries)<span class="keywordflow">return</span> <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcec524565f26d36be976827f81adb02a091">SD_ERROR_CMD0</a>;
<a name="l00424"></a>00424 
<a name="l00425"></a>00425         <span class="comment">/* Check if the card is not MMC */</span>
<a name="l00426"></a>00426         <span class="comment">/* Start its internal initialization process */</span>
<a name="l00427"></a>00427         <span class="keywordflow">while</span>(1)
<a name="l00428"></a>00428         {
<a name="l00429"></a>00429                 <a class="code" href="group___s_p_i___s_d_card.html#g7707756acc0605a8453360d79c673099" title="Send command to SD card.">SD_SendCommand</a>(<a class="code" href="group___s_p_i___s_d_card.html#g539a0c7178704c361dbd6db67b49b1f0">CMD55_APP_CMD</a>, SD_arg);
<a name="l00430"></a>00430                 <span class="keywordflow">if</span>(<a class="code" href="group___s_p_i___s_d_card.html#g8ca549754b5cb379e9ff061a486ab8af" title="Wait for SD card R1 response.">SD_WaitR1</a>(&amp;rxdata,0,1000)!= <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcece7d9e30a15fd1bc4b2cd8f10208e76a6">SD_OK</a>) <span class="keywordflow">return</span> <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcec9dccbd3d346ce0a5a5651674467cd5d8">SD_ERROR_CMD55</a>;
<a name="l00431"></a>00431 
<a name="l00432"></a>00432                 <a class="code" href="group___s_p_i___s_d_card.html#g7707756acc0605a8453360d79c673099" title="Send command to SD card.">SD_SendCommand</a>(<a class="code" href="group___s_p_i___s_d_card.html#g1d41aed2ec04c2727af04103c6077128">ACMD41_SEND_OP_COND</a>, SD_arg);
<a name="l00433"></a>00433                 <a class="code" href="group___s_p_i___s_d_card.html#g8ca549754b5cb379e9ff061a486ab8af" title="Wait for SD card R1 response.">SD_WaitR1</a>(&amp;rxdata,0,1000);
<a name="l00434"></a>00434                 <span class="keywordflow">if</span> (rxdata &amp; <a class="code" href="group___s_p_i___s_d_card.html#gdee7c13eaeccaf3a5e695387c1715ce7">R1_IDLE</a>) <span class="comment">//in_idle_state = 1</span>
<a name="l00435"></a>00435                         <span class="keywordflow">for</span> (i = 0; i &lt; 1000; i++); <span class="comment">/* wait for a while */</span>
<a name="l00436"></a>00436                 <span class="keywordflow">else</span> <span class="keywordflow">break</span>; <span class="comment">//in_idle_state=0 --&gt; ready</span>
<a name="l00437"></a>00437         }
<a name="l00438"></a>00438         <span class="comment">/* Enable CRC */</span>
<a name="l00439"></a>00439         SD_arg[3] = 0x01;
<a name="l00440"></a>00440         <a class="code" href="group___s_p_i___s_d_card.html#g7707756acc0605a8453360d79c673099" title="Send command to SD card.">SD_SendCommand</a>(<a class="code" href="group___s_p_i___s_d_card.html#gbab165d386978705dbdb655e2fee70de">CMD59_CRC_ON_OFF</a>, SD_arg);
<a name="l00441"></a>00441         <span class="keywordflow">if</span>(<a class="code" href="group___s_p_i___s_d_card.html#g8ca549754b5cb379e9ff061a486ab8af" title="Wait for SD card R1 response.">SD_WaitR1</a>(&amp;rxdata,0,1000)!= <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcece7d9e30a15fd1bc4b2cd8f10208e76a6">SD_OK</a>) <span class="keywordflow">return</span> <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcec160bce3eab4006dd38c321ed15f96114">SD_ERROR_CMD59</a>;
<a name="l00442"></a>00442         <span class="keywordflow">if</span>(rxdata != <a class="code" href="group___s_p_i___s_d_card.html#g5a2e747f6080d118c365fdf804f462e1">R1_NOERROR</a>) <span class="keywordflow">return</span> <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcec160bce3eab4006dd38c321ed15f96114">SD_ERROR_CMD59</a>;
<a name="l00443"></a>00443 
<a name="l00444"></a>00444         <span class="keywordflow">return</span> <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcece7d9e30a15fd1bc4b2cd8f10208e76a6">SD_OK</a>;
<a name="l00445"></a>00445 }
<a name="l00446"></a>00446 <span class="comment">/*********************************************************************/</span>
<a name="l00452"></a><a class="code" href="group___s_p_i___s_d_card.html#g2006ada117ab43a62b587f2e766ed13a">00452</a> <a class="code" href="group___s_p_i___s_d_card.html#g34d33cc449d35e52930dfc894c497bd6">sd_error</a> <a class="code" href="group___s_p_i___s_d_card.html#g2006ada117ab43a62b587f2e766ed13a" title="Get SD card&amp;#39;s CID register.">SD_GetCID</a>(<span class="keywordtype">void</span>)
<a name="l00453"></a>00453 {
<a name="l00454"></a>00454         uint8_t SD_arg[4]={0,0,0,0};
<a name="l00455"></a>00455 
<a name="l00456"></a>00456         <a class="code" href="group___s_p_i___s_d_card.html#g7707756acc0605a8453360d79c673099" title="Send command to SD card.">SD_SendCommand</a>(<a class="code" href="group___s_p_i___s_d_card.html#g217cf3d6bad3b6d8032790d402f9f04b">CMD10_SEND_CID</a>, SD_arg);
<a name="l00457"></a>00457         <span class="keywordflow">if</span>(<a class="code" href="group___s_p_i___s_d_card.html#g8ca549754b5cb379e9ff061a486ab8af" title="Wait for SD card R1 response.">SD_WaitR1</a>(<a class="code" href="group___s_p_i___s_d_card.html#ge8a254cacac2f309f89ff5b0de5a5639">sd_data_buf</a>,18,1000)!= <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcece7d9e30a15fd1bc4b2cd8f10208e76a6">SD_OK</a>) <span class="keywordflow">return</span> <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcecfa798f433b94c8a4375a49313a405fc3">SD_NG</a>;
<a name="l00458"></a>00458         <span class="keywordflow">if</span>(<a class="code" href="group___s_p_i___s_d_card.html#ge8a254cacac2f309f89ff5b0de5a5639">sd_data_buf</a>[0]!= <a class="code" href="group___s_p_i___s_d_card.html#g5a2e747f6080d118c365fdf804f462e1">R1_NOERROR</a>) <span class="keywordflow">return</span> <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcecfa798f433b94c8a4375a49313a405fc3">SD_NG</a>;
<a name="l00459"></a>00459         <span class="keywordflow">return</span> <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcece7d9e30a15fd1bc4b2cd8f10208e76a6">SD_OK</a>;
<a name="l00460"></a>00460 }
<a name="l00461"></a>00461 <span class="comment">/*-------------------------MAIN FUNCTION------------------------------*/</span>
<a name="l00462"></a>00462 <span class="comment">/*********************************************************************/</span>
<a name="l00467"></a><a class="code" href="group___s_p_i___s_d_card.html#g94eff562304ddbff21e37f3334362298">00467</a> <span class="keywordtype">int</span> <a class="code" href="group___a_d_c___burst.html#g94eff562304ddbff21e37f3334362298" title="c_entry: Main ADC program body">c_entry</a>(<span class="keywordtype">void</span>)
<a name="l00468"></a>00468 {
<a name="l00469"></a>00469         <a class="code" href="struct_p_i_n_s_e_l___c_f_g___type.html" title="Pin configuration structure.">PINSEL_CFG_Type</a> PinCfg;
<a name="l00470"></a>00470         <a class="code" href="group___s_p_i___s_d_card.html#g34d33cc449d35e52930dfc894c497bd6">sd_error</a> sd_status;
<a name="l00471"></a>00471         uint8_t i;
<a name="l00472"></a>00472         uint8_t tem8;
<a name="l00473"></a>00473         uint32_t tem32;
<a name="l00474"></a>00474         <span class="comment">/*</span>
<a name="l00475"></a>00475 <span class="comment">         * Initialize SPI pin connect</span>
<a name="l00476"></a>00476 <span class="comment">         * P0.15 - SCK;</span>
<a name="l00477"></a>00477 <span class="comment">         * P0.16 - SSEL - used as GPIO</span>
<a name="l00478"></a>00478 <span class="comment">         * P0.17 - MISO</span>
<a name="l00479"></a>00479 <span class="comment">         * P0.18 - MOSI</span>
<a name="l00480"></a>00480 <span class="comment">         */</span>
<a name="l00481"></a>00481         PinCfg.<a class="code" href="struct_p_i_n_s_e_l___c_f_g___type.html#37f75692d33b8746d9302e7aef40cfed">Funcnum</a> = 3;
<a name="l00482"></a>00482         PinCfg.<a class="code" href="struct_p_i_n_s_e_l___c_f_g___type.html#41fdd494757916317e357a014e1e9233">OpenDrain</a> = 0;
<a name="l00483"></a>00483         PinCfg.<a class="code" href="struct_p_i_n_s_e_l___c_f_g___type.html#1ef97360ee450a2fa28c1070758cd492">Pinmode</a> = 0;
<a name="l00484"></a>00484         PinCfg.<a class="code" href="struct_p_i_n_s_e_l___c_f_g___type.html#15f31b7bf3c210481a3ff70d836a0a70">Portnum</a> = 0;
<a name="l00485"></a>00485         PinCfg.<a class="code" href="struct_p_i_n_s_e_l___c_f_g___type.html#8445b4a5f996bd14c274925d9946cf00">Pinnum</a> = 15;
<a name="l00486"></a>00486         <a class="code" href="group___p_i_n_s_e_l___public___functions.html#g771fcbed8f7ee806292e06e283611dc9" title="Configure Pin corresponding to specified parameters passed in the PinCfg.">PINSEL_ConfigPin</a>(&amp;PinCfg);
<a name="l00487"></a>00487         PinCfg.<a class="code" href="struct_p_i_n_s_e_l___c_f_g___type.html#8445b4a5f996bd14c274925d9946cf00">Pinnum</a> = 17;
<a name="l00488"></a>00488         <a class="code" href="group___p_i_n_s_e_l___public___functions.html#g771fcbed8f7ee806292e06e283611dc9" title="Configure Pin corresponding to specified parameters passed in the PinCfg.">PINSEL_ConfigPin</a>(&amp;PinCfg);
<a name="l00489"></a>00489         PinCfg.<a class="code" href="struct_p_i_n_s_e_l___c_f_g___type.html#8445b4a5f996bd14c274925d9946cf00">Pinnum</a> = 18;
<a name="l00490"></a>00490         <a class="code" href="group___p_i_n_s_e_l___public___functions.html#g771fcbed8f7ee806292e06e283611dc9" title="Configure Pin corresponding to specified parameters passed in the PinCfg.">PINSEL_ConfigPin</a>(&amp;PinCfg);
<a name="l00491"></a>00491         PinCfg.<a class="code" href="struct_p_i_n_s_e_l___c_f_g___type.html#8445b4a5f996bd14c274925d9946cf00">Pinnum</a> = 16;
<a name="l00492"></a>00492         PinCfg.<a class="code" href="struct_p_i_n_s_e_l___c_f_g___type.html#37f75692d33b8746d9302e7aef40cfed">Funcnum</a> = 0;
<a name="l00493"></a>00493         <a class="code" href="group___p_i_n_s_e_l___public___functions.html#g771fcbed8f7ee806292e06e283611dc9" title="Configure Pin corresponding to specified parameters passed in the PinCfg.">PINSEL_ConfigPin</a>(&amp;PinCfg);
<a name="l00494"></a>00494         <span class="comment">//Initialize SD card detection pin P4.29</span>
<a name="l00495"></a>00495         PinCfg.<a class="code" href="struct_p_i_n_s_e_l___c_f_g___type.html#15f31b7bf3c210481a3ff70d836a0a70">Portnum</a> = 4;
<a name="l00496"></a>00496         PinCfg.<a class="code" href="struct_p_i_n_s_e_l___c_f_g___type.html#8445b4a5f996bd14c274925d9946cf00">Pinnum</a> = 29;
<a name="l00497"></a>00497         PinCfg.<a class="code" href="struct_p_i_n_s_e_l___c_f_g___type.html#37f75692d33b8746d9302e7aef40cfed">Funcnum</a> = 0;<span class="comment">//GPIO function</span>
<a name="l00498"></a>00498         <a class="code" href="group___p_i_n_s_e_l___public___functions.html#g771fcbed8f7ee806292e06e283611dc9" title="Configure Pin corresponding to specified parameters passed in the PinCfg.">PINSEL_ConfigPin</a>(&amp;PinCfg);
<a name="l00499"></a>00499         <a class="code" href="group___g_p_i_o___public___functions.html#g8c31c99596c6c47e513186788882b47c" title="Set Direction for GPIO port.">GPIO_SetDir</a>(<a class="code" href="group___s_p_i___s_d_card.html#gfb9b535a0fc3727cf47e4a37f6fadfa4">SD_DETECT_PORTNUM</a>, (1&lt;&lt;<a class="code" href="group___s_p_i___s_d_card.html#gb212725e70141a97e62b355094bd3f52">SD_DETECT_PINNUM</a>), 0);<span class="comment">//input</span>
<a name="l00500"></a>00500 
<a name="l00501"></a>00501         <span class="comment">/* Initialize debug via UART0</span>
<a name="l00502"></a>00502 <span class="comment">         *  115200bps</span>
<a name="l00503"></a>00503 <span class="comment">         *  8 data bit</span>
<a name="l00504"></a>00504 <span class="comment">         *  No parity</span>
<a name="l00505"></a>00505 <span class="comment">         *  1 stop bit</span>
<a name="l00506"></a>00506 <span class="comment">         *  No flow control</span>
<a name="l00507"></a>00507 <span class="comment">         */</span>
<a name="l00508"></a>00508         <a class="code" href="debug__frmwrk_8h.html#a79ebfdcc65f8acaa847e9deaecea5a0" title="*********************************************************************//**">debug_frmwrk_init</a>();
<a name="l00509"></a>00509 
<a name="l00510"></a>00510         <span class="comment">// print welcome screen</span>
<a name="l00511"></a>00511         <a class="code" href="group___a_d_c___burst.html#g3d5c083535dec79d2af86dae315b6229" title="Print menu.">print_menu</a>();
<a name="l00512"></a>00512 
<a name="l00513"></a>00513         <span class="comment">//initialize SD card</span>
<a name="l00514"></a>00514         sd_status = <a class="code" href="group___s_p_i___s_d_card.html#g5b7bd335c9c2ff133e5e92d7ad2985ea" title="Initialize SD card in SPI mode.">SD_Init</a>(10);
<a name="l00515"></a>00515         <span class="keywordflow">switch</span>(sd_status)
<a name="l00516"></a>00516         {
<a name="l00517"></a>00517         <span class="keywordflow">case</span> <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcec524565f26d36be976827f81adb02a091">SD_ERROR_CMD0</a>:
<a name="l00518"></a>00518                 <a class="code" href="debug__frmwrk_8h.html#3e6c7a15da08f302351c052694a5b1ca">_DBG</a>(<span class="stringliteral">"Fail CMD0\n\r"</span>);
<a name="l00519"></a>00519                 <span class="keywordflow">break</span>;
<a name="l00520"></a>00520         <span class="keywordflow">case</span> <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcec9dccbd3d346ce0a5a5651674467cd5d8">SD_ERROR_CMD55</a>:
<a name="l00521"></a>00521                 <a class="code" href="debug__frmwrk_8h.html#3e6c7a15da08f302351c052694a5b1ca">_DBG</a>(<span class="stringliteral">"Fail CMD55\n\r"</span>);
<a name="l00522"></a>00522                 <span class="keywordflow">break</span>;
<a name="l00523"></a>00523         <span class="keywordflow">case</span> <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcec35df7b040b5ed42c9a12a5f3c4c08381">SD_ERROR_ACMD41</a>:
<a name="l00524"></a>00524                 <a class="code" href="debug__frmwrk_8h.html#3e6c7a15da08f302351c052694a5b1ca">_DBG</a>(<span class="stringliteral">"Fail ACMD41\n\r"</span>);
<a name="l00525"></a>00525                 <span class="keywordflow">break</span>;
<a name="l00526"></a>00526         <span class="keywordflow">case</span> <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcec160bce3eab4006dd38c321ed15f96114">SD_ERROR_CMD59</a>:
<a name="l00527"></a>00527                 <a class="code" href="debug__frmwrk_8h.html#3e6c7a15da08f302351c052694a5b1ca">_DBG</a>(<span class="stringliteral">"Fail CMD59\n\r"</span>);
<a name="l00528"></a>00528                 <span class="keywordflow">break</span>;
<a name="l00529"></a>00529         <span class="keywordflow">case</span> <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcecb66e1a75bcadbf8abeaa5ba3d2b6e2b7">SD_ERROR_BUS_NOT_IDLE</a>:
<a name="l00530"></a>00530                 <a class="code" href="debug__frmwrk_8h.html#3e6c7a15da08f302351c052694a5b1ca">_DBG</a>(<span class="stringliteral">"Fail...Device is not in idle state.\n\r"</span>);
<a name="l00531"></a>00531                 <span class="keywordflow">break</span>;
<a name="l00532"></a>00532         <span class="keywordflow">case</span> <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcece7d9e30a15fd1bc4b2cd8f10208e76a6">SD_OK</a>:
<a name="l00533"></a>00533                 <a class="code" href="debug__frmwrk_8h.html#3e6c7a15da08f302351c052694a5b1ca">_DBG</a>(<span class="stringliteral">"Done!\n\r"</span>);
<a name="l00534"></a>00534                 <span class="keywordflow">break</span>;
<a name="l00535"></a>00535         <span class="keywordflow">default</span>:
<a name="l00536"></a>00536                 <a class="code" href="debug__frmwrk_8h.html#3e6c7a15da08f302351c052694a5b1ca">_DBG</a>(<span class="stringliteral">"Fail\n\r"</span>);
<a name="l00537"></a>00537                 <span class="keywordflow">break</span>;
<a name="l00538"></a>00538         }
<a name="l00539"></a>00539         <span class="keywordflow">if</span>(sd_status == <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcece7d9e30a15fd1bc4b2cd8f10208e76a6">SD_OK</a>)
<a name="l00540"></a>00540         {
<a name="l00541"></a>00541                 <span class="comment">//Clear receive buffer</span>
<a name="l00542"></a>00542                 <span class="keywordflow">for</span>(i=1;i&lt;18;i++)<a class="code" href="group___s_p_i___s_d_card.html#ge8a254cacac2f309f89ff5b0de5a5639">sd_data_buf</a>[i]=0;
<a name="l00543"></a>00543 
<a name="l00544"></a>00544                 <a class="code" href="debug__frmwrk_8h.html#3e6c7a15da08f302351c052694a5b1ca">_DBG</a>(<span class="stringliteral">"Reading SD card's CID register..."</span>);
<a name="l00545"></a>00545                 <span class="keywordflow">if</span>(<a class="code" href="group___s_p_i___s_d_card.html#g2006ada117ab43a62b587f2e766ed13a" title="Get SD card&amp;#39;s CID register.">SD_GetCID</a>()!= <a class="code" href="group___s_p_i___s_d_card.html#gg45cc84e68509cb2865ddec5210c8dcece7d9e30a15fd1bc4b2cd8f10208e76a6">SD_OK</a>)
<a name="l00546"></a>00546                 {
<a name="l00547"></a>00547                         <a class="code" href="debug__frmwrk_8h.html#3e6c7a15da08f302351c052694a5b1ca">_DBG</a>(<span class="stringliteral">"Fail\n\r"</span>);
<a name="l00548"></a>00548                         <a class="code" href="group___s_p_i___public___functions.html#gd69565a7837b400d57b41f1c915a0ffd" title="De-initializes the SPIx peripheral registers to their default reset values.">SPI_DeInit</a>(<a class="code" href="group___l_p_c17xx___system.html#g9b593f008d0061052e90a8865d702ce5">LPC_SPI</a>);
<a name="l00549"></a>00549                 }
<a name="l00550"></a>00550                 <span class="keywordflow">else</span>
<a name="l00551"></a>00551                 {
<a name="l00552"></a>00552                         <a class="code" href="debug__frmwrk_8h.html#3e6c7a15da08f302351c052694a5b1ca">_DBG</a>(<span class="stringliteral">"Done!"</span>);
<a name="l00553"></a>00553                         <a class="code" href="debug__frmwrk_8h.html#3e6c7a15da08f302351c052694a5b1ca">_DBG</a>(<span class="stringliteral">"\n\rManufacture ID: "</span>);<a class="code" href="debug__frmwrk_8h.html#ca7eb62b4ac575ce492ddebadcb42c6b">_DBH</a>(<a class="code" href="group___s_p_i___s_d_card.html#ge8a254cacac2f309f89ff5b0de5a5639">sd_data_buf</a>[1]);
<a name="l00554"></a>00554                         <a class="code" href="debug__frmwrk_8h.html#3e6c7a15da08f302351c052694a5b1ca">_DBG</a>(<span class="stringliteral">"\n\rApplication ID: "</span>);<a class="code" href="debug__frmwrk_8h.html#731639ecb7d943f7db72d4f4aae58379">_DBC</a>(<a class="code" href="group___s_p_i___s_d_card.html#ge8a254cacac2f309f89ff5b0de5a5639">sd_data_buf</a>[2]);<a class="code" href="debug__frmwrk_8h.html#731639ecb7d943f7db72d4f4aae58379">_DBC</a>(<a class="code" href="group___s_p_i___s_d_card.html#ge8a254cacac2f309f89ff5b0de5a5639">sd_data_buf</a>[3]);
<a name="l00555"></a>00555                         <a class="code" href="debug__frmwrk_8h.html#3e6c7a15da08f302351c052694a5b1ca">_DBG</a>(<span class="stringliteral">"\n\rProduct name: "</span>);
<a name="l00556"></a>00556                                 <span class="keywordflow">for</span>(i=4;i&lt;9;i++) <a class="code" href="debug__frmwrk_8h.html#731639ecb7d943f7db72d4f4aae58379">_DBC</a>(<a class="code" href="group___s_p_i___s_d_card.html#ge8a254cacac2f309f89ff5b0de5a5639">sd_data_buf</a>[i]);
<a name="l00557"></a>00557                         <a class="code" href="debug__frmwrk_8h.html#3e6c7a15da08f302351c052694a5b1ca">_DBG</a>(<span class="stringliteral">"\n\rProduct revision: "</span>);
<a name="l00558"></a>00558                                 tem8 = (<a class="code" href="group___s_p_i___s_d_card.html#ge8a254cacac2f309f89ff5b0de5a5639">sd_data_buf</a>[9]&amp;0xF0)&gt;&gt;4;<a class="code" href="debug__frmwrk_8h.html#70d3fd73d0ecb9df75d64b8912dd6a63">_DBD</a>(tem8);
<a name="l00559"></a>00559                                 <a class="code" href="debug__frmwrk_8h.html#3e6c7a15da08f302351c052694a5b1ca">_DBG</a>(<span class="stringliteral">"."</span>);
<a name="l00560"></a>00560                                 tem8 = (<a class="code" href="group___s_p_i___s_d_card.html#ge8a254cacac2f309f89ff5b0de5a5639">sd_data_buf</a>[9]&amp;0x0F);<a class="code" href="debug__frmwrk_8h.html#70d3fd73d0ecb9df75d64b8912dd6a63">_DBD</a>(tem8);
<a name="l00561"></a>00561                         <a class="code" href="debug__frmwrk_8h.html#3e6c7a15da08f302351c052694a5b1ca">_DBG</a>(<span class="stringliteral">"\n\rProduct serial number: "</span>);
<a name="l00562"></a>00562                                 tem32= (<a class="code" href="group___s_p_i___s_d_card.html#ge8a254cacac2f309f89ff5b0de5a5639">sd_data_buf</a>[13]&lt;&lt;24)|(<a class="code" href="group___s_p_i___s_d_card.html#ge8a254cacac2f309f89ff5b0de5a5639">sd_data_buf</a>[12]&lt;&lt;16)|
<a name="l00563"></a>00563                                                 (<a class="code" href="group___s_p_i___s_d_card.html#ge8a254cacac2f309f89ff5b0de5a5639">sd_data_buf</a>[11]&lt;&lt;8)|(<a class="code" href="group___s_p_i___s_d_card.html#ge8a254cacac2f309f89ff5b0de5a5639">sd_data_buf</a>[10]&lt;&lt;0);
<a name="l00564"></a>00564                                 <a class="code" href="debug__frmwrk_8h.html#f9a56cf30e9942a809a16461ec192eae">_DBH32</a>(tem32);
<a name="l00565"></a>00565                         <a class="code" href="debug__frmwrk_8h.html#3e6c7a15da08f302351c052694a5b1ca">_DBG</a>(<span class="stringliteral">"\n\rManufacturing date: "</span>);
<a name="l00566"></a>00566                                 tem8 = (<a class="code" href="group___s_p_i___s_d_card.html#ge8a254cacac2f309f89ff5b0de5a5639">sd_data_buf</a>[15]&amp;0x0F);<a class="code" href="debug__frmwrk_8h.html#70d3fd73d0ecb9df75d64b8912dd6a63">_DBD</a>(tem8);
<a name="l00567"></a>00567                                 <a class="code" href="debug__frmwrk_8h.html#3e6c7a15da08f302351c052694a5b1ca">_DBG</a>(<span class="stringliteral">"/"</span>);
<a name="l00568"></a>00568                                 tem8 = ((<a class="code" href="group___s_p_i___s_d_card.html#ge8a254cacac2f309f89ff5b0de5a5639">sd_data_buf</a>[14]&amp;0x0F)&lt;&lt;4) | ((<a class="code" href="group___s_p_i___s_d_card.html#ge8a254cacac2f309f89ff5b0de5a5639">sd_data_buf</a>[15]&amp;0xF0)&gt;&gt;4);
<a name="l00569"></a>00569                                 <a class="code" href="debug__frmwrk_8h.html#3e6c7a15da08f302351c052694a5b1ca">_DBG</a>(<span class="stringliteral">"2"</span>);<a class="code" href="debug__frmwrk_8h.html#70d3fd73d0ecb9df75d64b8912dd6a63">_DBD</a>(tem8);
<a name="l00570"></a>00570                 }
<a name="l00571"></a>00571         }
<a name="l00572"></a>00572         <span class="keywordflow">else</span>
<a name="l00573"></a>00573     <span class="comment">// DeInitialize SPI peripheral</span>
<a name="l00574"></a>00574                 <a class="code" href="group___s_p_i___public___functions.html#gd69565a7837b400d57b41f1c915a0ffd" title="De-initializes the SPIx peripheral registers to their default reset values.">SPI_DeInit</a>(<a class="code" href="group___l_p_c17xx___system.html#g9b593f008d0061052e90a8865d702ce5">LPC_SPI</a>);
<a name="l00575"></a>00575     <span class="comment">/* Loop forever */</span>
<a name="l00576"></a>00576     <span class="keywordflow">while</span>(1);
<a name="l00577"></a>00577     <span class="keywordflow">return</span> 1;
<a name="l00578"></a>00578 }
<a name="l00579"></a>00579 
<a name="l00580"></a>00580 <span class="comment">/* With ARM and GHS toolsets, the entry point is main() - this will</span>
<a name="l00581"></a>00581 <span class="comment">   allow the linker to generate wrapper code to setup stacks, allocate</span>
<a name="l00582"></a>00582 <span class="comment">   heap area, and initialize and copy code and data segments. For GNU</span>
<a name="l00583"></a>00583 <span class="comment">   toolsets, the entry point is through __start() in the crt0_gnu.asm</span>
<a name="l00584"></a>00584 <span class="comment">   file, and that startup code will setup stacks and data */</span>
<a name="l00585"></a><a class="code" href="group___s_p_i___s_d_card.html#g840291bc02cba5474a4cb46a9b9566fe">00585</a> <span class="keywordtype">int</span> <a class="code" href="group___a_d_c___burst.html#g840291bc02cba5474a4cb46a9b9566fe">main</a>(<span class="keywordtype">void</span>)
<a name="l00586"></a>00586 {
<a name="l00587"></a>00587     <span class="keywordflow">return</span> <a class="code" href="group___a_d_c___burst.html#g94eff562304ddbff21e37f3334362298" title="c_entry: Main ADC program body">c_entry</a>();
<a name="l00588"></a>00588 }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590 
<a name="l00591"></a>00591 <span class="preprocessor">#ifdef  DEBUG</span>
<a name="l00592"></a>00592 <span class="preprocessor"></span><span class="comment">/*******************************************************************************</span>
<a name="l00593"></a>00593 <span class="comment">* @brief                Reports the name of the source file and the source line number</span>
<a name="l00594"></a>00594 <span class="comment">*                               where the CHECK_PARAM error has occurred.</span>
<a name="l00595"></a>00595 <span class="comment">* @param[in]    file Pointer to the source file name</span>
<a name="l00596"></a>00596 <span class="comment">* @param[in]    line assert_param error line source number</span>
<a name="l00597"></a>00597 <span class="comment">* @return               None</span>
<a name="l00598"></a>00598 <span class="comment">*******************************************************************************/</span>
<a name="l00599"></a><a class="code" href="group___s_p_i___s_d_card.html#g6710da8d2be32734dbeff7972d806d5d">00599</a> <span class="keywordtype">void</span> <a class="code" href="group___l_i_b_c_f_g___d_e_f_a_u_l_t___public___functions.html#g6710da8d2be32734dbeff7972d806d5d">check_failed</a>(uint8_t *file, uint32_t line)
<a name="l00600"></a>00600 {
<a name="l00601"></a>00601         <span class="comment">/* User can add his own implementation to report the file name and line number,</span>
<a name="l00602"></a>00602 <span class="comment">         ex: printf("Wrong parameters value: file %s on line %d\r\n", file, line) */</span>
<a name="l00603"></a>00603 
<a name="l00604"></a>00604         <span class="comment">/* Infinite loop */</span>
<a name="l00605"></a>00605         <span class="keywordflow">while</span>(1);
<a name="l00606"></a>00606 }
<a name="l00607"></a>00607 <span class="preprocessor">#endif</span>
<a name="l00608"></a>00608 <span class="preprocessor"></span><span class="comment">/*</span>
<a name="l00609"></a>00609 <span class="comment"> * @}</span>
<a name="l00610"></a>00610 <span class="comment"> */</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Tue Jun 7 14:59:02 2011 for LPC1700CMSIS Standard Peripheral Firmware Library Manual by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9 </small></address>
</body>
</html>
